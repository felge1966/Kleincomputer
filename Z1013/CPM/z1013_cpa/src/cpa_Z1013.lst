 AS V1.42 Beta [Bld 115] - source file cpa_Z1013.asm - page 1 - 3/12/2017 11:04:02
Z1013 BIOS


       1/       0 :                     ;-----------------------------------------------------------------------------
       2/       0 :                     ; Z1013-BIOS
       3/       0 :                     ; Volker Pohlers 06.04.2007 10:12
       4/       0 :                     ; bearbeitet Tino Ziemke 2016
       5/       0 :                     ; VP 20170227 komplett neu gebaut
       6/       0 :                     ; das CCP wird von Diskette gelesen
       7/       0 :                     ;-----------------------------------------------------------------------------
       8/       0 :                     
       9/       0 :                     		cpu	z80
      10/       0 :                     		page	0
      11/       0 :                     
      12/       0 :                     		title	"Z1013 BIOS"
      13/       0 :                     
      14/       0 :                     
      15/       0 :                     ;-----------------------------------------------------------------------------
      16/       0 :                     ; Konfiguration
      17/       0 :                     ;-----------------------------------------------------------------------------
      18/       0 :                     
      19/       0 : =1H                 condev	equ	1	; 0 - 32x32 original
      20/       0 :                     			; 1 - 64x16 Peters-Platine
      21/       0 :                     			; 2 - 64x32 H.P. K1520-BWS
      22/       0 :                     
      23/       0 : =1H                 lstdev	equ	1	; 0 - Sprungverteiler nutzen (DRAKK)
      24/       0 :                     			; 1 - V24-Riesa-Modul
      25/       0 :                     
      26/       0 :                     ;-----------------------------------------------------------------------------
      27/       0 :                     ;
      28/       0 :                     ;-----------------------------------------------------------------------------
      29/       0 :                     
      30/       0 : =>FALSE             	if condev = 2
      31/       0 :                     CCP		equ	0BF00h		; base of ccp
      32/       0 :                     RAMEND		equ	0E7FFH		; Stackbereich	für BIOS (nur read disk)
      33/       0 :                     ; ab E800 Farb-BWS
      34/       0 : =>TRUE              	else
      35/       0 : =C300H              CCP		equ	0C300h		; base of ccp
      36/       0 : =EBFFH              RAMEND		equ	0EBFFH		; Stackbereich	für BIOS (nur read disk)
      37/       0 :                     
      38/       0 : [30]                	endif
      39/       0 : =CB06H              BDOS       	equ	CCP+0806h	; base of bdos
      40/       0 : =D900H              BIOS		equ	CCP+1600h	; base of bios
      41/       0 : =3H                 IOLOC	EQU	3		;i/o definition byte.
      42/       0 : =4H                 DISKA	EQU	4		;current drive name and user number.
      43/       0 :                     
      44/       0 :                     
      45/       0 : =4000H              LOADADRESS	equ	4000H		; Hierhin wird das Programm durch den Loader geladen
      46/       0 :                     
      47/       0 :                     
      48/       0 :                     
      49/       0 :                     
      50/       0 :                     
      51/       0 :                     ; Funktionen für AS
      52/       0 :                     hi		function x,(x>>8)&255 	; oberes Byte eines 16-Bit-Wortes
      53/       0 :                     lo		function x, x&255 	; unteres Byte eines 16-Bit-Wortes
      54/       0 :                     ;nextpage	function x, ((x+0ffh)/100h)*100h
      55/       0 :                     
      56/       0 :                     ;-----------------------------------------------------------------------------
      57/       0 :                     ; Initialisierung Loader (CPMLDR)
      58/       0 :                     ; vom aktuellen Boot-Loader wird dieser Code nicht ausgeführt, es wird nur
      59/       0 :                     ; die Ladeadresse entnommen.
      60/       0 :                     ; man sollte aber @OS auch von hier als CPM-Programm laden können
      61/       0 :                     ;-----------------------------------------------------------------------------
      62/       0 :                     
      63/    4000 :                     		org 	LOADADRESS
      64/    4000 :                     
      65/    4000 :                     anfang:
      66/     100 :                     		phase  100h
      67/     100 :                     
      68/     100 : F3                  		di
      69/     101 : 11 00 40            		ld	de, LOADADRESS	; <- dieser Befehl muß stehen, damit der
      70/     104 :                     					; Loader das OS als gültig erkennt
      71/     104 :                     					; Gleichzeitig entnimmt der Loader hier
      72/     104 :                     					; die initiale Ladeadresse.
      73/     104 : 21 80 01            		ld	hl, 180h
      74/     107 : 01 3C 24            		ld	bc, biosend-LOADADRESS
      75/     10A : ED B0               		ldir
      76/     10C :                     
      77/     10C : AF                  		xor	a		; Laufwerk 0
      78/     10D : C3 00 56            		jp	LOADADRESS+1600h	; COLD
      79/     110 :                     
      80/    4010 :                     		dephase
      81/    4010 :                     
      82/    4010 :                     ;-----------------------------------------------------------------------------
      83/    4010 :                     ; CCP+BDOS
      84/    4010 :                     ;-----------------------------------------------------------------------------
      85/    4010 :                     
      86/    4010 :                     		align	80h		; 1 Sektor weiter
      87/    4080 :                     
      88/    4080 : =4080H              ccpstart:	equ	$
      89/    4080 :                     
      90/    C300 :                     		phase	CCP
      91/    C300 :                     
      92/    C300 :                     		; CP/A AdW
     101/    D900 :                     		LISTING	NOSKIPPED
     102/    D900 :                     
     103/    5680 :                     		dephase
     104/    5680 :                     
     105/    5680 :                     ;-----------------------------------------------------------------------------
     106/    5680 :                     ; BIOS
     107/    5680 :                     ;-----------------------------------------------------------------------------
     108/    5680 :                     
     109/    5680 : =5680H              biosstart:	equ	$
     110/    5680 :                     
     111/    D900 :                     		phase 	BIOS
     112/    D900 :                     
     113/    D900 : C3 D0 62            		jp	cold		; wird in cold gepatcht durch jp cboot
     114/    D903 :                     					;BOOTF		cold boot function
     115/    D903 : C3 B2 E4            		jp	wboot           ;WBOOTF		warm boot function
     116/    D906 : C3 46 DB            		jp	CONST           ;CONSTF		console status function
     117/    D909 : C3 55 D9            		jp	CONIN           ;CONINF		console input function
     118/    D90C : C3 60 D9            		jp	COOUT           ;CONOUTF	console output function
     119/    D90F : C3 9C DB            		jp	LIST           ;LISTF		list output function
     120/    D912 : C3 F7 DB            		jp	PUNCH        ;PUNCHF		punch output function
     121/    D915 : C3 F8 DB            		jp	READR        ;READERF	reader input function
     122/    D918 : C3 D0 DD            		jp	home            ;HOMEF		disk home function
     123/    D91B : C3 06 DC            		jp	seldsk          ;SELDSKF	select disk function
     124/    D91E : C3 DF DD            		jp	settrk          ;SETTRKF	set track function
     125/    D921 : C3 E4 DD            		jp	setsec          ;SETSECF	set sector function
     126/    D924 : C3 E9 DD            		jp	setdma          ;SETDMAF	set dma function
     127/    D927 : C3 1A E5            		jp	_read1          ;READF		read disk function
     128/    D92A : C3 0A E5            		jp	_write1         ;WRITEF		write disk function
     129/    D92D : C3 EE DB            		jp	LSTST           ;LISTSTF	list status function
     130/    D930 : C3 EE DD            		jp	sectran         ;SECTRAN	sector translate
     131/    D933 :                     
     132/    D933 : 43 50 41            		db	"CPA"		; Kennung CPA
     133/    D936 : 31 33               		db	"13"		; Z1013
     134/    D938 :                     
     135/    D938 :                     ; Konfiguration zum Auslesen
     136/    D938 : 01                  config:		db	condev		; con
     137/    D939 : 00                  		db	0		; rdr
     138/    D93A : 00                  		db	0		; pun
     139/    D93B : 01                  		db	lstdev		; lst
     140/    D93C : 02                  		db	2		; Anz. LW
     141/    D93D : 10                  		db	16		; A: 1.6er LW
     142/    D93E : 10                  		db	16		; B: 1.6er LW
     143/    D93F :                     		ds	12		; C..P
     144/    D94B :                     
     145/    D94B :                     
     146/    D94B :                     ;-----------------------------------------------------------------------------
     147/    D94B :                     ; I/O-Gerätetreiber
     148/    D94B :                     ;-----------------------------------------------------------------------------
     149/    D94B :                     
     150/    D94B :                     	; Konsole
     151/    D94B : =>FALSE             	if condev = 0
     153/    D94B : =>TRUE              	elseif condev = 1
     154/    D94B :                     		include	con_6416.inc
(1)    1/    D94B :                     ; aus CP/A VLE 1.1 "ROM-Version 64 ZEICHEN"
(1)    2/    D94B :                     
(1)    3/    D94B :                     ; --- DEF
(1)    4/    D94B :                     ;
(1)    5/    D94B : =16H                SOIL:	EQU	00016H	;START OF INPUT LINE
(1)    6/    D94B : =1FH                CZSP:	EQU	0001FH	;CURSOR-ZWISCHEN-SP.
(1)    7/    D94B : =2BH                CURSR:	EQU	0002BH	
(1)    8/    D94B :                     
(1)    9/    D94B : =EC00H              BWSA:	EQU	0EC00H	;BILDW.-SP.-ANF.
(1)   10/    D94B : =EFFFH              BWSE:	EQU	0EFFFH	;ENDE
(1)   11/    D94B :                     
(1)   12/    D94B : =F000H              MON:	EQU	0F000H	;MONITOR-RET
(1)   13/    D94B : =D006H              BOS:	EQU	0D006H	
(1)   14/    D94B : =FFDCH              BEEP:	EQU	0FFDCH	
(1)   15/    D94B :                     
(1)   16/    D94B : =40H                SPALT:	EQU	64	;BS-SPALTENZAHL
(1)   17/    D94B : =40H                ZL:	EQU	SPALT	;ZEILENLAENGE
(1)   18/    D94B :                     ;
(1)   19/    D94B :                     
(1)   20/    D94B :                     ; --- CODE
(1)   21/    D94B :                     
(1)   22/    D94B :                     ;
(1)   23/    D94B :                     ;*****************************************
(1)   24/    D94B :                     ;
(1)   25/    D94B : 1A                  OUTS:	LD	A,(DE)	
(1)   26/    D94C : B7                  	OR	A	
(1)   27/    D94D : C8                  	RET	Z	
(1)   28/    D94E : 4F                  	LD	C,A	
(1)   29/    D94F : CD 60 D9            	CALL	COOUT	
(1)   30/    D952 : 13                  	INC	DE	
(1)   31/    D953 : 18 F6               	JR	OUTS	
(1)   32/    D955 :                     ;
(1)   33/    D955 :                     ;*****************************************
(1)   34/    D955 :                     ;ZEICHEN VON TASTATUR <A>
(1)   35/    D955 :                     ;*****************************************
(1)   36/    D955 :                     ;
(1)   37/    D955 : CD 66 DB            CONIN:	CALL	CHIT	
(1)   38/    D958 : E7                  	RST	20H	
(1)   39/    D959 : 01                  	DB	1	;ZEICHENEINGABE
(1)   40/    D95A : F5                  	PUSH	AF	
(1)   41/    D95B : CD 73 DB            	CALL	CHTI	
(1)   42/    D95E : F1                  	POP	AF	
(1)   43/    D95F : C9                  	RET		
(1)   44/    D960 :                     ;
(1)   45/    D960 :                     ;*****************************************
(1)   46/    D960 :                     ;ZEICHEN AUF BILDSCHIRM <C>
(1)   47/    D960 :                     ;*****************************************
(1)   48/    D960 :                     ;
(1)   49/    D960 : F5                  COOUT:	PUSH	AF	
(1)   50/    D961 : E5                  	PUSH	HL	
(1)   51/    D962 : C5                  	PUSH	BC	
(1)   52/    D963 : D5                  	PUSH	DE	
(1)   53/    D964 : CD 6C D9            	CALL	ZAG	
(1)   54/    D967 : D1                  	POP	DE	
(1)   55/    D968 : C1                  	POP	BC	
(1)   56/    D969 : E1                  	POP	HL	
(1)   57/    D96A : F1                  	POP	AF	
(1)   58/    D96B : C9                  	RET		
(1)   59/    D96C :                     ;
(1)   60/    D96C : 3A 7E DB            ZAG:	LD	A,(MLZBS)	;MERKE LETZTES ZEICHEN
(1)   61/    D96F : FE 1B               	CP	A, 1BH	
(1)   62/    D971 : CA EA DA            	JP	Z, ANKXY	
(1)   63/    D974 : 3E 1B               	LD	A,1BH	
(1)   64/    D976 : B9                  	CP	A, C	
(1)   65/    D977 : CA E5 DA            	JP	Z, MESC	
(1)   66/    D97A : 79                  	LD	A,C	
(1)   67/    D97B : B7                  	OR	A	
(1)   68/    D97C : C8                  	RET	Z	
(1)   69/    D97D : 21 98 D9            	LD	HL,KTAB	
(1)   70/    D980 : 01 12 00            	LD	BC,LKTAB	
(1)   71/    D983 : ED B1               	CPIR		
(1)   72/    D985 : 20 47               	JR	NZ, ZAG1	
(1)   73/    D987 : 2B                  	DEC	HL	
(1)   74/    D988 : 01 98 D9            	LD	BC,KTAB	
(1)   75/    D98B : ED 42               	SBC	HL,BC	
(1)   76/    D98D : CB 25               	SLA	L	
(1)   77/    D98F : 01 AA D9            	LD	BC,FTAB	
(1)   78/    D992 : 09                  	ADD	HL,BC	
(1)   79/    D993 : 4E                  	LD	C,(HL)	
(1)   80/    D994 : 23                  	INC	HL	
(1)   81/    D995 : 66                  	LD	H,(HL)	
(1)   82/    D996 : 69                  	LD	L,C	
(1)   83/    D997 : E9                  	JP	(HL)	
(1)   84/    D998 :                     
(1)   85/    D998 : 08                  KTAB:	DB	8	;BACKSTEP
(1)   86/    D999 : 09                  	DB	9	;CURSOR RECHTS
(1)   87/    D99A : 0C                  	DB	0CH	;CLS
(1)   88/    D99B : 16                  	DB	16H	;LOESCHEN ZEILENREST
(1)   89/    D99C : 18                  	DB	18H	;LOESCHEN ZEILE,CURSOR ANF.Z.
(1)   90/    D99D : 1A                  	DB	1AH	;CURSOR NACH OBEN
(1)   91/    D99E : 14                  	DB	14H	;LOESCHEN BILDSCHIRMREST
(1)   92/    D99F : 82                  	DB	82H	;KURSOR EIN
(1)   93/    D9A0 : 83                  	DB	83H	;KURSOR AUS
(1)   94/    D9A1 : 0D                  	DB	0DH	;CR
(1)   95/    D9A2 : 0A                  	DB	0AH	;LF
(1)   96/    D9A3 : 01                  	DB	1	;CURSOR LINKS OBEN
(1)   97/    D9A4 : 07                  	DB	7	;BEEP
(1)   98/    D9A5 : 15                  	DB	15H	;CURSOR RECHTS
(1)   99/    D9A6 : 84                  	DB	84H	;ZEICHEN NORMAL
(1)  100/    D9A7 : 85                  	DB	85H	;ZEICHEN INVERS
(1)  101/    D9A8 : 86                  	DB	86H	;ZEICHEN INTENSIV
(1)  102/    D9A9 : 87                  	DB	87H	;ZEICHEN INTENSIV INVERS
(1)  103/    D9AA : =12H                LKTAB:	EQU	$-KTAB	
(1)  104/    D9AA : 13 DA               FTAB:	DW	BSTP	
(1)  105/    D9AC : 19 DA               	DW	CURR	
(1)  106/    D9AE : 2C DA               	DW	CLS	
(1)  107/    D9B0 : 95 DA               	DW	DELLN	
(1)  108/    D9B2 : AC DA               	DW	INSLN	
(1)  109/    D9B4 : C6 DA               	DW	ZRET	
(1)  110/    D9B6 : 76 DA               	DW	CLCU	
(1)  111/    D9B8 : D0 DA               	DW	CZSET	
(1)  112/    D9BA : D7 DA               	DW	PUABL	
(1)  113/    D9BC : 41 DA               	DW	CR	
(1)  114/    D9BE : 50 DA               	DW	OUTLF	
(1)  115/    D9C0 : 68 DA               	DW	CHOME	
(1)  116/    D9C2 : 4C DA               	DW	BEEPA	
(1)  117/    D9C4 : 19 DA               	DW	CURR	
(1)  118/    D9C6 : E2 DA               	DW	NORM	
(1)  119/    D9C8 : DC DA               	DW	INV	
(1)  120/    D9CA : 12 DA               	DW	ND	
(1)  121/    D9CC : 12 DA               	DW	ND	
(1)  122/    D9CE :                     ;AUSGABE ZEICHEN <> STEUERZEICHEN
(1)  123/    D9CE : E6 7F               ZAG1:	AND	A, 7FH	
(1)  124/    D9D0 : 2A 2B 00            	LD	HL,(CURSR)	
(1)  125/    D9D3 : F5                  	PUSH	AF	
(1)  126/    D9D4 : 3A 86 DB            	LD	A,(MINV)	
(1)  127/    D9D7 : 47                  	LD	B,A	
(1)  128/    D9D8 : F1                  	POP	AF	
(1)  129/    D9D9 : B0                  	OR	B	;INVERS, WENN 80H
(1)  130/    D9DA : 77                  	LD	(HL),A	
(1)  131/    D9DB : 23                  	INC	HL	
(1)  132/    D9DC : EB                  	EX	DE,HL	
(1)  133/    D9DD : 21 00 F0            	LD	HL,BWSE+1	
(1)  134/    D9E0 : AF                  	XOR	A	
(1)  135/    D9E1 : ED 52               	SBC	HL,DE	
(1)  136/    D9E3 : EB                  	EX	DE,HL	
(1)  137/    D9E4 : 20 23               	JR	NZ, ZAG2	
(1)  138/    D9E6 : 11 00 EC            ZAG3:	LD	DE,BWSA	
(1)  139/    D9E9 : 21 40 EC            	LD	HL,BWSA+SPALT	
(1)  140/    D9EC : 01 C0 03            	LD	BC,BWSE-BWSA+1-SPALT	
(1)  141/    D9EF : ED B0               	LDIR		
(1)  142/    D9F1 : D5                  	PUSH	DE	
(1)  143/    D9F2 : E1                  	POP	HL	
(1)  144/    D9F3 : E5                  	PUSH	HL	
(1)  145/    D9F4 : 13                  	INC	DE	
(1)  146/    D9F5 : 36 20               	LD	(HL),' '	
(1)  147/    D9F7 : 01 3F 00            	LD	BC,SPALT-1	
(1)  148/    D9FA : ED B0               	LDIR		
(1)  149/    D9FC : 2A 16 00            	LD	HL,(SOIL)	
(1)  150/    D9FF : 11 40 00            	LD	DE,SPALT	
(1)  151/    DA02 : AF                  	XOR	A	
(1)  152/    DA03 : ED 52               	SBC	HL,DE	
(1)  153/    DA05 : 22 16 00            	LD	(SOIL),HL	
(1)  154/    DA08 : E1                  	POP	HL	
(1)  155/    DA09 : 7E                  ZAG2:	LD	A,(HL)	
(1)  156/    DA0A : 32 1F 00            	LD	(CZSP),A	
(1)  157/    DA0D : 36 FF               	LD	(HL),0FFH	
(1)  158/    DA0F : 22 2B 00            	LD	(CURSR),HL	
(1)  159/    DA12 : C9                  ND:	RET		
(1)  160/    DA13 :                     
(1)  161/    DA13 :                     ;BACKSTEP
(1)  162/    DA13 : CD D7 DA            BSTP:	CALL	PUABL	
(1)  163/    DA16 : 2B                  	DEC	HL	
(1)  164/    DA17 : 18 F0               	JR	ZAG2	
(1)  165/    DA19 :                     ;CURSOR RECHTS
(1)  166/    DA19 : CD D7 DA            CURR:	CALL	PUABL	
(1)  167/    DA1C : 23                  	INC	HL	
(1)  168/    DA1D : 11 FF EF            	LD	DE,BWSE	
(1)  169/    DA20 : EB                  	EX	DE,HL	
(1)  170/    DA21 : B7                  	OR	A	
(1)  171/    DA22 : ED 52               	SBC	HL,DE	
(1)  172/    DA24 : EB                  	EX	DE,HL	
(1)  173/    DA25 : 3E 20               	LD	A,' '	
(1)  174/    DA27 : DA CE D9            	JP	C, ZAG1	
(1)  175/    DA2A : 18 DD               	JR	ZAG2	
(1)  176/    DA2C :                     ;BS-LOESCHEN
(1)  177/    DA2C : 21 00 EC            CLS:	LD	HL,BWSA	
(1)  178/    DA2F : 36 20               	LD	(HL),' '	
(1)  179/    DA31 : 01 FF 03            	LD	BC,BWSE-BWSA	
(1)  180/    DA34 : 11 01 EC            	LD	DE,BWSA+1	
(1)  181/    DA37 : ED B0               	LDIR		
(1)  182/    DA39 : 3E 20               	LD	A,' '	
(1)  183/    DA3B : 32 1F 00            	LD	(CZSP),A	
(1)  184/    DA3E : C3 68 DA            	JP	CHOME	
(1)  185/    DA41 :                     ;
(1)  186/    DA41 : 2A 2B 00            CR:	LD	HL,(CURSR)	
(1)  187/    DA44 : 3E 3F               	LD	A,SPALT-1	
(1)  188/    DA46 : 2F                  	CPL		
(1)  189/    DA47 : A5                  	AND	A, L	
(1)  190/    DA48 : 6F                  	LD	L,A	
(1)  191/    DA49 : C3 29 DB            	JP	SETCU	
(1)  192/    DA4C :                     ;
(1)  193/    DA4C : =DA4CH              BEEPA:	EQU	$	
(1)  194/    DA4C : CD DC FF            	CALL	BEEP	
(1)  195/    DA4F : C9                  	RET		
(1)  196/    DA50 :                     ;
(1)  197/    DA50 : 11 FF EF            OUTLF:	LD	DE,BWSE	
(1)  198/    DA53 : 2A 2B 00            	LD	HL,(CURSR)	
(1)  199/    DA56 : 01 40 00            	LD	BC,SPALT	
(1)  200/    DA59 : 09                  	ADD	HL,BC	
(1)  201/    DA5A : EB                  	EX	DE,HL	
(1)  202/    DA5B : ED 52               	SBC	HL,DE	;ENDE-NEUE
(1)  203/    DA5D : EB                  	EX	DE,HL	
(1)  204/    DA5E : D2 29 DB            	JP	NC, SETCU	
(1)  205/    DA61 : CD D7 DA            	CALL	PUABL	;PUFFER AUFBLENDEN
(1)  206/    DA64 : CD E6 D9            	CALL	ZAG3	
(1)  207/    DA67 : C9                  	RET		
(1)  208/    DA68 :                     ;
(1)  209/    DA68 : 11 00 EC            CHOME:	LD	DE,BWSA	
(1)  210/    DA6B : 2A 2B 00            	LD	HL,(CURSR)	
(1)  211/    DA6E : B7                  	OR	A	
(1)  212/    DA6F : ED 52               	SBC	HL,DE	
(1)  213/    DA71 : C8                  	RET	Z	
(1)  214/    DA72 : EB                  	EX	DE,HL	
(1)  215/    DA73 : C3 29 DB            	JP	SETCU	
(1)  216/    DA76 :                     ;
(1)  217/    DA76 :                     ;LOESCHEN BS AB CURSOR
(1)  218/    DA76 :                     ;
(1)  219/    DA76 : ED 4B 2B 00         CLCU:	LD	BC,(CURSR)	
(1)  220/    DA7A : 21 FF EF            	LD	HL,BWSE	
(1)  221/    DA7D : ED 42               	SBC	HL,BC	;HL:=ANZ.ZEICH.BIS BWS-ENDE
(1)  222/    DA7F : 11 01 00            MDFAA:	LD	DE,1	
(1)  223/    DA82 : 3E 20               	LD	A,' '	
(1)  224/    DA84 : ED 4B 2B 00         	LD	BC,(CURSR)	
(1)  225/    DA88 : 02                  MDFB3:	LD	(BC),A	
(1)  226/    DA89 : 03                  	INC	BC	
(1)  227/    DA8A : ED 52               	SBC	HL,DE	
(1)  228/    DA8C : C2 88 DA            	JP	NZ, MDFB3	
(1)  229/    DA8F : 2A 2B 00            MDFBA:	LD	HL,(CURSR)	
(1)  230/    DA92 : 36 FF               	LD	(HL),0FFH	;CURSOR
(1)  231/    DA94 : C9                  	RET		
(1)  232/    DA95 :                     ;
(1)  233/    DA95 : 2A 2B 00            DELLN:	LD	HL,(CURSR)	
(1)  234/    DA98 : 7D                  	LD	A,L	
(1)  235/    DA99 : E6 3F               	AND	A, SPALT-1	;A=SPALTENPOS.
(1)  236/    DA9B : 47                  	LD	B,A	
(1)  237/    DA9C : 3E 3F               	LD	A,SPALT-1	
(1)  238/    DA9E : 90                  	SUB	B	
(1)  239/    DA9F : C8                  	RET	Z	
(1)  240/    DAA0 : 47                  	LD	B,A	;ANZ.BIS ENDE ZEILE
(1)  241/    DAA1 : 3E 20               	LD	A,' '	
(1)  242/    DAA3 : 32 1F 00            	LD	(CZSP),A	
(1)  243/    DAA6 : 23                  DELL1:	INC	HL	
(1)  244/    DAA7 : 36 20               	LD	(HL),' '	
(1)  245/    DAA9 : 10 FB               	DJNZ	DELL1	
(1)  246/    DAAB : C9                  	RET		
(1)  247/    DAAC :                     ;
(1)  248/    DAAC : CD 41 DA            INSLN:	CALL	CR	
(1)  249/    DAAF : 3A 1F 00            	LD	A,(CZSP)	
(1)  250/    DAB2 : 77                  	LD	(HL),A	
(1)  251/    DAB3 : 54                  	LD	D,H	
(1)  252/    DAB4 : 5D                  	LD	E,L	
(1)  253/    DAB5 : 13                  	INC	DE	
(1)  254/    DAB6 : 01 3F 00            	LD	BC,SPALT-1	
(1)  255/    DAB9 : ED B0               	LDIR		
(1)  256/    DABB : 2A 2B 00            	LD	HL,(CURSR)	
(1)  257/    DABE : 36 FF               	LD	(HL),0FFH	
(1)  258/    DAC0 : 3E 20               	LD	A,' '	
(1)  259/    DAC2 : 32 1F 00            	LD	(CZSP),A	
(1)  260/    DAC5 : C9                  	RET		
(1)  261/    DAC6 :                     ;
(1)  262/    DAC6 : 06 40               ZRET:	LD	B,SPALT	
(1)  263/    DAC8 : C5                  ZR1:	PUSH	BC	
(1)  264/    DAC9 : CD 13 DA            	CALL	BSTP	
(1)  265/    DACC : C1                  	POP	BC	
(1)  266/    DACD : 10 F9               	DJNZ	ZR1	
(1)  267/    DACF : C9                  	RET		
(1)  268/    DAD0 :                     ;
(1)  269/    DAD0 : 3E FF               CZSET:	LD	A,0FFH	
(1)  270/    DAD2 : 2A 2B 00            CZS1:	LD	HL,(CURSR)	
(1)  271/    DAD5 : 77                  	LD	(HL),A	
(1)  272/    DAD6 : C9                  	RET		
(1)  273/    DAD7 :                     ;
(1)  274/    DAD7 : 3A 1F 00            PUABL:	LD	A,(CZSP)	
(1)  275/    DADA : 18 F6               	JR	CZS1	
(1)  276/    DADC :                     ;
(1)  277/    DADC :                     ;
(1)  278/    DADC : 3E 80               INV:	LD	A,80H	
(1)  279/    DADE : 32 86 DB            INV1:	LD	(MINV),A	
(1)  280/    DAE1 : C9                  	RET		
(1)  281/    DAE2 :                     ;
(1)  282/    DAE2 : AF                  NORM:	XOR	A	
(1)  283/    DAE3 : 18 F9               	JR	INV1	
(1)  284/    DAE5 :                     ;	
(1)  285/    DAE5 : 79                  MESC:	LD	A,C	
(1)  286/    DAE6 : 32 7E DB            	LD	(MLZBS),A	
(1)  287/    DAE9 : C9                  	RET		
(1)  288/    DAEA :                     ;
(1)  289/    DAEA : 3A 7F DB            ANKXY:	LD	A,(MSEQU)	
(1)  290/    DAED : FE FF               	CP	A, 0FFH	
(1)  291/    DAEF : CA FE DA            	JP	Z, SETXY	
(1)  292/    DAF2 : 3E FF               	LD	A,0FFH	
(1)  293/    DAF4 : 32 7F DB            	LD	(MSEQU),A	
(1)  294/    DAF7 : 79                  	LD	A,C	
(1)  295/    DAF8 : E6 5F               	AND	A, 5FH	
(1)  296/    DAFA : 32 80 DB            	LD	(MZEIP),A	
(1)  297/    DAFD : C9                  	RET		
(1)  298/    DAFE :                     ;
(1)  299/    DAFE : 79                  SETXY:	LD	A,C	
(1)  300/    DAFF : FE 3D               	CP	A, 3DH	;ADM3A-TERMINAL
(1)  301/    DB01 : C8                  	RET	Z	
(1)  302/    DB02 : FE 59               	CP	A, 59H	
(1)  303/    DB04 : C8                  	RET	Z	
(1)  304/    DB05 : E6 7F               	AND	A, 7FH	
(1)  305/    DB07 : 32 81 DB            	LD	(MSPAP),A	
(1)  306/    DB0A : 4F                  	LD	C,A	
(1)  307/    DB0B : AF                  	XOR	A	
(1)  308/    DB0C : 32 7E DB            	LD	(MLZBS),A	
(1)  309/    DB0F : 32 7F DB            	LD	(MSEQU),A	
(1)  310/    DB12 : 21 00 EC            	LD	HL,BWSA	
(1)  311/    DB15 : 06 00               	LD	B,0	
(1)  312/    DB17 : 09                  	ADD	HL,BC	
(1)  313/    DB18 : 3A 80 DB            	LD	A,(MZEIP)	
(1)  314/    DB1B : B7                  	OR	A	;ZEILE 0?
(1)  315/    DB1C : CA 29 DB            	JP	Z, SETCU	
(1)  316/    DB1F : 0E 00               	LD	C,0	
(1)  317/    DB21 : 47                  	LD	B,A	
(1)  318/    DB22 : 16 00               	LD	D,0	
(1)  319/    DB24 : 1E 40               	LD	E,SPALT	;SPALTENZAHL
(1)  320/    DB26 : 19                  ZINC:	ADD	HL,DE	
(1)  321/    DB27 : 10 FD               	DJNZ	ZINC	
(1)  322/    DB29 : E5                  SETCU:	PUSH	HL	
(1)  323/    DB2A : 11 FF EF            	LD	DE,BWSE	
(1)  324/    DB2D : 37                  	SCF		
(1)  325/    DB2E : ED 52               	SBC	HL,DE	
(1)  326/    DB30 : E1                  	POP	HL	
(1)  327/    DB31 : 38 01               	JR	C, SETC1	
(1)  328/    DB33 : EB                  	EX	DE,HL	
(1)  329/    DB34 : ED 5B 2B 00         SETC1:	LD	DE,(CURSR)	
(1)  330/    DB38 : 3A 1F 00            	LD	A,(CZSP)	
(1)  331/    DB3B : 12                  	LD	(DE),A	
(1)  332/    DB3C : 7E                  	LD	A,(HL)	;VERDECKTES ZEICHEN
(1)  333/    DB3D : 32 1F 00            	LD	(CZSP),A	
(1)  334/    DB40 : 36 FF               	LD	(HL),0FFH	;NEUER CURSOR
(1)  335/    DB42 : 22 2B 00            	LD	(CURSR),HL	
(1)  336/    DB45 : C9                  	RET		
(1)  337/    DB46 :                     ;
(1)  338/    DB46 :                     ;
(1)  339/    DB46 :                     ;
(1)  340/    DB46 : CD 4E DB            CONST:	CALL	CONS1	
(1)  341/    DB49 : B7                  	OR	A	
(1)  342/    DB4A : C8                  	RET	Z	
(1)  343/    DB4B : 3E FF               	LD	A,0FFH	
(1)  344/    DB4D : C9                  	RET		
(1)  345/    DB4E :                     ;
(1)  346/    DB4E : CD 66 DB            CONS1:	CALL	CHIT	
(1)  347/    DB51 : E5                  	PUSH	HL	
(1)  348/    DB52 : D5                  	PUSH	DE	
(1)  349/    DB53 : C5                  	PUSH	BC	
(1)  350/    DB54 : E7                  	RST	20H	
(1)  351/    DB55 : 04                  	DB	4	
(1)  352/    DB56 : C1                  	POP	BC	
(1)  353/    DB57 : D1                  	POP	DE	
(1)  354/    DB58 : E1                  	POP	HL	
(1)  355/    DB59 : F5                  	PUSH	AF	
(1)  356/    DB5A : AF                  	XOR	A	
(1)  357/    DB5B : 32 84 DB            	LD	(TAPUF),A	
(1)  358/    DB5E : 3A 82 DB            	LD	A,(IOBPF)	
(1)  359/    DB61 : 32 04 00            	LD	(DISKA),A	
(1)  360/    DB64 : F1                  	POP	AF	
(1)  361/    DB65 : C9                  	RET		
(1)  362/    DB66 :                     
(1)  363/    DB66 :                     ;*****************************************
(1)  364/    DB66 :                     ;
(1)  365/    DB66 : 3A 04 00            CHIT:	LD	A,(DISKA)	
(1)  366/    DB69 : 32 82 DB            	LD	(IOBPF),A	
(1)  367/    DB6C : 3A 84 DB            	LD	A,(TAPUF)	
(1)  368/    DB6F : 32 04 00            CHRET:	LD	(DISKA),A	
(1)  369/    DB72 : C9                  	RET		
(1)  370/    DB73 :                     ;
(1)  371/    DB73 : 3A 04 00            CHTI:	LD	A,(DISKA)	
(1)  372/    DB76 : 32 84 DB            	LD	(TAPUF),A	
(1)  373/    DB79 : 3A 82 DB            	LD	A,(IOBPF)	
(1)  374/    DB7C : 18 F1               	JR	CHRET	
(1)  375/    DB7E :                     
(1)  376/    DB7E :                     
(1)  377/    DB7E :                     ; --- RAM
(1)  378/    DB7E :                     
(1)  379/    DB7E :                     
(1)  380/    DB7E :                     ;
(1)  381/    DB7E :                     ;*****************************************
(1)  382/    DB7E :                     ;
(1)  383/    DB7E : 00                  MLZBS:	DB	0	;MERKE LETZTES ZEICH.-BS
(1)  384/    DB7F : 00                  MSEQU:	DB	0	;MERKE SEQUENZ
(1)  385/    DB80 : 00                  MZEIP:	DB	0	;MERKE ZEILENPOSITION
(1)  386/    DB81 : 00                  MSPAP:	DB	0	;MERKE SPALTENPOSITION
(1)  387/    DB82 :                     ;
(1)  388/    DB82 :                     ;
(1)  389/    DB82 :                     ;*****************************************
(1)  390/    DB82 :                     ;
(1)  391/    DB82 :                     ;
(1)  392/    DB82 : 00 00               IOBPF:	DW	0	;PUFFER I/O BYTE
(1)  393/    DB84 : 00 00               TAPUF:	DW	0	
(1)  394/    DB86 : 00                  MINV:	DB	0	
(1)  395/    DB87 :                     
(1)  396/    DB87 :                     
(1)  397/    DB87 :                     ; --- INIT
(1)  398/    DB87 :                     
(1)  399/    DB87 :                     INIT_CRT:	
(1)  400/    DB87 : DB 04               	IN	A, 4	;64-Zeichen-BWS
(1)  401/    DB89 : E6 F0               	AND	A, 0F0H	
(1)  402/    DB8B : CB FF               	SET	7,A	
(1)  403/    DB8D : D3 04               	OUT	4, A	
(1)  404/    DB8F :                     
(1)  405/    DB8F : 3A 04 00            	LD	A,(4)	
(1)  406/    DB92 : 32 84 DB            	LD	(TAPUF),A	
(1)  407/    DB95 :                     
(1)  408/    DB95 : 0E 0C               	ld	c,0ch
(1)  409/    DB97 : CD 60 D9            	call	COOUT
(1)  410/    DB9A :                     
(1)  411/    DB9A : C9                  	RET		
(1)  412/    DB9B :                     
     155/    DB9B : =>FALSE             	elseif condev = 2
     157/    DB9B : [151]               	endif
     158/    DB9B :                     
     159/    DB9B :                     	; Drucker
     160/    DB9B : =>FALSE             	if lstdev = 0
     162/    DB9B : =>TRUE              	elseif lstdev = 1
     163/    DB9B :                     		include	lst_v24.inc
(1)    1/    DB9B :                     ;DRUCKEREINBINDUNG V.24-MODUL RIESA
(1)    2/    DB9B :                     ;9600 Baud, 8N1
(1)    3/    DB9B :                     ;PIO A3 CTS-SIGNAL
(1)    4/    DB9B :                     ;PIO A0 TxD Daten
(1)    5/    DB9B :                     ; s.a. http://hc-ddr.hucki.net/wiki/doku.php/z1013:handbuecher:bedienungsanleitung64#v24_-_drucker_-_anpassung_an_z_1013_und_einbindung_ins_10k-basic
(1)    6/    DB9B :                     ; Bit 0 führt zu RxD des Druckers
(1)    7/    DB9B :                     ; Bit 4 führt zu DTR des Druckers
(1)    8/    DB9B :                     ; Masse der Zusatzbaugruppe an Betriebserde 
(1)    9/    DB9B :                     
(1)   10/    DB9B :                     ; --- DEF
(1)   11/    DB9B :                     
(1)   12/    DB9B : 00                  F2_4:	DEFB	0		;SCHALTER TAKT 0=AUTOANPASSUNG		
(1)   13/    DB9C :                     	;			;2=2MHz, 4=4MHz;
(1)   14/    DB9C :                     
(1)   15/    DB9C :                     
(1)   16/    DB9C : =34H                PIOD	EQU	34h		;ADR.V.24 E/A-MOD.
(1)   17/    DB9C : =35H                PIOC	EQU	35h
(1)   18/    DB9C :                     
(1)   19/    DB9C :                     
(1)   20/    DB9C :                     ; --- CODE
(1)   21/    DB9C :                     
(1)   22/    DB9C :                     ;
(1)   23/    DB9C :                     ;DRUCKEREINBINDUNG V.24-MODUL RIESA
(1)   24/    DB9C :                     ;
(1)   25/    DB9C : 79                  LIST:	LD	A,C	
(1)   26/    DB9D : E5                  ZDR1:	PUSH	HL	
(1)   27/    DB9E : C5                  	PUSH	BC	
(1)   28/    DB9F : 6F                  	LD	L,A	
(1)   29/    DBA0 : 3E CF               	LD	A,0CFH	
(1)   30/    DBA2 : D3 35               	OUT	(PIOC),A	
(1)   31/    DBA4 : 3E FE               	LD	A,0FEH	
(1)   32/    DBA6 : D3 35               	OUT	(PIOC),A	
(1)   33/    DBA8 : E5                  PRNT1:	PUSH	HL	
(1)   34/    DBA9 : AF                  	XOR	A	
(1)   35/    DBAA : 32 84 DB            	LD	(TAPUF),A	;BLINDE BREAK-ABFRAGE
(1)   36/    DBAD : CD 4E DB            	CALL	CONS1	
(1)   37/    DBB0 : FE 1B               	CP	A, 1BH	;ESCAPE
(1)   38/    DBB2 : 37                  	SCF		
(1)   39/    DBB3 : E1                  	POP	HL	
(1)   40/    DBB4 : 28 35               	JR	Z,PRE	
(1)   41/    DBB6 : DB 34               	IN	A,(PIOD)	;DRUCKERSTATUS LESEN
(1)   42/    DBB8 : E6 08               	AND	A, 8	;A3=CTS
(1)   43/    DBBA : 20 EC               	JR	NZ,PRNT1	
(1)   44/    DBBC : 06 0A               	LD	B,10	;10 BITS
(1)   45/    DBBE : 26 FF               	LD	H,0FFH	;STOP-BITS
(1)   46/    DBC0 : CB 25               	SLA	L	;STARTBIT EINSCHIEBEN
(1)   47/    DBC2 : CB 14               	RL	H	
(1)   48/    DBC4 : F3                  	DI		
(1)   49/    DBC5 : D5                  	PUSH	DE	
(1)   50/    DBC6 : 3A 9B DB            	LD	A,(F2_4)	
(1)   51/    DBC9 : FE 04               	CP	A, 4	;4MHz
(1)   52/    DBCB : 28 0C               	JR	Z,F4	
(1)   53/    DBCD : FE 02               	CP	A, 2	;2MHz
(1)   54/    DBCF : 28 04               	JR	Z,F2	
(1)   55/    DBD1 : DB 04               	IN	A,(4)	
(1)   56/    DBD3 : CB 77               	BIT	6,A	
(1)   57/    DBD5 : 16 0A               F2:	LD	D,10	;ZK 2MHz
(1)   58/    DBD7 : 28 02               	JR	Z,SEND	
(1)   59/    DBD9 : 16 17               F4:	LD	D,23	;ZK 4MHz
(1)   60/    DBDB : 7D                  SEND:	LD	A,L	
(1)   61/    DBDC : D3 34               	OUT	(PIOD),A	
(1)   62/    DBDE : CB 3C               	SRL	H	
(1)   63/    DBE0 : CB 1D               	RR	L	
(1)   64/    DBE2 : 4A                  	LD	C,D	;ZK
(1)   65/    DBE3 : 0D                  TIME0:	DEC	C	
(1)   66/    DBE4 : 20 FD               	JR	NZ,TIME0	
(1)   67/    DBE6 : 10 F3               	DJNZ	SEND	
(1)   68/    DBE8 : FB                  	EI		
(1)   69/    DBE9 : B7                  	OR	A	;CY=0
(1)   70/    DBEA : D1                  	POP	DE	
(1)   71/    DBEB : C1                  PRE:	POP	BC	
(1)   72/    DBEC : E1                  	POP	HL	
(1)   73/    DBED : C9                  	RET		
(1)   74/    DBEE :                     ;
(1)   75/    DBEE :                     ;DRUCKERSTATUS V.24-MODUL RIESA
(1)   76/    DBEE : DB 34               LSTST:	IN	A,(PIOD)	;DRUCKERSTATUS
(1)   77/    DBF0 : E6 08               	AND	A, 8	;CTS-SIGNAL
(1)   78/    DBF2 : 3E FF               	LD	A,0FFH	
(1)   79/    DBF4 : C8                  	RET	Z	;BEREIT
(1)   80/    DBF5 : AF                  	XOR	A	
(1)   81/    DBF6 : C9                  	RET		
(1)   82/    DBF7 :                     ;
(1)   83/    DBF7 : C9                  PUNCH:	RET		
(1)   84/    DBF8 :                     ;
(1)   85/    DBF8 : C9                  READR:	RET		
(1)   86/    DBF9 :                     ;
(1)   87/    DBF9 :                     
(1)   88/    DBF9 :                     
(1)   89/    DBF9 :                     
(1)   90/    DBF9 :                     ; --- RAM
(1)   91/    DBF9 :                     
(1)   92/    DBF9 :                     
(1)   93/    DBF9 :                     
(1)   94/    DBF9 :                     ; --- INIT
(1)   95/    DBF9 :                     
(1)   96/    DBF9 :                     INIT_PRN:	
(1)   97/    DBF9 :                     ;
(1)   98/    DBF9 :                     ;INIT PIO f. Drucker
(1)   99/    DBF9 :                     ;
(1)  100/    DBF9 : 3E CF               	LD	A,0CFH	
(1)  101/    DBFB : D3 35               	OUT	(PIOC),A	
(1)  102/    DBFD : 3E FE               	LD	A,0FEH	
(1)  103/    DBFF : D3 35               	OUT	(PIOC),A	
(1)  104/    DC01 : 3E FF               	LD	A,0FFH	
(1)  105/    DC03 : D3 34               	OUT	(PIOD),A	;ANFANGSINIT
(1)  106/    DC05 :                     
(1)  107/    DC05 : C9                  	RET
(1)  108/    DC06 :                     
     164/    DC06 : [160]               	endif
     165/    DC06 :                     
     166/    DC06 :                     ;-----------------------------------------------------------------------------
     167/    DC06 :                     ; Floppy-Treiber
     168/    DC06 :                     ;-----------------------------------------------------------------------------
     169/    DC06 :                     
     170/    DC06 :                     		include biosdsk.inc
(1)    1/    DC06 :                     ;-----------------------------------------------------------------------------
(1)    2/    DC06 :                     
(1)    3/    DC06 :                     ;CPA-Source: BIOSDSK.MAC
(1)    4/    DC06 :                     
(1)    5/    DC06 :                     ; Laufwerksauswahl
(1)    6/    DC06 :                     ;=================
(1)    7/    DC06 :                     ; i C: Laufw. (0=A:, 1=B: ...)
(1)    8/    DC06 :                     ; i E: Bit 0 ist LOGIN-Bit von BDOS (=0, wenn LOGIN)
(1)    9/    DC06 :                     
(1)   10/    DC06 : CD F2 DD            seldsk:		call	dgetpb			; HL auf DPH stellen, IX auf DPB
(1)   11/    DC09 : C8                  		ret	z			; Geraet ex. nicht
(1)   12/    DC0A : 79                  		ld	a, c
(1)   13/    DC0B : 32 5C E1            		ld	(ddrive), a		; Laufwerk merken
(1)   14/    DC0E : CB 43               		bit	0, e			; LOGIN von BDOS?
(1)   15/    DC10 : C0                  		ret	nz			; nein
(1)   16/    DC11 :                     
(1)   17/    DC11 : E5                  		push	hl			; ^DPH merken
(1)   18/    DC12 : 21 53 E1            		ld	hl, dbdev
(1)   19/    DC15 : BE                  		cp	(hl)			; LOGIN fuer gepuffertes Device?
(1)   20/    DC16 : 20 07               		jr	nz, seldsk1		; nein
(1)   21/    DC18 : 36 FF               		ld	(hl), 0FFh		; Puffer ist ungueltig
(1)   22/    DC1A : 21 52 E1            		ld	hl, dbflg
(1)   23/    DC1D : CB 96               		res	2, (hl)			;kein veraend. Puffer auszug.!
(1)   24/    DC1F :                     
(1)   25/    DC1F : DD CB 0F 76         seldsk1:	bit	6, (ix+0Fh)		;Formaterkennung unterdr.?
(1)   26/    DC23 :                     
(1)   27/    DC23 : C2 CE DD            		jp	nz, seldsk23		;ja
(1)   28/    DC26 :                     
(1)   29/    DC26 : CD 7D DF            		call	dbtrw			;Puffer freimachen und auf Lesen schalten
(1)   30/    DC29 : 21 66 E1            		ld	hl, dbnb
(1)   31/    DC2C : 36 FF               		ld	(hl), 0FFh		;Puffernummer ist ungueltig, obwohl evtl.
(1)   32/    DC2E :                     						;alle anderen Pufferparameter stimmen
(1)   33/    DC2E :                     						;(da nur 128 Bytes vom Puffer belegt sind)
(1)   34/    DC2E : 79                  		ld	a, c
(1)   35/    DC2F : 32 4C E1            		ld	(dfrmdv), a
(1)   36/    DC32 : 32 53 E1            		ld	(dbdev), a
(1)   37/    DC35 : AF                  		xor	a
(1)   38/    DC36 : DD 77 0F            		ld	(ix+0Fh), a		;ruecksetzen alle Flags
(1)   39/    DC39 : DD 77 13            		ld	(ix+13h), a		;keine Weiter-Numm. auf Ruecks.
(1)   40/    DC3C : DD 77 0D            		ld	(ix+0Dh), a		;keine Systemspuren
(1)   41/    DC3F : 32 4D E1            		ld	(dfrmtr), a		;Spur 0
(1)   42/    DC42 : 32 54 E1            		ld	(dbtrk), a
(1)   43/    DC45 : 3C                  		inc	a
(1)   44/    DC46 : 32 56 E1            		ld	(dbsec), a		;Sektor 1
(1)   45/    DC49 : 32 58 E1            		ld	(dbsnb), a		;1 phys. Sektor lesen
(1)   46/    DC4C :                     ; Stellen  Sektor-Translate-Tabelle 1,2,3,...
(1)   47/    DC4C : DD E5               		push	ix
(1)   48/    DC4E : 06 1A               		ld	b, 1Ah			;max. Laenge der Tabelle
(1)   49/    DC50 : DD 77 19            seldsk2:	ld	(ix+19h), a
(1)   50/    DC53 : DD 23               		inc	ix
(1)   51/    DC55 : 3C                  		inc	a
(1)   52/    DC56 : 10 F8               		djnz	seldsk2
(1)   53/    DC58 : DD E1               		pop	ix
(1)   54/    DC5A :                     ; Positionieren auf Spur 0 und analysieren Systemspuren
(1)   55/    DC5A : CD 95 DF            		call	dsidtr			;beliebigen Sekt.Id lesen
(1)   56/    DC5D : 20 3E               		jr	nz, seldsk6		;Fehler beim Lesen; Systemsp. annehmen
(1)   57/    DC5F : 7C                  		ld	a, h
(1)   58/    DC60 : 32 57 E1            		ld	(dbslc), a		;setzen Spurformat fuer Sp. 0
(1)   59/    DC63 : 21 52 E1            		ld	hl, dbflg
(1)   60/    DC66 : 46                  		ld	b, (hl)			;merken Fehlerprotokoll-Bit
(1)   61/    DC67 : CB E6               		set	4, (hl)			;kein Fehlerprotokoll
(1)   62/    DC69 : E5                  		push	hl
(1)   63/    DC6A : CD 83 DF            		call	dbtran			;Lesen Spur 0, Sektor 1
(1)   64/    DC6D : E1                  		pop	hl
(1)   65/    DC6E : 70                  		ld	(hl), b			;setzen Standard fuer Fehlerprotokoll-Bit
(1)   66/    DC6F : 20 2C               		jr	nz, seldsk6		;Fehler, Systemspuren annehmen
(1)   67/    DC71 : FD E5               		push	iy
(1)   68/    DC73 : FD 2A 59 E1         		ld	iy, (dbdma)
(1)   69/    DC77 : FD 7E 00            		ld	a, (iy+0)		;Format-Loeschbyte
(1)   70/    DC7A : FE E5               		cp	0E5h			;leere Diskette/geloeschter Eintrag?
(1)   71/    DC7C : 20 0A               		jr	nz, seldsk3		;nein, weder/noch
(1)   72/    DC7E : FD BE 01            		cp	(iy+1)			;auch danach 0e5h?
(1)   73/    DC81 : 20 15               		jr	nz, seldsk4		;nein, geloeschter Dir-Eintrag
(1)   74/    DC83 : DD 35 0D            		dec	(ix+0Dh)		;Flag: leere Disk oder leere Systemsp.
(1)   75/    DC86 : 18 10               		jr	seldsk4			;dpbofs auf 254
(1)   76/    DC88 :                     ;
(1)   77/    DC88 : FE 40               seldsk3:	cp	40h			;IBM-Format (SIOS-Daten-Diskette)?
(1)   78/    DC8A : 28 0F               		jr	z, seldsk5		;ja, 0 Systemspuren annehmen
(1)   79/    DC8C : FE 20               		cp	20h			;<=31 ? ("S"YL ist groesser!)
(1)   80/    DC8E : 30 0B               		jr	nc, seldsk5		;nein, kann kein Directory sein; 0 Systemsp.
(1)   81/    DC90 :                     ;Systemlader fuer PC1715 beginnt mit 02 oder 03
(1)   82/    DC90 : FD 7E 20            		ld	a, (iy+20h)		;bei SCP1715-Systemdiskette dort 00h, bei MicroDos dort 10h
(1)   83/    DC93 : FD B6 21            		or	(iy+21h)		;bei SCP1715-Systemdiskette dort 00h, bei CP/A dort Dir-Eintrag (E5 oder Filename)
(1)   84/    DC96 : 28 03               		jr	z, seldsk5		;beides 00h, kein Directory; 0 Systemsp.
(1)   85/    DC98 : DD 35 0D            seldsk4:	dec	(ix+0Dh)		;=255, wenn Directory; =254 wenn vorn leer
(1)   86/    DC9B : FD E1               seldsk5:	pop	iy
(1)   87/    DC9D :                     
(1)   88/    DC9D :                     seldsk6:
(1)   89/    DC9D :                     ; Analysieren Datenspur
(1)   90/    DC9D :                     
(1)   91/    DC9D :                     ; SS/DS-Analyse
(1)   92/    DC9D : DD 36 12 02         		ld	(ix+12h), 2		;Doppel-Step-Impulse
(1)   93/    DCA1 : 3E 03               		ld	a, 3			;auf LOGIN-Spur
(1)   94/    DCA3 : CD 92 DF            		call	dsidtt			;belieb. SektId Vorderseite lesen
(1)   95/    DCA6 : 20 2B               		jr	nz, seldsk9		;Fehler, unsicheres Format
(1)   96/    DCA8 : 54                  		ld	d, h			;d:=Sektorlcode, e:=Spur
(1)   97/    DCA9 :                     
(1)   98/    DCA9 :                     ;if dskds
(1)   99/    DCA9 : DD CB 18 46         		bit	0, (ix+18h)		;ist es ein DS-Laufwerk?
(1)  100/    DCAD : 28 14               		jr	z, seldsk7		;nein, SS
(1)  101/    DCAF : D5                  		push	de			;merken Sektorlaengencode und Spur
(1)  102/    DCB0 : DD CB 0F EE         		set	5, (ix+0Fh)
(1)  103/    DCB4 : 3E 07               		ld	a, 7			;Rueckseite der Spur, ab der Format bei SS konstant
(1)  104/    DCB6 : CD 92 DF            		call	dsidtt			;beliebigen Sekt.Id Ruecks. lesen
(1)  105/    DCB9 : 7A                  		ld	a, d			;merken side Ruecks.
(1)  106/    DCBA : 6B                  		ld	l, e			;h:=Sektorlcode, l:=Spur Rueckseite
(1)  107/    DCBB : D1                  		pop	de			;wiederherstellen Vorderseite
(1)  108/    DCBC : 20 05               		jr	nz, seldsk7		;Fehler beim Lesen, SS
(1)  109/    DCBE : B7                  		or	a
(1)  110/    DCBF : ED 52               		sbc	hl, de			;Vorder- gleich Rueckseite?
(1)  111/    DCC1 : 28 04               		jr	z, seldsk8		;ja; 40 Tr/ 80 Tr unterscheiden
(1)  112/    DCC3 : DD CB 0F AE         seldsk7:	res	5, (ix+0Fh)
(1)  113/    DCC7 :                     
(1)  114/    DCC7 :                     ; 40/80 Track Analyse
(1)  115/    DCC7 : 7B                  seldsk8:	ld	a, e			;trk
(1)  116/    DCC8 : D6 03               		sub	3			;waren 2 Steps richtig?
(1)  117/    DCCA : 28 12               		jr	z, seldsk10		;ja
(1)  118/    DCCC : DD 35 12            		dec	(ix+12h)		;Einzelstep-Impulse
(1)  119/    DCCF : D6 03               		sub	3			;waere 1 Step richtig?
(1)  120/    DCD1 : 28 0B               		jr	z, seldsk10		;ja
(1)  121/    DCD3 :                     						;nein, unsicher
(1)  122/    DCD3 : DD 36 10 FF         seldsk9:	ld	(ix+10h), 0FFh		;provozieren 'BAD SECTOR'
(1)  123/    DCD7 : 21 00 00            		ld	hl, 0			;erzeugen 'SELECT' Error
(1)  124/    DCDA : E3                  		ex	(sp), hl
(1)  125/    DCDB : C3 CE DD            		jp	seldsk23
(1)  126/    DCDE :                     
(1)  127/    DCDE :                     ; DS/SS und 40/80 ist unterschieden, es fehlt Sektorlaenge
(1)  128/    DCDE : 7A                  seldsk10:	ld	a, d
(1)  129/    DCDF : DD 77 10            		ld	(ix+10h), a		;definieren Sektorlaengencode
(1)  130/    DCE2 : B7                  		or	a			;Sektorlaenge 128?
(1)  131/    DCE3 : 20 0F               		jr	nz, seldsk11		;nein, Puffer reicht nicht
(1)  132/    DCE5 :                     
(1)  133/    DCE5 :                     ; Stellen Sektor-Translate-Tabelle 1,7,13,..
(1)  134/    DCE5 : DD E5               seldsv:		push	ix
(1)  135/    DCE7 : E1                  		pop	hl
(1)  136/    DCE8 : 01 19 00            		ld	bc, 19h
(1)  137/    DCEB : 09                  		add	hl, bc
(1)  138/    DCEC : EB                  		ex	de, hl
(1)  139/    DCED : 21 1C E1            		ld	hl, xlt
(1)  140/    DCF0 : 0E 1A               		ld	c, 1Ah
(1)  141/    DCF2 : ED B0               		ldir
(1)  142/    DCF4 :                     
(1)  143/    DCF4 : CD AF E0            seldsk11:	call	dtrsla			;stellen hl entspr. Sektorlaenge
(1)  144/    DCF7 : 20 DA               		jr	nz, seldsk9		;unzulaessig
(1)  145/    DCF9 : 01 05 00            		ld	bc, 5			;Laenge eines Eintrags
(1)  146/    DCFC : DD CB 12 4E         		bit	1, (ix+12h)		;40 Tr. auf 80er LW?
(1)  147/    DD00 : 20 08               		jr	nz, seldsk12		;ja
(1)  148/    DD02 : DD 7E 16            		ld	a, (ix+16h)		;40er LW?
(1)  149/    DD05 : FE 29               		cp	40+1
(1)  150/    DD07 : 38 01               		jr	c, seldsk12		;ja, 40 Tr. auf 40er LW
(1)  151/    DD09 : 09                  		add	hl, bc			;auf 80er Format stellen
(1)  152/    DD0A : DD CB 0F 6E         seldsk12:	bit	5, (ix+0Fh)		;DS?
(1)  153/    DD0E : 28 02               		jr	z, seldsk13		;nein
(1)  154/    DD10 : 09                  		add	hl, bc			;auf DS Format
(1)  155/    DD11 : 09                  		add	hl, bc
(1)  156/    DD12 :                     
(1)  157/    DD12 :                     ; DPB modifizieren entsprechend erkanntem Format
(1)  158/    DD12 : 4E                  seldsk13:	ld	c, (hl)			;Zahl der benutzten Spuren
(1)  159/    DD13 : DD 71 14            		ld	(ix+14h), c
(1)  160/    DD16 : 23                  		inc	hl
(1)  161/    DD17 : 4E                  		ld	c, (hl)			;Anzahl 128er Sektoren pro Spur
(1)  162/    DD18 : DD 71 00            		ld	(ix+0),	c
(1)  163/    DD1B : 23                  		inc	hl
(1)  164/    DD1C : 4E                  		ld	c, (hl)			;Anzahl der Dir-Eintraege -1
(1)  165/    DD1D : 23                  		inc	hl
(1)  166/    DD1E : 7E                  		ld	a, (hl)			;Anzahl der Systemspuren
(1)  167/    DD1F : CB 3F               		srl	a			;feste Anzahl erzwungen?
(1)  168/    DD21 : 38 28               		jr	c, seldsk15		;ja
(1)  169/    DD23 : DD CB 0D 7E         		bit	7, (ix+0Dh)		;kann Spur 0 Directory sein?
(1)  170/    DD27 : 28 22               		jr	z, seldsk15		;nein, Standardanzahl setzen
(1)  171/    DD29 : DD 34 0D            		inc	(ix+0Dh)		;evtl. leere Systemspur?
(1)  172/    DD2C : 28 1C               		jr	z, seldsk14		;nein, 0 Systemspuren
(1)  173/    DD2E : 47                  		ld	b, a			;retten Anzahl Systemspuren
(1)  174/    DD2F : 32 54 E1            		ld	(dbtrk), a		;einlesen evtl. moeglicher Datenbeginn
(1)  175/    DD32 : E5                  		push	hl
(1)  176/    DD33 : CD 83 DF            		call	dbtran			; dauert bei falscher Spur etwas laenger
(1)  177/    DD36 : E1                  		pop	hl
(1)  178/    DD37 : 78                  		ld	a, b
(1)  179/    DD38 : 20 11               		jr	nz, seldsk15		;Fehler, mit Systemspuren annehmen
(1)  180/    DD3A : FD E5               		push	iy
(1)  181/    DD3C : FD 2A 59 E1         		ld	iy, (dbdma)
(1)  182/    DD40 : FD 7E 0E            		ld	a, (iy+0Eh)		;falls dort Dir, so Byte 14 von Dir =0
(1)  183/    DD43 : FE E5               		cp	0E5h			;Daten auch leer?
(1)  184/    DD45 : FD E1               		pop	iy
(1)  185/    DD47 : 78                  		ld	a, b
(1)  186/    DD48 : 20 01               		jr	nz, seldsk15		;nein, vorn liegen nichtbelegte Systemspuren
(1)  187/    DD4A : AF                  seldsk14:	xor	a			;sonst ohne Systemspuren
(1)  188/    DD4B : DD 77 0D            seldsk15:	ld	(ix+0Dh), a
(1)  189/    DD4E : B7                  		or	a			;0 Systemspuren?
(1)  190/    DD4F : 28 07               		jr	z, seldsk16		;ja
(1)  191/    DD51 : 79                  		ld	a, c			;Anzahl Dir-Eintraege -1
(1)  192/    DD52 : FE BF               		cp	192-1			;>=192 Dir-Eintraege ?
(1)  193/    DD54 : 38 02               		jr	c, seldsk16		;nein
(1)  194/    DD56 : 0E 7F               		ld	c, 128-1		;780k hat 128 Dir-Eintraege
(1)  195/    DD58 : DD 71 07            seldsk16:	ld	(ix+7),	c
(1)  196/    DD5B : 23                  		inc	hl
(1)  197/    DD5C : 4E                  		ld	c, (hl)			;Abstand der Blockgroessentab.
(1)  198/    DD5D : 06 00               		ld	b, 0
(1)  199/    DD5F : 09                  		add	hl, bc			;auf Blockgroessentabelle
(1)  200/    DD60 : 4E                  		ld	c, (hl)
(1)  201/    DD61 : DD 71 02            		ld	(ix+2),	c
(1)  202/    DD64 : 23                  		inc	hl
(1)  203/    DD65 : 4E                  		ld	c, (hl)
(1)  204/    DD66 : DD 71 03            		ld	(ix+3),	c
(1)  205/    DD69 : 23                  		inc	hl
(1)  206/    DD6A : 4E                  		ld	c, (hl)
(1)  207/    DD6B : DD 71 04            		ld	(ix+4),	c
(1)  208/    DD6E :                     
(1)  209/    DD6E :                     ; Bestimmen Zahl der abweichenden 128er-Sektoren ab Spur 0
(1)  210/    DD6E : AF                  		xor	a
(1)  211/    DD6F : 32 4D E1            		ld	(dfrmtr), a		;ab Spur 0
(1)  212/    DD72 :                     						;(gleichz. Spurkorr. bei falschen Doppelstepimpulsen)
(1)  213/    DD72 : CD 95 DF            seldsk17:	call	dsidtr			;beliebigen SektId lesen
(1)  214/    DD75 : 20 18               		jr	nz, seldsk18		;Fehler
(1)  215/    DD77 : 7C                  		ld	a, h			;Sektorlaenge
(1)  216/    DD78 : DD BE 10            		cp	(ix+10h)		;gleich Disketten-Rest?
(1)  217/    DD7B : 28 12               		jr	z, seldsk18		;ja
(1)  218/    DD7D : DD 7E 0F            		ld	a, (ix+0Fh)
(1)  219/    DD80 : E6 03               		and	3			;bisherige Anzahl abweichender Spuren
(1)  220/    DD82 : FE 03               		cp	3			;Zaehler voll?
(1)  221/    DD84 : 28 09               		jr	z, seldsk18		;ja
(1)  222/    DD86 : DD 34 0F            		inc	(ix+0Fh)		;erhoehen abweich. Spurzahl
(1)  223/    DD89 : 21 4D E1            		ld	hl, dfrmtr		;naechste (logische!) Spur
(1)  224/    DD8C : 34                  		inc	(hl)
(1)  225/    DD8D : 18 E3               		jr	seldsk17
(1)  226/    DD8F :                     
(1)  227/    DD8F :                     seldsk18:
(1)  228/    DD8F :                     ; Setzen Anzahl der logischen 128er Rekords im Puffer -1
(1)  229/    DD8F :                     ; Es wird immer das Maximum gesetzt, dies setzt eine dichte
(1)  230/    DD8F :                     ; Sektorfolge beim Transfer voraus! (so in dpbstr)
(1)  231/    DD8F : DD 36 11 07         		ld	(ix+11h), 7
(1)  232/    DD93 :                     
(1)  233/    DD93 :                     ; Berechnen Speicherkapazitaet-1 in BDOS-Bloecken aus
(1)  234/    DD93 :                     ; ((Tracks-dpbofs)*dpbspt/(2**dpbbls))-1
(1)  235/    DD93 : DD 6E 14            		ld	l, (ix+14h)
(1)  236/    DD96 : AF                  		xor	a
(1)  237/    DD97 : 67                  		ld	h, a			;hl:=log. Spurzahl
(1)  238/    DD98 : DD 5E 0D            		ld	e, (ix+0Dh)
(1)  239/    DD9B : 57                  		ld	d, a			;de:=log. offset-Spurzahl
(1)  240/    DD9C : ED 52               		sbc	hl, de
(1)  241/    DD9E : EB                  		ex	de, hl			;de:=log. Daten-Spurzahl
(1)  242/    DD9F : 6F                  		ld	l, a			;hl:=0
(1)  243/    DDA0 : DD 46 00            		ld	b, (ix+0)
(1)  244/    DDA3 : 19                  seldsk19:	add	hl, de
(1)  245/    DDA4 : 10 FD               		djnz	seldsk19		;hl:=(tracks-dpbofs)*dpbspt
(1)  246/    DDA6 : DD 46 02            		ld	b, (ix+2)
(1)  247/    DDA9 : CB 3C               seldsk20:	srl	h
(1)  248/    DDAB : CB 1D               		rr	l
(1)  249/    DDAD : 10 FA               		djnz	seldsk20
(1)  250/    DDAF : 2B                  		dec	hl
(1)  251/    DDB0 : DD 75 05            		ld	(ix+5),	l
(1)  252/    DDB3 : DD 74 06            		ld	(ix+6),	h
(1)  253/    DDB6 : DD 7E 07            		ld	a, (ix+7)		;Dir-Groesse
(1)  254/    DDB9 : 3C                  		inc	a
(1)  255/    DDBA : 0F                  		rrca
(1)  256/    DDBB : 0F                  		rrca				;div 4, da 4 Dir-Eintr. /Sekt.
(1)  257/    DDBC : DD 77 0B            		ld	(ix+0Bh), a		;ist Sektorzahl = Check size
(1)  258/    DDBF : DD 46 02            		ld	b, (ix+2)		;block shift
(1)  259/    DDC2 : 0F                  seldsk21:	rrca				;BDOS-Bloecke fuer Dir.
(1)  260/    DDC3 : 10 FD               		djnz	seldsk21
(1)  261/    DDC5 : 47                  		ld	b, a
(1)  262/    DDC6 : AF                  		xor	a
(1)  263/    DDC7 : 37                  seldsk22:	scf				;Allocation-Bits fuer Dir.
(1)  264/    DDC8 : 1F                  		rra
(1)  265/    DDC9 : 10 FC               		djnz	seldsk22
(1)  266/    DDCB : DD 77 09            		ld	(ix+9),	a
(1)  267/    DDCE :                     
(1)  268/    DDCE : E1                  seldsk23:	pop	hl			;hl auf DPH
(1)  269/    DDCF : C9                  		ret				;Return Seldsk
(1)  270/    DDD0 :                     
(1)  271/    DDD0 :                     ;-----------------------------------------------------------------------------
(1)  272/    DDD0 :                     ; home
(1)  273/    DDD0 :                     ; auf Spur 0 zurueck (vor jedem Dir-Zugriff)
(1)  274/    DDD0 :                     ;-----------------------------------------------------------------------------
(1)  275/    DDD0 :                     
(1)  276/    DDD0 : 21 52 E1            home:		ld	hl, dbflg
(1)  277/    DDD3 : CB 56               		bit	2, (hl)			;veraenderter Puffer?
(1)  278/    DDD5 : 20 05               		jr	nz, home1		;ja, nicht freigeben
(1)  279/    DDD7 : 3E FF               		ld	a, 0FFh			;sonst Diskwechsel erlauben
(1)  280/    DDD9 : 32 53 E1            		ld	(dbdev), a		;Puffer ist nicht aktiv
(1)  281/    DDDC :                     
(1)  282/    DDDC :                     ;-----------------------------------------------------------------------------
(1)  283/    DDDC :                     ; settrk
(1)  284/    DDDC :                     ; Einstellen Spur in Reg. BC
(1)  285/    DDDC :                     ;-----------------------------------------------------------------------------
(1)  286/    DDDC :                     
(1)  287/    DDDC : 01 00 00            home1:		ld	bc, 0
(1)  288/    DDDF : ED 43 5D E1         settrk:		ld	(dtrack), bc
(1)  289/    DDE3 : C9                  		ret
(1)  290/    DDE4 :                     		
(1)  291/    DDE4 :                     ;-----------------------------------------------------------------------------
(1)  292/    DDE4 :                     ; Einstellen Sektor in Reg. C
(1)  293/    DDE4 :                     ;-----------------------------------------------------------------------------
(1)  294/    DDE4 : 79                  setsec:		ld	a, c
(1)  295/    DDE5 : 32 5F E1            		ld	(dsectr), a
(1)  296/    DDE8 : C9                  		ret
(1)  297/    DDE9 :                     
(1)  298/    DDE9 :                     ;-----------------------------------------------------------------------------
(1)  299/    DDE9 :                     ; Einstellen DMA in Reg. BC
(1)  300/    DDE9 :                     ;-----------------------------------------------------------------------------
(1)  301/    DDE9 : ED 43 DE E5         setdma:		ld	(ddma), bc
(1)  302/    DDED : C9                  		ret
(1)  303/    DDEE :                     
(1)  304/    DDEE :                     		
(1)  305/    DDEE :                     		
(1)  306/    DDEE :                     ;-----------------------------------------------------------------------------
(1)  307/    DDEE :                     ; Uebersetzung Sektornummer
(1)  308/    DDEE :                     ; Translate-Tab-Adr. in DE, Eingangs-Sektornummer in BC,
(1)  309/    DDEE :                     ;			    Ausgangs-Sektornummer in HL
(1)  310/    DDEE :                     ; Es wird keine Translate-Tabelle benutzt, da die Sektor-
(1)  311/    DDEE :                     ; nummernverwaltung verallgemeinert im nicht-Standard-DPB
(1)  312/    DDEE :                     ; enthalten ist (auch fuer physische Sektorlaenge <>128)
(1)  313/    DDEE :                     ;-----------------------------------------------------------------------------
(1)  314/    DDEE : 60                  sectran:	ld	h, b
(1)  315/    DDEF : 69                  		ld	l, c
(1)  316/    DDF0 : 23                  		inc	hl		;Sektoren zaehlen in CP/A ab 1
(1)  317/    DDF1 : C9                  		ret
(1)  318/    DDF2 :                     
(1)  319/    DDF2 :                     ; Ermitteln DPH und DPB von (c) nach HL bzw. IX
(1)  320/    DDF2 :                     ; ret z		DPH existiert nicht, HL=0
(1)  321/    DDF2 :                     ; ret nz	ok, HL auf DPH, IX auf DPB
(1)  322/    DDF2 :                     ; BC,DE bleibt erhalten
(1)  323/    DDF2 : D5                  dgetpb:		push	de
(1)  324/    DDF3 : 21 00 00            		ld	hl, 0
(1)  325/    DDF6 : 79                  		ld	a, c
(1)  326/    DDF7 : FE 02               		cp	2		; nur LW 0 und 1 erlaubt
(1)  327/    DDF9 : 30 16               		jr	nc, dgetpb1 	; sonst Abbruch
(1)  328/    DDFB : EB                  		ex	de, hl		; DE = 0
(1)  329/    DDFC : 21 56 E5            		ld	hl, dphtab	; Adresstabelle fuer DPH's
(1)  330/    DDFF : 59                  		ld	e, c
(1)  331/    DE00 : 19                  		add	hl, de
(1)  332/    DE01 : 19                  		add	hl, de
(1)  333/    DE02 : 7E                  		ld	a, (hl)
(1)  334/    DE03 : 23                  		inc	hl
(1)  335/    DE04 : 66                  		ld	h, (hl)
(1)  336/    DE05 : 6F                  		ld	l, a		; HL=Adr. zum LW gehÃ¶riger DPH
(1)  337/    DE06 : E5                  		push	hl
(1)  338/    DE07 : 1E 0A               		ld	e, 10
(1)  339/    DE09 : 19                  		add	hl, de
(1)  340/    DE0A : 5E                  		ld	e, (hl)
(1)  341/    DE0B : 23                  		inc	hl
(1)  342/    DE0C : 56                  		ld	d, (hl)		; de:=^dpb
(1)  343/    DE0D : D5                  		push	de
(1)  344/    DE0E : DD E1               		pop	ix		; IX=Adr. zugehÃ¶riger DPB
(1)  345/    DE10 : E1                  		pop	hl
(1)  346/    DE11 : D1                  dgetpb1:	pop	de
(1)  347/    DE12 : 7C                  		ld	a, h
(1)  348/    DE13 : B5                  		or	l		; ret z bei hl=0
(1)  349/    DE14 : C9                  		ret
(1)  350/    DE15 :                     
(1)  351/    DE15 :                     ;-----------------------------------------------------------------------------
(1)  352/    DE15 :                     ; Schreiben Sektor
(1)  353/    DE15 :                     ; Register C (vom BDOS gestellt):
(1)  354/    DE15 :                     ;	=0, wenn normales write
(1)  355/    DE15 :                     ;	=1, wenn directory-write (sofort ausgeben)
(1)  356/    DE15 :                     ;	=2, wenn Beginn eines neuen Datenblocks (kein preread)
(1)  357/    DE15 :                     ;-----------------------------------------------------------------------------
(1)  358/    DE15 : 59                  write:		ld	e, c			;retten Reg. C
(1)  359/    DE16 : 3A 5C E1            		ld	a, (ddrive)
(1)  360/    DE19 : 4F                  		ld	c, a
(1)  361/    DE1A : CD F2 DD            		call	dgetpb			;ix:=dpb(ddrive)
(1)  362/    DE1D : 28 57               		jr	z, drwerr		;Geraet ex. nicht
(1)  363/    DE1F :                     
(1)  364/    DE1F : 21 5B E1            		ld	hl, dflg
(1)  365/    DE22 : CB D6               		set	2, (hl)			;Write-Flag setzen
(1)  366/    DE24 : 21 52 E1            		ld	hl, dbflg
(1)  367/    DE27 : CB C6               		set	0, (hl)			;Annahme preread notwendig
(1)  368/    DE29 : 7B                  		ld	a, e			;A:= Write-Typ
(1)  369/    DE2A : 32 67 E1            		ld	(dwrtyp), a		;merken Write-Typ
(1)  370/    DE2D : FE 02               		cp	2			;write to unallocated?
(1)  371/    DE2F : 20 17               		jr	nz, write1		;nein
(1)  372/    DE31 : DD 7E 03            		ld	a, (ix+3)		;Zahl der 128-Sekt. im Block -1
(1)  373/    DE34 : 3C                  		inc	a
(1)  374/    DE35 : 32 62 E1            		ld	(unacnt), a		;fuer diese Sekt. kein preread
(1)  375/    DE38 : 21 63 E1            		ld	hl, unadev
(1)  376/    DE3B : 71                  		ld	(hl), c
(1)  377/    DE3C : 3A 5D E1            		ld	a, (dtrack)
(1)  378/    DE3F : 32 64 E1            		ld	(unatrk), a
(1)  379/    DE42 : 3A 5F E1            		ld	a, (dsectr)
(1)  380/    DE45 : 32 65 E1            		ld	(unasec), a
(1)  381/    DE48 :                     
(1)  382/    DE48 :                     
(1)  383/    DE48 : 21 62 E1            write1:		ld	hl, unacnt
(1)  384/    DE4B : 7E                  		ld	a, (hl)
(1)  385/    DE4C : B7                  		or	a			;noch nicht geschr. Sekt. da?
(1)  386/    DE4D : 28 42               		jr	z, alloc		;nein
(1)  387/    DE4F : 3D                  		dec	a			;sonst Restzahl -1
(1)  388/    DE50 : 77                  		ld	(hl), a
(1)  389/    DE51 : 23                  		inc	hl
(1)  390/    DE52 : 79                  		ld	a, c
(1)  391/    DE53 : BE                  		cp	(hl)			;gleiches Geraet?
(1)  392/    DE54 : 20 3B               		jr	nz, alloc		;nein
(1)  393/    DE56 : 23                  		inc	hl
(1)  394/    DE57 : 3A 5D E1            		ld	a, (dtrack)
(1)  395/    DE5A : BE                  		cp	(hl)			;gleiche Spur?
(1)  396/    DE5B : 20 34               		jr	nz, alloc		;nein
(1)  397/    DE5D :                     
(1)  398/    DE5D : 23                  		inc	hl
(1)  399/    DE5E : 3A 5F E1            		ld	a, (dsectr)
(1)  400/    DE61 : BE                  		cp	(hl)			;gleicher Sektor?
(1)  401/    DE62 : 20 2D               		jr	nz, alloc		;nein
(1)  402/    DE64 :                     ; Vorbereiten naechsten unalloc write-Aufruf
(1)  403/    DE64 : DD BE 00            		cp	(ix+0)			;neue Spur?
(1)  404/    DE67 : 38 04               		jr	c, write2		;nein
(1)  405/    DE69 :                     
(1)  406/    DE69 : 2B                  		dec	hl
(1)  407/    DE6A : 34                  		inc	(hl)			;unatrk +1
(1)  408/    DE6B : 23                  		inc	hl
(1)  409/    DE6C :                     
(1)  410/    DE6C : AF                  		xor	a			;Sektor auf Spuranfang
(1)  411/    DE6D : 3C                  write2:		inc	a			;naechster Sektor
(1)  412/    DE6E : 77                  		ld	(hl), a
(1)  413/    DE6F : 21 52 E1            		ld	hl, dbflg
(1)  414/    DE72 : CB 86               		res	0, (hl)			;anzeigen kein preread notw.
(1)  415/    DE74 : 18 1F               		jr	drw
(1)  416/    DE76 :                     
(1)  417/    DE76 :                     ; Abbruch read/write mit E/A-Fehler
(1)  418/    DE76 : 3E 01               drwerr:		ld	a, 1
(1)  419/    DE78 : C9                  		ret
(1)  420/    DE79 :                     
(1)  421/    DE79 :                     ;-----------------------------------------------------------------------------
(1)  422/    DE79 :                     ; Lesen Sektor
(1)  423/    DE79 :                     ;-----------------------------------------------------------------------------
(1)  424/    DE79 : 3A 5C E1            read:		ld	a, (ddrive)
(1)  425/    DE7C : 4F                  		ld	c, a
(1)  426/    DE7D : CD F2 DD            		call	dgetpb			;ix:=dpb(ddrive)
(1)  427/    DE80 : 28 F4               		jr	z, drwerr		;Geraet ex. nicht
(1)  428/    DE82 : 21 5B E1            		ld	hl, dflg
(1)  429/    DE85 : CB 96               		res	2, (hl)			;Lesen anzeigen
(1)  430/    DE87 : 21 52 E1            		ld	hl, dbflg
(1)  431/    DE8A : CB C6               		set	0, (hl)			;preread notwendig
(1)  432/    DE8C : 3E 02               		ld	a, 2
(1)  433/    DE8E : 32 67 E1            		ld	(dwrtyp), a
(1)  434/    DE91 :                     
(1)  435/    DE91 : AF                  alloc:		xor	a
(1)  436/    DE92 : 32 62 E1            		ld	(unacnt), a		;Ende unalloc
(1)  437/    DE95 :                     
(1)  438/    DE95 :                     ; gemeinsamer Zweig read/write Floppy
(1)  439/    DE95 : 3A 5F E1            drw:		ld	a, (dsectr)		;Sektornummer in 1..dpbspt ?
(1)  440/    DE98 : 3D                  		dec	a			;ab 0 zaehlen
(1)  441/    DE99 : FA 76 DE            		jp	m, drwerr		;<0, Fehler
(1)  442/    DE9C : DD BE 00            		cp	(ix+0)			;<dpbspt?
(1)  443/    DE9F : 30 D5               		jr	nc, drwerr		;nein, Fehler
(1)  444/    DEA1 : 47                  		ld	b, a			;retten dsectr-1
(1)  445/    DEA2 : DD 7E 0F            		ld	a, (ix+0Fh)
(1)  446/    DEA5 : E6 03               		and	3			;Anzahl der abweich. 128er Spuren
(1)  447/    DEA7 :                     
(1)  448/    DEA7 : 57                  		ld	d, a
(1)  449/    DEA8 : 3A 5D E1            		ld	a, (dtrack)		;verlangte Spur
(1)  450/    DEAB : BA                  		cp	d			;im abweichenden Spurformat?
(1)  451/    DEAC :                     
(1)  452/    DEAC : DA 9A DF            		jp	c, drwsec		;ja, Sektorlaenge 128
(1)  453/    DEAF :                     
(1)  454/    DEAF : DD 7E 10            		ld	a, (ix+10h)		;phys. Sektorlaenge 128?
(1)  455/    DEB2 : B7                  		or	a			;d.h. mit Sektorversatz?
(1)  456/    DEB3 : CA 9A DF            		jp	z, drwsec		;ja, keine Pufferung sinnvoll
(1)  457/    DEB6 :                     
(1)  458/    DEB6 : 78                  		ld	a, b
(1)  459/    DEB7 : DD 56 11            		ld	d, (ix+11h)		;Puffermaske
(1)  460/    DEBA : A2                  		and	d			;rel. Sekt.nr. des BDOS-Blocks zum Puff.anf.
(1)  461/    DEBB : F5                  		push	af			;merken fuer move
(1)  462/    DEBC : A8                  		xor	b			;a ist Sektornr. des Puff.anf.
(1)  463/    DEBD : CB 3F               drwbnr:		srl	a			;ermitteln Puffernr in Spur
(1)  464/    DEBF : CB 1A               		rr	d			;noch Bits in Puffermaske?
(1)  465/    DEC1 : 20 FA               		jr	nz, drwbnr		;ja
(1)  466/    DEC3 :                     ; Test, ob dieser Puffer da ist
(1)  467/    DEC3 : F5                  		push	af			;merken Puffernummer
(1)  468/    DEC4 : 21 66 E1            		ld	hl, dbnb
(1)  469/    DEC7 : BE                  		cp	(hl)			;richtige Puffernummer?
(1)  470/    DEC8 : 20 0F               		jr	nz, dbn			;nein
(1)  471/    DECA :                     
(1)  472/    DECA : 21 54 E1            		ld	hl, dbtrk
(1)  473/    DECD : 3A 5D E1            		ld	a, (dtrack)		;geforderte Spur
(1)  474/    DED0 : BE                  		cp	(hl)			;richtige Spur?
(1)  475/    DED1 :                     
(1)  476/    DED1 : 20 06               		jr	nz, dbn
(1)  477/    DED3 : 3A 53 E1            		ld	a, (dbdev)		;zum Puffer gehoeriges Geraet
(1)  478/    DED6 : B9                  		cp	c			;richtiges Geraet?
(1)  479/    DED7 : 28 6C               		jr	z, dbmat		;ja, Sektor steht im Puffer
(1)  480/    DED9 :                     
(1)  481/    DED9 : C5                  dbn:		push	bc			;retten ddrive
(1)  482/    DEDA : CD 7D DF            		call	dbtrw			;veraenderten Puffer ausgeben
(1)  483/    DEDD : C1                  		pop	bc			;c:=ddrive
(1)  484/    DEDE : 21 53 E1            		ld	hl, dbdev
(1)  485/    DEE1 : 71                  		ld	(hl), c
(1)  486/    DEE2 :                     
(1)  487/    DEE2 : 3A 5D E1            		ld	a, (dtrack)
(1)  488/    DEE5 : 32 54 E1            		ld	(dbtrk), a
(1)  489/    DEE8 :                     
(1)  490/    DEE8 :                     
(1)  491/    DEE8 : CD F2 DD            		call	dgetpb			;ix:=dpb(c)
(1)  492/    DEEB : DD 46 10            		ld	b, (ix+10h)
(1)  493/    DEEE : 21 57 E1            		ld	hl, dbslc
(1)  494/    DEF1 : 70                  		ld	(hl), b
(1)  495/    DEF2 : DD 7E 11            		ld	a, (ix+11h)		;Zahl der 128er Sektoren -1
(1)  496/    DEF5 : 3C                  		inc	a
(1)  497/    DEF6 : 87                  		add	a, a			;CY:=0
(1)  498/    DEF7 : 04                  		inc	b			;fuer djnz, falls dpbslc=0
(1)  499/    DEF8 : 0F                  dbsnbz:		rrca				;Zahl der phys. Sekt. im Puff.
(1)  500/    DEF9 : 10 FD               		djnz	dbsnbz
(1)  501/    DEFB : 57                  		ld	d, a			;merken
(1)  502/    DEFC : AF                  		xor	a
(1)  503/    DEFD : C1                  		pop	bc			;b:=geforderte Puffernr.
(1)  504/    DEFE : C5                  		push	bc
(1)  505/    DEFF : 21 66 E1            		ld	hl, dbnb
(1)  506/    DF02 : 70                  		ld	(hl), b
(1)  507/    DF03 : 04                  		inc	b
(1)  508/    DF04 : 05                  		dec	b			;Puffernr. 0?
(1)  509/    DF05 : 28 03               		jr	z, dbsec0		;ja
(1)  510/    DF07 : 82                  dbsecz:		add	a, d			;0. phys. Sekt. im Puffer
(1)  511/    DF08 : 10 FD               		djnz	dbsecz			;=dbsnb.*Puffernr.
(1)  512/    DF0A : 5F                  dbsec0:		ld	e, a			;merken Pufferanf.-Sektor
(1)  513/    DF0B : DD 46 10            		ld	b, (ix+10h)
(1)  514/    DF0E : DD 7E 00            		ld	a, (ix+0)
(1)  515/    DF11 : 04                  		inc	b			;wegen djnz
(1)  516/    DF12 : 87                  		add	a, a
(1)  517/    DF13 : CB 3F               dbsecm:		srl	a			;phys. Sektoranzahl
(1)  518/    DF15 : 10 FC               		djnz	dbsecm
(1)  519/    DF17 : 93                  		sub	e			;Restsektorzahl auf Spur
(1)  520/    DF18 : BA                  		cp	d			;>= Zahl zu transferierender?
(1)  521/    DF19 : 30 01               		jr	nc, dbseco		;ja
(1)  522/    DF1B : 57                  		ld	d, a			;sonst nur Restsektorzahl
(1)  523/    DF1C : 1C                  dbseco:		inc	e			;Sektoren zaehlen ab 1
(1)  524/    DF1D : 7B                  		ld	a, e
(1)  525/    DF1E : 32 56 E1            		ld	(dbsec), a		;Sektor
(1)  526/    DF21 : 7A                  		ld	a, d
(1)  527/    DF22 : 32 58 E1            		ld	(dbsnb), a		;Sektorzahl
(1)  528/    DF25 : 21 52 E1            		ld	hl, dbflg
(1)  529/    DF28 : CB 96               		res	2, (hl)
(1)  530/    DF2A : CB 46               		bit	0, (hl)			;muss neuer Puffer gel. werden?
(1)  531/    DF2C : 20 14               		jr	nz, dbprr		;ja
(1)  532/    DF2E :                     ; nur dann kein preread, wenn Rest BDOS-Block >= phys. Puff.
(1)  533/    DF2E :                     ; und Rest BDOS-Block auf Pufferanfang beginnt
(1)  534/    DF2E : 3A 62 E1            		ld	a, (unacnt)
(1)  535/    DF31 : DD BE 11            		cp	(ix+11h)		;Restzahl-1 >= Puffergr.-1 ?
(1)  536/    DF34 : 38 0C               		jr	c, dbprr		;nein, preread
(1)  537/    DF36 : 3A 5F E1            		ld	a, (dsectr)		;Sektornr.
(1)  538/    DF39 : 3D                  		dec	a			;ab 0 zaehlen
(1)  539/    DF3A : DD A6 11            		and	(ix+11h)		;rel. Sekt.nr. des BDOS-Blocks zum Pufferanfang
(1)  540/    DF3D : 20 03               		jr	nz, dbprr
(1)  541/    DF3F : 32 68 E1            		ld	(dberrf), a		;fehlerfrei gel. anzeigen
(1)  542/    DF42 : C4 83 DF            dbprr:		call	nz, dbtran		;Puffer lesen
(1)  543/    DF45 :                     
(1)  544/    DF45 :                     ; Sektor in/aus Puffer holen
(1)  545/    DF45 : F1                  dbmat:		pop	af			;Puffernr. in Spur wegschm.
(1)  546/    DF46 : F1                  		pop	af			;128-er Index im Puffer
(1)  547/    DF47 : F5                  		push	af
(1)  548/    DF48 : 1F                  		rra				;Sektornb*128 berechnen
(1)  549/    DF49 : 47                  		ld	b, a
(1)  550/    DF4A : 0E 00               		ld	c, 0
(1)  551/    DF4C : CB 19               		rr	c
(1)  552/    DF4E : 21 A4 E7            		ld	hl, fdcbuffer
(1)  553/    DF51 : 09                  		add	hl, bc			;Adresse im Puffer
(1)  554/    DF52 : 11 24 E7            		ld	de, rwbuffer	;--> in CPA: ld	de,(ddma)	;Nutzer-DMA
(1)  555/    DF55 : 3A 5B E1            		ld	a, (dflg)
(1)  556/    DF58 : CB 57               		bit	2, a			;Schreiben?
(1)  557/    DF5A : 28 09               		jr	z, dsmove		;nein
(1)  558/    DF5C : 3A 52 E1            		ld	a, (dbflg)
(1)  559/    DF5F : CB D7               		set	2, a			;anzeigen Puffer beschrieben
(1)  560/    DF61 : 32 52 E1            		ld	(dbflg), a
(1)  561/    DF64 : EB                  		ex	de, hl
(1)  562/    DF65 : 01 80 00            dsmove:		ld	bc, 128
(1)  563/    DF68 : CD 69 E1            		call	flldir
(1)  564/    DF6B : F1                  		pop	af			;128-Index im Puffer
(1)  565/    DF6C : DD BE 11            		cp	(ix+11h)		;letzter Sektor im Puffer
(1)  566/    DF6F : 28 05               		jr	z, dmovew		;ja, Puffer ausgeben
(1)  567/    DF71 : 3A 67 E1            		ld	a, (dwrtyp)
(1)  568/    DF74 : FE 01               		cp	1			;write to directory?
(1)  569/    DF76 : CC 7D DF            dmovew:		call	z, dbtrw		;ja, veraend. Puffer ausgeben
(1)  570/    DF79 : 3A 68 E1            		ld	a, (dberrf)		;Ergebnis letztes dbtran
(1)  571/    DF7C : C9                  		ret
(1)  572/    DF7D :                     
(1)  573/    DF7D :                     
(1)  574/    DF7D :                     
(1)  575/    DF7D :                     ; Schreiben Puffer, wenn notw.
(1)  576/    DF7D : 21 52 E1            dbtrw:		ld	hl, dbflg
(1)  577/    DF80 : CB 56               		bit	2, (hl)			;Puffer veraendert?
(1)  578/    DF82 : C8                  		ret	z			;nein, Schreiben unterdruecken
(1)  579/    DF83 :                     
(1)  580/    DF83 :                     ; gemeinsamer Zweig Lesen/Schreiben Puffer
(1)  581/    DF83 : 21 52 E1            dbtran:		ld	hl, dbflg
(1)  582/    DF86 : CD 9D DF            		call	dsktra
(1)  583/    DF89 : 32 68 E1            		ld	(dberrf), a		;Fehlerflag stellen
(1)  584/    DF8C : 21 52 E1            		ld	hl, dbflg
(1)  585/    DF8F : CB 96               		res	2, (hl)			;Puffer ist nicht beschrieben
(1)  586/    DF91 : C9                  		ret
(1)  587/    DF92 :                     
(1)  588/    DF92 :                     ; Lesen beliebigen Sektor-Id.
(1)  589/    DF92 : 32 4D E1            dsidtt:		ld	(dfrmtr), a		;Eingang fuer Spur in A
(1)  590/    DF95 : 21 4B E1            dsidtr:		ld	hl, dfrcdb
(1)  591/    DF98 : 18 03               		jr	dsktra
(1)  592/    DF9A :                     
(1)  593/    DF9A :                     ; gemeinsamer Zweig Read/Write 128-Sektor einzeln
(1)  594/    DF9A : 21 5B E1            drwsec:		ld	hl, dflg
(1)  595/    DF9D :                     
(1)  596/    DF9D :                     ;*********************************************************
(1)  597/    DF9D :                     ; Umkleidung des physischen Disketten-Transfers
(1)  598/    DF9D :                     ;*********************************************************
(1)  599/    DF9D :                     
(1)  600/    DF9D :                     ; Parameter: HL auf CDB mit folgender Struktur:
(1)  601/    DF9D :                     ; +0: cdbfl	;Flags	(Struktur angepasst an ft.kom)
(1)  602/    DF9D : =0H                 diof00	equ	0	;** frei fuer Anw. ** (frueher Verify nach Schreiben)
(1)  603/    DF9D : =1H                 diofid	equ	1	;fest	;=1, wenn nur Sektid. zu lesen
(1)  604/    DF9D : =2H                 diofwr	equ	2	;fest	;=1, wenn Schreiben
(1)  605/    DF9D : =3H                 dioffm	equ	3	;fest	;=1, wenn temporaer FM-Format erzwungen
(1)  606/    DF9D : =4H                 dioftr	equ	4		;=1, wenn keine Fehlermeldung (und -behandlg)
(1)  607/    DF9D : =5H                 diofhd	equ	5		;=1, wenn Kopf hochnehmen ("noerr")
(1)  608/    DF9D : =6H                 diofps	equ	6		;=1, wenn trk,sid,sec schon physisch
(1)  609/    DF9D : =7H                 diofs1	equ	7	;fest	;=1, wenn Rueckseite
(1)  610/    DF9D :                     
(1)  611/    DF9D :                     ; ab hier unwichtig bei "diofhd" in cdbfl =1 (noerr)
(1)  612/    DF9D :                     ; +1: cdbdev	;logisches Geraet 0 .. dphnb-1
(1)  613/    DF9D :                     ; +2: cdbtrk	;log./phys. Spur
(1)  614/    DF9D :                     ; +3: cdbsid	;bel./phys. Seite
(1)  615/    DF9D :                     ; +4: cdbsec	;log./phys. Sektor
(1)  616/    DF9D :                     ; +5: cdbslc	;Sektorlaengencode (0=128, 1=256, 2=512, 3=1024)
(1)  617/    DF9D :                     ; +6: cdbsnb	;Anz. zu uebertr. ph. Sekt. (wenn =0, so nur position.)
(1)  618/    DF9D :                     ; ab hier nur wichtig, wenn "diofid" in cdbfl =0:
(1)  619/    DF9D :                     ; +7,8: cdbdma	;Transferadresse
(1)  620/    DF9D :                     
(1)  621/    DF9D :                     ; Return, falls nicht "diofhd" in cdbfl =1:
(1)  622/    DF9D :                     ;	A=0 (ret z) bei fehlerfrei, sonst A=1 (ret nz) bei cdbfl, "dioftr" =0
(1)  623/    DF9D :                     ;	oder Returncode phys. Transfer
(1)  624/    DF9D :                     ;	E:=trk, D:=sid ,L:=sec, H:=len
(1)  625/    DF9D :                     ;	BC,IX unveraendert
(1)  626/    DF9D :                     
(1)  627/    DF9D :                     
(1)  628/    DF9D : C5                  dsktra:		push	bc
(1)  629/    DF9E : 11 6C E1            		ld	de, diocdb		;CDB des Nutzers auf internen Hilfsspeicher
(1)  630/    DFA1 : 01 09 00            		ld	bc, 9			;da modifiziert
(1)  631/    DFA4 : D5                  		push	de
(1)  632/    DFA5 : CD 69 E1            		call	flldir			;falls Original im ROM-Adressbereich
(1)  633/    DFA8 : E1                  		pop	hl			;hl auf diocdb
(1)  634/    DFA9 : C1                  		pop	bc
(1)  635/    DFAA : CB 6E               		bit	5, (hl)			;Kopf hochnehmen?
(1)  636/    DFAC : C2 5A E2            		jp	nz, noerr		;ja, kein Transfer
(1)  637/    DFAF : C5                  		push	bc
(1)  638/    DFB0 : DD E5               		push	ix
(1)  639/    DFB2 : E5                  		push	hl
(1)  640/    DFB3 : 23                  		inc	hl
(1)  641/    DFB4 : 4E                  		ld	c, (hl)			;logisches Laufwerk
(1)  642/    DFB5 : CD F2 DD            		call	dgetpb			;IX auf DPB stellen
(1)  643/    DFB8 : E1                  		pop	hl			;wiederherstellen hl
(1)  644/    DFB9 : 3E 44               		ld	a, 'D'			;falls LW nicht ex.
(1)  645/    DFBB : CA 6C E0            		jp	z, dioert		;LW ex. nicht
(1)  646/    DFBE : CB 76               		bit	6, (hl)			;trk,sid,sec schon physisch?
(1)  647/    DFC0 : 20 5A               		jr	nz, diophy		;ja
(1)  648/    DFC2 :                     ; Track, Side und Sector entpsr. Diskettenformat setzen
(1)  649/    DFC2 : 23                  		inc	hl
(1)  650/    DFC3 : 23                  		inc	hl
(1)  651/    DFC4 : 56                  		ld	d, (hl)			;Track
(1)  652/    DFC5 : 5A                  		ld	e, d			;merken
(1)  653/    DFC6 : 23                  		inc	hl
(1)  654/    DFC7 : 23                  		inc	hl
(1)  655/    DFC8 : 4E                  		ld	c, (hl)			;Sektornummer ab 1
(1)  656/    DFC9 : 0D                  		dec	c			;Sektornr. ab 0
(1)  657/    DFCA : DD CB 0F 66         		bit	4, (ix+0Fh)		;Fortsetzung Dsk. auf Ruecks.?
(1)  658/    DFCE : 20 0C               		jr	nz, diots2		;ja
(1)  659/    DFD0 : DD CB 0F 6E         		bit	5, (ix+0Fh)		;ungerade Spuren auf Rueckseite?
(1)  660/    DFD4 : 28 29               		jr	z, diotrs		;nein, einseitig
(1)  661/    DFD6 : CB 3A               		srl	d			;Spur halbieren
(1)  662/    DFD8 : 30 25               		jr	nc, diotrs		;gerade Spur, Vorderseite
(1)  663/    DFDA : 18 12               		jr	diots1			;auf Rueckseite
(1)  664/    DFDC : DD 46 14            diots2:		ld	b, (ix+14h)		;log. Spurzahl
(1)  665/    DFDF : CB 38               		srl	b			;Spuren auf Vorderseite
(1)  666/    DFE1 : 7A                  		ld	a, d
(1)  667/    DFE2 : 90                  		sub	b			;Spur auf Vorderseite?
(1)  668/    DFE3 : 38 1A               		jr	c, diotrs		;ja, Spur in d unveraendert lassen
(1)  669/    DFE5 :                     						;40 ->  0; 41 ->  1; ...; 79 ->  39
(1)  670/    DFE5 :                     						;77 ->  0; 78 ->  1; ...;153 ->  76
(1)  671/    DFE5 : DD CB 0F 5E         		bit	3, (ix+0Fh)		;Ruecks. von aussen nach innen?
(1)  672/    DFE9 : 20 02               		jr	nz, diots4		;ja
(1)  673/    DFEB : 2F                  		cpl				;40 -> -1; 41 -> -2; ...; 79 -> -40
(1)  674/    DFEC :                     						;77 -> -1; 78 -> -2; ...;153 -> -77
(1)  675/    DFEC : 80                  		add	a, b			;40 -> 39; 41 -> 38; ...; 79 ->   0
(1)  676/    DFED :                     						;77 -> 76; 78 -> 75; ...;153 ->   0
(1)  677/    DFED : 57                  diots4:		ld	d, a
(1)  678/    DFEE : 3A 6C E1            diots1:		ld	a, (diocdb)
(1)  679/    DFF1 : CB FF               		set	7, a			;vermerken Rueckseite
(1)  680/    DFF3 : 32 6C E1            		ld	(diocdb), a
(1)  681/    DFF6 : DD 7E 13            		ld	a, (ix+13h)		;Versch. der Sektornr. auf Rueckseite
(1)  682/    DFF9 : 81                  		add	a, c			;Sektornr. evtl. weiterzaehlen
(1)  683/    DFFA : 4F                  		ld	c, a
(1)  684/    DFFB : 3E 01               		ld	a, 1			;side:=1
(1)  685/    DFFD : 18 01               		jr	diotss
(1)  686/    DFFF :                     
(1)  687/    DFFF : AF                  diotrs:		xor	a			;side:=0
(1)  688/    E000 : 32 6F E1            diotss:		ld	(diocsi), a		;phys. Seite setzen
(1)  689/    E003 : 7A                  		ld	a, d
(1)  690/    E004 : 32 6E E1            		ld	(dioctr), a		;phys. Spur setzen
(1)  691/    E007 : 7B                  		ld	a, e			;log. Spurnr. zurueck nach A
(1)  692/    E008 : DD E5               		push	ix
(1)  693/    E00A : E1                  		pop	hl
(1)  694/    E00B : 11 19 00            		ld	de, 19h			;d:=0
(1)  695/    E00E : 19                  		add	hl, de
(1)  696/    E00F : DD BE 0D            		cp	(ix+0Dh)		;Systemspur?
(1)  697/    E012 : 38 03               		jr	c, diossp		;ja, Sektornummern nicht logisch
(1)  698/    E014 : 59                  		ld	e, c
(1)  699/    E015 : 19                  		add	hl, de			;HL entspr. Index in dpbstr
(1)  700/    E016 : 4A                  		ld	c, d			;c:=0
(1)  701/    E017 : 79                  diossp:		ld	a, c			;phys. Sektornr. ab 0
(1)  702/    E018 : 86                  		add	a, (hl)			;+echte Sektornr.
(1)  703/    E019 : 32 70 E1            		ld	(diocse), a		;phys. Sektor setzen
(1)  704/    E01C :                     diophy:
(1)  705/    E01C :                     ; i ret, BC, IX im Stack
(1)  706/    E01C :                     ; i cdb auf diocdb
(1)  707/    E01C :                     ; i IX auf DPB
(1)  708/    E01C :                     
(1)  709/    E01C :                     ;interne Wiederholung dsktra
(1)  710/    E01C : DD E5               		push	ix			;retten IX fuer evtl. Wiederholung
(1)  711/    E01E : 21 6C E1            		ld	hl, diocdb
(1)  712/    E021 : E5                  		push	hl
(1)  713/    E022 : 7E                  		ld	a, (hl)			;side 0/1, -/FM, read/write, -/sectid l.
(1)  714/    E023 : E6 8E               		and	8Eh			;(1 shl diofs1)+(1 shl dioffm)+(1 shl diofwr)+(1 shl diofid)
(1)  715/    E025 : 47                  		ld	b, a
(1)  716/    E026 : DD 7E 18            		ld	a, (ix+18h)		;5"/8", FM/MFM, 40/80, Verify nach Schreiben
(1)  717/    E029 : E6 78               		and	78h			;and (1 shl dpbt80)+(1 shl dpbt5z)+(1 shl dpbtdd)+(1 shl dpbtwv) ;aus DPB
(1)  718/    E02B : A8                  		xor	b
(1)  719/    E02C : CB 66               		bit	4, (hl)			;Fehlerbehandlung unterdruecken?
(1)  720/    E02E : 28 01               		jr	z, dionft		;nein
(1)  721/    E030 : 3C                  		inc	a
(1)  722/    E031 : 32 CB E3            dionft:		ld	(ft.kom), a
(1)  723/    E034 : 23                  		inc	hl
(1)  724/    E035 : DD 7E 15            		ld	a, (ix+15h)		;physische LW-Nr.
(1)  725/    E038 : 32 CE E3            		ld	(ft.lwn), a
(1)  726/    E03B : 23                  		inc	hl
(1)  727/    E03C : 7E                  		ld	a, (hl)
(1)  728/    E03D : 32 CF E3            		ld	(ft.trk), a
(1)  729/    E040 : 23                  		inc	hl
(1)  730/    E041 : 7E                  		ld	a, (hl)
(1)  731/    E042 : 32 D0 E3            		ld	(ft.sid), a
(1)  732/    E045 : 23                  		inc	hl
(1)  733/    E046 : 7E                  		ld	a, (hl)
(1)  734/    E047 : 32 D1 E3            		ld	(ft.sec), a
(1)  735/    E04A : 23                  		inc	hl
(1)  736/    E04B : 7E                  		ld	a, (hl)
(1)  737/    E04C : 32 D2 E3            		ld	(ft.len), a
(1)  738/    E04F : 23                  		inc	hl
(1)  739/    E050 : 7E                  		ld	a, (hl)
(1)  740/    E051 : 32 D3 E3            		ld	(ft.anz), a		;Anzahl der Stepimpulse
(1)  741/    E054 : DD 7E 12            		ld	a, (ix+12h)		;Schrittzeit
(1)  742/    E057 : 32 D4 E3            		ld	(ft.stp), a
(1)  743/    E05A : DD 7E 17            		ld	a, (ix+17h)
(1)  744/    E05D : 32 D5 E3            		ld	(ft.sti), a
(1)  745/    E060 : 2A 73 E1            		ld	hl, (diocad)
(1)  746/    E063 : 22 CC E3            		ld	(ft.adr), hl
(1)  747/    E066 : CD 75 E1            		call	floppy			;$$$ phys. Transfer $$$
(1)  748/    E069 : E1                  		pop	hl			;HL wieder auf Paramfeld-Adresse
(1)  749/    E06A : DD E1               		pop	ix			;IX wieder auf DPB
(1)  750/    E06C :                     
(1)  751/    E06C :                     ; Fehlerprotokoll
(1)  752/    E06C : CB 66               dioert:		bit	4, (hl)			;Fehlerprotokoll und -behandlung  unterdr.?
(1)  753/    E06E : 20 33               		jr	nz, dtrok		;ja
(1)  754/    E070 : B7                  		or	a			;Returncode
(1)  755/    E071 : 28 30               		jr	z, dtrok		; -> fehlerfrei
(1)  756/    E073 : FE 52               		cp	'R'			;not ready?
(1)  757/    E075 : CA 1C E0            		jp	z, diophy		;ja, Wiederholung
(1)  758/    E078 : 32 39 E1            		ld	(derrcd), a		;Fehlercode
(1)  759/    E07B : CB 56               		bit	2, (hl)			;war lesen?
(1)  760/    E07D : 3E 52               		ld	a, 'R'
(1)  761/    E07F : 28 02               		jr	z, derrr		;ja
(1)  762/    E081 : 3E 57               		ld	a, 'W'
(1)  763/    E083 : 32 38 E1            derrr:		ld	(derrrw), a
(1)  764/    E086 : 21 CF E3            		ld	hl, ft.trk		;phys. Spur
(1)  765/    E089 : 11 43 E1            		ld	de, derrtr	; "XXXXXX\a"
(1)  766/    E08C : CD 0B E4            		call	mbreco		; (HL) nach hex	konvertieren, Eintragen	nach (DE), 2x inc DE
(1)  767/    E08F : 21 D0 E3            		ld	hl, ft.trk+1
(1)  768/    E092 : CD 0B E4            		call	mbreco		; (HL) nach hex	konvertieren, Eintragen	nach (DE), 2x inc DE
(1)  769/    E095 : 21 D1 E3            		ld	hl, ft.sec		;Seite
(1)  770/    E098 : CD 0B E4            		call	mbreco		; (HL) nach hex	konvertieren, Eintragen	nach (DE), 2x inc DE
(1)  771/    E09B : 21 36 E1            		ld	hl, derrms
(1)  772/    E09E : CD EC E3            		call	biosms
(1)  773/    E0A1 : 3E 01               		ld	a, 1		;return mit Fehler
(1)  774/    E0A3 : B7                  dtrok:		or	a		;stellen Z-Flag
(1)  775/    E0A4 : ED 5B CF E3         		ld	de, (ft.trk)	;E:=trk, D:=sid
(1)  776/    E0A8 : 2A D1 E3            		ld	hl, (ft.sec)	;L:=sec, H:=len
(1)  777/    E0AB : DD E1               		pop	ix
(1)  778/    E0AD : C1                  		pop	bc
(1)  779/    E0AE : C9                  		ret
(1)  780/    E0AF :                     
(1)  781/    E0AF :                     
(1)  782/    E0AF :                     ; Stellen HL entsprechend Sektorlaengencode in (A)
(1)  783/    E0AF :                     ; ret nz bei unzulaessigem
(1)  784/    E0AF : B7                  dtrsla:		or	a
(1)  785/    E0B0 : 21 C3 E0            		ld	hl, dtrsl0	; bei A=0 (128)
(1)  786/    E0B3 : C8                  		ret	z
(1)  787/    E0B4 : 3D                  		dec	a
(1)  788/    E0B5 : 21 D7 E0            		ld	hl, dtrsl1	; bei A=1 (256)
(1)  789/    E0B8 : C8                  		ret	z
(1)  790/    E0B9 : 3D                  		dec	a
(1)  791/    E0BA : 21 EB E0            		ld	hl, dtrsl2	; bei A=2 (512)
(1)  792/    E0BD : C8                  		ret	z
(1)  793/    E0BE : 3D                  		dec	a
(1)  794/    E0BF : 21 FF E0            		ld	hl, dtrsl3	; bei A=3 (1024)
(1)  795/    E0C2 : C9                  		ret
(1)  796/    E0C3 :                     
(1)  797/    E0C3 :                     ;************************************************
(1)  798/    E0C3 :                     ;	Steuertabellen
(1)  799/    E0C3 :                     ;************************************************
(1)  800/    E0C3 :                     
(1)  801/    E0C3 :                     ; Modifizierungstabellen entspr. Sektorlaenge und LW-Typ
(1)  802/    E0C3 :                     ;-------------------------------------------------------
(1)  803/    E0C3 :                     
(1)  804/    E0C3 :                     ; Struktur:
(1)  805/    E0C3 :                     
(1)  806/    E0C3 : =0H                 dsltrk	equ	0		;benutzte Spuren
(1)  807/    E0C3 : =1H                 dslspt	equ	dsltrk+1	;Sektoren/Spur
(1)  808/    E0C3 : =2H                 dsldir	equ	dslspt+1	;Dir-Eintraege
(1)  809/    E0C3 : =3H                 dsloff	equ	dsldir+1	;2*offset
(1)  810/    E0C3 :                     				;[+Flag fuer festes offset]
(1)  811/    E0C3 : =1H                 dslfo	equ	1		;festes offset
(1)  812/    E0C3 : =0H                 dslvo	equ	0		;offset =0, falls Directory mgl.
(1)  813/    E0C3 : =4H                 dslblk	equ	dsloff+1	;rel. Adr. Tab. BDOS-Blockgroesse
(1)  814/    E0C3 : =5H                 dsll	equ	5		;Laenge eines Eintrags
(1)  815/    E0C3 :                     
(1)  816/    E0C3 :                     ; Reihenfolge
(1)  817/    E0C3 :                     ; 5", 40 Tr, SS
(1)  818/    E0C3 :                     ; 5", 80 Tr, SS
(1)  819/    E0C3 :                     ; 5", 40 Tr, DS
(1)  820/    E0C3 :                     ; 5", 80 Tr, DS
(1)  821/    E0C3 :                     
(1)  822/    E0C3 :                     ; 128
(1)  823/    E0C3 :                     dtrsl0:
(1)  824/    E0C3 : 28 1A 3F 04 4C      	db	40,26,63,2*2+dslvo,dbl1k-$-4	;CP/M Standard
(1)  825/    E0C8 : 50 1A 7F 04 4A      	db	80,26,127,2*2+dslvo,dbl2k-$-4
(1)  826/    E0CD : 50 1A 7F 01 45      	db	80,26,127,2*0+dslfo,dbl2k-$-4
(1)  827/    E0D2 : A0 1A 7F 01 43      	db	160,26,127,2*0+dslfo,dbl2k0-$-4
(1)  828/    E0D7 :                     
(1)  829/    E0D7 :                     ; 256
(1)  830/    E0D7 :                     dtrsl1:
(1)  831/    E0D7 : 28 20 3F 07 3B      	db	40,32,63,2*3+dslfo,dbl2k-$-4	;SCP Hausformat A51xx
(1)  832/    E0DC : 50 20 3F 07 36      	db	80,32,63,2*3+dslfo,dbl2k-$-4	;SCP
(1)  833/    E0E1 : 50 20 7F 09 31      	db	80,32,127,2*4+dslfo,dbl2k-$-4
(1)  834/    E0E6 : A0 20 7F 09 2F      	db	160,32,127,2*4+dslfo,dbl2k0-$-4	;SCP Hausformat PC1715
(1)  835/    E0EB :                     
(1)  836/    E0EB :                     ; 512
(1)  837/    E0EB :                     dtrsl2:
(1)  838/    E0EB :                     
(1)  839/    E0EB : 28 24 3F 01 24      	db	40,36,63,2*0+dslfo,dbl1k-$-4
(1)  840/    E0F0 : 50 24 7F 01 22      	db	80,36,127,2*0+dslfo,dbl2k-$-4
(1)  841/    E0F5 : 50 24 7F 01 1D      	db	80,36,127,2*0+dslfo,dbl2k-$-4
(1)  842/    E0FA : A0 24 7F 01 1B      	db	160,36,127,2*0+dslfo,dbl2k0-$-4
(1)  843/    E0FF :                     
(1)  844/    E0FF :                     ; 1024
(1)  845/    E0FF :                     dtrsl3:
(1)  846/    E0FF : 28 28 3F 04 10      	db	40,40,63,2*2+dslvo,dbl1k-$-4	;CP/A Standard A51xx
(1)  847/    E104 : 50 28 7F 04 0E      	db	80,40,127,2*2+dslvo,dbl2k-$-4	;CP/A
(1)  848/    E109 : 50 28 7F 00 09      	db	80,40,127,2*0+dslvo,dbl2k-$-4	;CP/A
(1)  849/    E10E : A0 28 BF 08 07      	db	160,40,191,2*4+dslvo,dbl2k0-$-4	;CP/A (und SCP)
(1)  850/    E113 :                     
(1)  851/    E113 :                     ; Modifizierungstabellen fuer BDOS-Blockgroesse
(1)  852/    E113 : 03 07 00            dbl1k:	db	3,7,0		;Bl. Shift, Bl. Mask, Ext. Mask
(1)  853/    E116 : 04 0F 01            dbl2k:	db	4,0fh,1
(1)  854/    E119 : 04 0F 00            dbl2k0:	db	4,0fh,0		;fuer Kapazitaet >255
(1)  855/    E11C :                     
(1)  856/    E11C :                     ; log. Sektortranslate-Tabelle fuer 26*128
(1)  857/    E11C : 01 07 0D 13 19 05   xlt:	db	1,7,13,19,25,5,11,17,23,3,9,15,21
                    0B 11 17 03 09 0F 
                    15 
(1)  858/    E129 : 02 08 0E 14 1A 06   	db	2,8,14,20,26,6,12,18,24,4,10,16,22
                    0C 12 18 04 0A 10 
                    16 
(1)  859/    E136 :                     
(1)  860/    E136 :                     
(1)  861/    E136 :                     ; Fehlermeldung Disk I/O Error
(1)  862/    E136 :                     ; Genau so lang (kurz), wie in Statuszeile Platz dafuer da ist!
(1)  863/    E136 :                     ; und das sind 17 Bytes!
(1)  864/    E136 :                     
(1)  865/    E136 : 0D                  derrms:		db	 0Dh ;
(1)  866/    E137 : 0A                  		db	 0Ah ;
(1)  867/    E138 : 58                  derrrw:		db	'X'
(1)  868/    E139 : 58 3B 54 2C 53 69   derrcd:		db	"X;T,Si,Se="
                    2C 53 65 3D 
(1)  869/    E143 : 58 58               derrtr:		db	"XX"
(1)  870/    E145 : 58 58               derrts:		db	"XX"
(1)  871/    E147 : 58 58               derrsc:		db	"XX"
(1)  872/    E149 : 07                  		db	7
(1)  873/    E14A : 00                  		db	0
(1)  874/    E14B :                     
(1)  875/    E14B :                     ; CDB fuer Bestimmung Spurformat
(1)  876/    E14B : 12                  dfrcdb:		db	 12h 		;(1 shl diofid)+(1 shl dioftr)
(1)  877/    E14C : FF                  dfrmdv:		db	0FFh		;Geraet
(1)  878/    E14D : FF                  dfrmtr:		db	0FFh		;Spur
(1)  879/    E14E : FF                  		db	0FFh 		;Seite (bel.)
(1)  880/    E14F : 01                  		db	   1 		;Sektor (bel.)
(1)  881/    E150 : 00                  		db	   0 		;Sektorlaengencode (bel.)
(1)  882/    E151 : 01                  		db	   1 		;Sektoranzahl (>0)
(1)  883/    E152 :                     
(1)  884/    E152 :                     ; Puffer-CDB
(1)  885/    E152 : 00                  dbflg:	db	0
(1)  886/    E153 : FF                  dbdev:	db	0FFh
(1)  887/    E154 : FF                  dbtrk:	db	0FFh
(1)  888/    E155 : FF                  dbsid:	db	0FFh
(1)  889/    E156 : FF                  dbsec:	db	0FFh
(1)  890/    E157 : FF                  dbslc:	db	0FFh
(1)  891/    E158 : FF                  dbsnb:	db	0FFh
(1)  892/    E159 : A4 E7               dbdma:	dw	fdcbuffer
(1)  893/    E15B :                     
(1)  894/    E15B :                     ; CDB fuer ungepufferte E/A
(1)  895/    E15B : 00                  dflg:	db	0
(1)  896/    E15C : 00                  ddrive:	db	0
(1)  897/    E15D : FF                  dtrack:	db	0FFh
(1)  898/    E15E : FF                  	db	0FFh 		;Seite
(1)  899/    E15F : FF                  dsectr:	db	0FFh
(1)  900/    E160 : 00                  	db	   0 		;128 Bytes Sektorlaenge
(1)  901/    E161 : 01                  	db	   1 		;immer nur 1 Sektor
(1)  902/    E162 :                     
(1)  903/    E162 : 00                  unacnt:	db	0
(1)  904/    E163 : FF                  unadev:	db	0FFh
(1)  905/    E164 : FF                  unatrk:	db	0FFh
(1)  906/    E165 : 00                  unasec:	db	0
(1)  907/    E166 :                     
(1)  908/    E166 : FF                  dbnb:	db	0FFh
(1)  909/    E167 : FF                  dwrtyp:	db	0FFh
(1)  910/    E168 : 00                  dberrf:	db	0		;Ergebnisflag letztes dbtran
(1)  911/    E169 :                     
(1)  912/    E169 :                     ;Arbeitsbereiche logischer Floppy-Treiber im BIOS-RAM
(1)  913/    E169 : ED B0               flldir:		ldir		;Floppy-Puffer <-> Nutzer-DMA
(1)  914/    E16B : C9                  		ret
(1)  915/    E16C :                     
(1)  916/    E16C :                     ;CDB-Hilfsspeicher fuer dsktra-Aufruf
(1)  917/    E16C : FF                  diocdb:	db	0FFh
(1)  918/    E16D : FF                  diocde:	db	0FFh
(1)  919/    E16E : FF                  dioctr:	db	0FFh
(1)  920/    E16F : FF                  diocsi:	db	0FFh
(1)  921/    E170 : FF                  diocse:	db	0FFh
(1)  922/    E171 : FF                  diocsl:	db	0FFh
(1)  923/    E172 : FF                  diocsn:	db	0FFh
(1)  924/    E173 : FF FF               diocad:	dw	0FFFFh
(1)  925/    E175 :                     
(1)  926/    E175 :                     
(1)  927/    E175 :                     ;************************************************
(1)  928/    E175 :                     ; physischer Disketten-Transfer
(1)  929/    E175 :                     ;************************************************
(1)  930/    E175 :                     
(1)  931/    E175 :                     	include biosfdc.inc
(2)    1/    E175 :                     ;Source: BIOSDSKT.MAC (CPA) + Kramer
(2)    2/    E175 :                     
(2)    3/    E175 :                     ;************************************************
(2)    4/    E175 :                     ; physischer Disketten-Transfer
(2)    5/    E175 :                     ;************************************************
(2)    6/    E175 :                     
(2)    7/    E175 :                     ;
(2)    8/    E175 :                     ; FDC-Ports:
(2)    9/    E175 :                     ; ----------
(2)   10/    E175 :                     
(2)   11/    E175 :                     
(2)   12/    E175 :                     ;KC87
(2)   13/    E175 : =98H                FDCD         	equ	98h  	; FDC Datenregister
(2)   14/    E175 : =99H                FDCC         	equ	99h  	; FDC Steueregister	
(2)   15/    E175 : =A0H                FDCZ        	equ	0A0h 	; FDC Zusatzregister
(2)   16/    E175 :                     
(2)   17/    E175 :                     ;BIC
(2)   18/    E175 :                     ;FDCD         	equ	40h  	; FDC Datenregister 
(2)   19/    E175 :                     ;FDCC         	equ	41h  	; FDC Steueregister	
(2)   20/    E175 :                     ;FDCZ        	equ	48h 	; FDC Zusatzregister
(2)   21/    E175 :                     
(2)   22/    E175 :                     				; 5 4 3 2 1 0
(2)   23/    E175 :                     				; x x 0 0 x x 
(2)   24/    E175 :                     				; | |     | |
(2)   25/    E175 :                     				; | |     | Motor Laufwerk 0 ein/aus
(2)   26/    E175 :                     				; | |     Motor Laufwerk 1 ein/aus
(2)   27/    E175 :                     				; | Terminal Count aktivieren/deakt.
(2)   28/    E175 :                     				; FDC Reset
(2)   29/    E175 :                     
(2)   30/    E175 :                     ;
(2)   31/    E175 :                     ; Aufruf:
(2)   32/    E175 :                     ; -------
(2)   33/    E175 :                     ; Bereitstellung der Parameter auf den Bytes:
(2)   34/    E175 :                     
(2)   35/    E175 :                     ;       ft.kom:	db	0	; bit0 - =1 ohne Fehlerwiederholung
(2)   36/    E175 :                     ;				     1 - lesen ft.len von beliebigem Sektor
(2)   37/    E175 :                     ;				     2 - schreiben (wenn auch bit0: mit verify)
(2)   38/    E175 :                     ;				     3 - 0-FM; 1-MFM   (5"FM nur bei PC1715)
(2)   39/    E175 :                     ;				     4 - 0-8"; 1-5"
(2)   40/    E175 :                     ;				     5 - 0- 40-Spur-Laufwerk; 1- 80-Spur-LW
(2)   41/    E175 :                     ;				     7 - =0 Vorderseite, =1 Rueckseite
(2)   42/    E175 :                     ;	ft.adr: dw	0	; Transferadresse
(2)   43/    E175 :                     ;	ft.lwn: db	0	; 0..3 phys. Laufwerksnummer
(2)   44/    E175 :                     ;	ft.trk: db	0	; 0..  track
(2)   45/    E175 :                     ;	ft.sid: db	0	; 0..ff side (side=0 auf Rueckseite moeglich!)
(2)   46/    E175 :                     ;	ft.sec: db	0	; 0..  sector (beliebig bei SektId lesen)
(2)   47/    E175 :                     ;	ft.len: db	0	; 0..3 Sektorlaenge (auch 0..3 bei SektId les.)
(2)   48/    E175 :                     ;	ft.anz: db	0	; 0.. Anzahl der zu uebertragenden Sektoren
(2)   49/    E175 :                     ;				;      =0: nur Positionieren
(2)   50/    E175 :                     ;				;      (<>0 bei SektId lesen)
(2)   51/    E175 :                     ;       ft.stp: db	0	;      Anzahl der Stepimpulse von Spur zu Spur
(2)   52/    E175 :                     ;	ft.sti: db	0	;      Schrittzeit von Spur zu Spur
(2)   53/    E175 :                     ;				;      in 0,1ms Einheiten
(2)   54/    E175 :                     ;
(2)   55/    E175 :                     ;	call	floppy
(2)   56/    E175 :                     ;       ...			; in A steht Ergebniskode
(2)   57/    E175 :                     ;				; alle Register (auch IX) undef.
(2)   58/    E175 :                     ;
(2)   59/    E175 :                     ; Ergebniskode (in Reg. A):
(2)   60/    E175 :                     ;	00h kein Fehler (Z-Flag nicht von floppy gesetzt)
(2)   61/    E175 :                     ;	'C' CRC-Fehler
(2)   62/    E175 :                     ;	'D' LW nicht existent
(2)   63/    E175 :                     ;	'R' Geraet nicht bereit, aber existent
(2)   64/    E175 :                     ;	'S' Sektor nicht gefunden
(2)   65/    E175 :                     ;	'T' Spurnummer zu gross
(2)   66/    E175 :                     ;	'U' keine Marke gefunden
(2)   67/    E175 :                     ;	'W' Diskette schreibgeschuetzt
(2)   68/    E175 :                     
(2)   69/    E175 :                     ; Paramfeld wird an folgenden Stellen veraendert:
(2)   70/    E175 :                     ;  Komm. "Lesen Sekt,Id.":	ft.trk .. ft.len gestellt
(2)   71/    E175 :                     ;  Komm. "Schreiben mit Verify":ft.kom, bit 0 geloescht
(2)   72/    E175 :                     
(2)   73/    E175 : 3E 10               floppy:		ld	a, 15+1
(2)   74/    E177 : 32 D6 E3            			ld	(crerc), a		; Fehlerzaehler fuer CRC-Fehlerwiederholungen
(2)   75/    E17A : 3E 05               			ld	a, 4+1			; Fehlerzaehler fuer Spurfindewiederholungen
(2)   76/    E17C : 32 D7 E3            			ld	(sperc), a
(2)   77/    E17F :                     
(2)   78/    E17F :                     	
(2)   79/    E17F : 3A CE E3            			ld	a, (ft.lwn)
(2)   80/    E182 : 4F                  			ld	c, a
(2)   81/    E183 : B7                  			or	a
(2)   82/    E184 : 3E 01               			ld	a, 1
(2)   83/    E186 : 28 01               			jr	z, drv0
(2)   84/    E188 : 07                  			rlca
(2)   85/    E189 :                     ; Laufwerksnummer pruefen
(2)   86/    E189 : 21 D8 E3            drv0:		ld	hl, dFDCZ1
(2)   87/    E18C : A6                  			and	(hl)
(2)   88/    E18D : 20 05               			jr	nz, drv0a
(2)   89/    E18F : 3E 44               			ld	a, 'D'
(2)   90/    E191 : C3 5B E2            			jp	fehret
(2)   91/    E194 : D3 A0               drv0a:		out	(FDCZ),	a
(2)   92/    E196 : 32 D9 E3            			ld	(dFDCZ2), a
(2)   93/    E199 :                     
(2)   94/    E199 :                     
(2)   95/    E199 :                     
(2)   96/    E199 : 3A CB E3            			ld	a, (ft.kom)
(2)   97/    E19C : E6 80               			and	80h
(2)   98/    E19E : 07                  			rlca
(2)   99/    E19F : 07                  			rlca
(2)  100/    E1A0 : 07                  			rlca
(2)  101/    E1A1 : B1                  			or	c
(2)  102/    E1A2 : 32 DB E3            			ld	(UNIT), a
(2)  103/    E1A5 : 3A D3 E3            			ld	a, (ft.anz)
(2)  104/    E1A8 : 21 CF E3            			ld	hl, ft.trk
(2)  105/    E1AB : B6                  			or	(hl)
(2)  106/    E1AC : 20 06               			jr	nz, floppy3
(2)  107/    E1AE : CD 61 E2            			call	recal2
(2)  108/    E1B1 : C3 5B E2            			jp	fehret
(2)  109/    E1B4 :                     
(2)  110/    E1B4 : CD 95 E2            floppy3:	call	seek
(2)  111/    E1B7 : B7                  			or	a
(2)  112/    E1B8 : 28 15               			jr	z, floppy5
(2)  113/    E1BA : C3 5B E2            			jp	fehret
(2)  114/    E1BD :                     
(2)  115/    E1BD : 21 D7 E3            floppy4:	ld	hl, sperc
(2)  116/    E1C0 : 35                  			dec	(hl)
(2)  117/    E1C1 : 3E 54               			ld	a, 'T'			; Fehler "Spurnr. zu groß"
(2)  118/    E1C3 : CA 5B E2            			jp	z, fehret
(2)  119/    E1C6 : CD 61 E2            			call	recal2
(2)  120/    E1C9 : B7                  			or	a
(2)  121/    E1CA : C2 5B E2            			jp	nz, fehret
(2)  122/    E1CD : 18 E5               			jr	floppy3
(2)  123/    E1CF :                     
(2)  124/    E1CF : 21 CF E3            floppy5:	ld	hl, ft.trk
(2)  125/    E1D2 : 11 DC E3            			ld	de, TRCK
(2)  126/    E1D5 : 01 04 00            			ld	bc, 4
(2)  127/    E1D8 : ED B0               			ldir
(2)  128/    E1DA : 34                  			inc	(hl)
(2)  129/    E1DB : 35                  			dec	(hl)
(2)  130/    E1DC : CA 5A E2            			jp	z, noerr
(2)  131/    E1DF : EB                  			ex	de, hl
(2)  132/    E1E0 : 3E FF               			ld	a, 0FFh
(2)  133/    E1E2 : 77                  			ld	(hl), a
(2)  134/    E1E3 : 23                  			inc	hl
(2)  135/    E1E4 : 3E 0A               			ld	a, 0Ah
(2)  136/    E1E6 : 77                  			ld	(hl), a
(2)  137/    E1E7 : 3A D2 E3            			ld	a, (ft.len)
(2)  138/    E1EA : B7                  			or	a
(2)  139/    E1EB : 3E FF               			ld	a, 0FFh
(2)  140/    E1ED : 20 02               			jr	nz, floppy6
(2)  141/    E1EF : 3E 80               			ld	a, 80h
(2)  142/    E1F1 : 32 E2 E3            floppy6:	ld	(DTL), a
(2)  143/    E1F4 : 3A CB E3            			ld	a, (ft.kom)
(2)  144/    E1F7 : CB 4F               			bit	1, a
(2)  145/    E1F9 : 20 3F               			jr	nz, floppy10
(2)  146/    E1FB : CB 57               			bit	2, a
(2)  147/    E1FD : 20 05               			jr	nz, floppy7
(2)  148/    E1FF : CD 16 E3            			call	r8272
(2)  149/    E202 : 18 0D               			jr	floppy8
(2)  150/    E204 : CD 8C E2            floppy7:	call	sds
(2)  151/    E207 : CB 77               			bit	6, a
(2)  152/    E209 : 3E 57               			ld	a, 'W'			; Fehler "write protect"
(2)  153/    E20B : C2 5B E2            			jp	nz, fehret
(2)  154/    E20E : CD 0F E3            			call	w8272
(2)  155/    E211 : B7                  floppy8:	or	a
(2)  156/    E212 : 28 17               			jr	z, floppy9
(2)  157/    E214 : FE 54               			cp	'T'				; Fehler "Spurnr. zu groß"
(2)  158/    E216 : 28 A5               			jr	z, floppy4
(2)  159/    E218 : FE 43               			cp	'C'				; Fehler: CRC-Zeichen falsch
(2)  160/    E21A : 20 3F               			jr	nz, fehret
(2)  161/    E21C : 21 CB E3            			ld	hl, ft.kom
(2)  162/    E21F : CB 46               			bit	0, (hl)
(2)  163/    E221 : 20 38               			jr	nz, fehret
(2)  164/    E223 : 21 D6 E3            			ld	hl, crerc
(2)  165/    E226 : 35                  			dec	(hl)
(2)  166/    E227 : 28 32               			jr	z, fehret
(2)  167/    E229 : 18 A4               			jr	floppy5
(2)  168/    E22B : 21 CB E3            floppy9:	ld	hl, ft.kom
(2)  169/    E22E : CB 76               			bit	6, (hl)
(2)  170/    E230 : 28 28               			jr	z, noerr
(2)  171/    E232 : CB 56               			bit	2, (hl)
(2)  172/    E234 : 28 24               			jr	z, noerr
(2)  173/    E236 : CB 96               			res	2, (hl)
(2)  174/    E238 : 18 95               			jr	floppy5
(2)  175/    E23A : CD B0 E3            floppy10:	call	readID
(2)  176/    E23D : 21 E9 E3            			ld	hl, reslt+4
(2)  177/    E240 : 11 D0 E3            			ld	de, ft.trk+1
(2)  178/    E243 : 01 03 00            			ld	bc, 3
(2)  179/    E246 : ED B0               			ldir
(2)  180/    E248 : B7                  			or	a
(2)  181/    E249 : 20 10               			jr	nz, fehret
(2)  182/    E24B : 21 CF E3            			ld	hl, ft.trk
(2)  183/    E24E : 3A E8 E3            			ld	a, (reslt+3)
(2)  184/    E251 : BE                  			cp	(hl)
(2)  185/    E252 : 28 05               			jr	z, floppy11
(2)  186/    E254 : 34                  			inc	(hl)
(2)  187/    E255 : 35                  			dec	(hl)
(2)  188/    E256 : CA BD E1            			jp	z, floppy4
(2)  189/    E259 : 77                  floppy11:	ld	(hl), a
(2)  190/    E25A :                     
(2)  191/    E25A :                     ; kein Fehler aufgetreten
(2)  192/    E25A : AF                  noerr:		xor	a
(2)  193/    E25B :                     
(2)  194/    E25B :                     ; Fertigmelden, Ergebnis in A
(2)  195/    E25B :                     fehret:		
(2)  196/    E25B : F5                  			push	af
(2)  197/    E25C : AF                  			xor	a
(2)  198/    E25D : D3 A0               			out	(FDCZ),	a
(2)  199/    E25F : F1                  			pop	af
(2)  200/    E260 : C9                  			ret
(2)  201/    E261 :                     
(2)  202/    E261 :                     ; Spur 0 einstellen ( 2 Versuche)
(2)  203/    E261 : CD 65 E2            recal2:		call	recal
(2)  204/    E264 : C8                  			ret	z
(2)  205/    E265 :                     
(2)  206/    E265 :                     ; Spur 0 einstellen
(2)  207/    E265 : 01 07 02            recal:		ld	bc, 207h	; com. Spur 0 einstellen
(2)  208/    E268 : CD CD E2            			call	wcom	; com. in FDC schreiben
(2)  209/    E26B :                     
(2)  210/    E26B :                     ; prüfe Interruptstatus
(2)  211/    E26B : 01 08 01            sense:		ld	bc, 108h
(2)  212/    E26E : CD CD E2            			call	wcom	; com. in FDC schreiben
(2)  213/    E271 : CD EA E2            			call	rbyte	; 1 Byte lesen
(2)  214/    E274 : 47                  			ld	b, a		; Resultatbyte (sto) in A enthält Fehlercode
(2)  215/    E275 : E6 C0               				and	0C0h
(2)  216/    E277 : FE 80               			cp	80h
(2)  217/    E279 : C4 EA E2            			call	nz, rbyte	;PCN lesen
(2)  218/    E27C : CB 68               			bit	5, b		; Seek Ende?
(2)  219/    E27E : 28 EB               			jr	z, sense	; solange noch kein Seek Ende
(2)  220/    E280 : 3E 18               			ld	a, 00011000b
(2)  221/    E282 : A0                  			and	b
(2)  222/    E283 : C8                  			ret	z
(2)  223/    E284 : 3E 46               			ld	a, 'F'		; Fehler "Fehler bei Ausführung des SEEK-Kommandos"
(2)  224/    E286 : CB 60               			bit	4, b
(2)  225/    E288 : C0                  			ret	nz
(2)  226/    E289 : 3E 52               			ld	a, 'R'		; Fehler "Gerät nicht bereit"
(2)  227/    E28B : C9                  			ret
(2)  228/    E28C :                     
(2)  229/    E28C :                     ; prüfe Laufwerkstatus
(2)  230/    E28C : 01 04 02            sds:		ld	bc, 204h
(2)  231/    E28F : CD CD E2            			call	wcom	; com. in FDC schreiben
(2)  232/    E292 : C3 EA E2            			jp	rbyte		; Status Reg. lesen
(2)  233/    E295 :                     
(2)  234/    E295 :                     ; Spur einstellen
(2)  235/    E295 : CD B0 E2            seek:		call	rdy		; Laufwerk bereit?
(2)  236/    E298 : C0                  			ret	nz
(2)  237/    E299 : 3A D4 E3            			ld	a, (ft.stp)
(2)  238/    E29C : 47                  			ld	b, a
(2)  239/    E29D : 3A CF E3            			ld	a, (ft.trk)
(2)  240/    E2A0 : 05                  			dec	b
(2)  241/    E2A1 : 28 01               			jr	z, seek1
(2)  242/    E2A3 : 87                  			add	a, a
(2)  243/    E2A4 : 32 DC E3            seek1:		ld	(TRCK), a	
(2)  244/    E2A7 : 01 0F 03            seek2:		ld	bc, 30Fh	; com. Spur einstellen
(2)  245/    E2AA : CD CD E2            			call	wcom		; com. in FDC schreiben
(2)  246/    E2AD : C3 6B E2            			jp	sense		; prüfe Interruptstatus
(2)  247/    E2B0 :                     
(2)  248/    E2B0 :                     ; Laufwerk bereit?
(2)  249/    E2B0 : D5                  rdy:		push	de
(2)  250/    E2B1 : ED 5B E3 E3         			ld	de, (rdwait)
(2)  251/    E2B5 : C5                  rdy0:		push	bc
(2)  252/    E2B6 : CD 8C E2            			call	sds		; prüfe Laufwerkstatus
(2)  253/    E2B9 : C1                  			pop	bc
(2)  254/    E2BA : CB 6F               			bit	5, a		; rdy-Bit in Statusreg. 3
(2)  255/    E2BC : 20 0A               			jr	nz, rdy1	; falls alles i.O., raus hier 
(2)  256/    E2BE : 1D                  			dec	e
(2)  257/    E2BF : 20 F4               			jr	nz, rdy0
(2)  258/    E2C1 : 15                  			dec	d
(2)  259/    E2C2 : 20 F1               			jr	nz, rdy0
(2)  260/    E2C4 : 3E 52               			ld	a, 'R'		; Fehler "Gerät nicht bereit"
(2)  261/    E2C6 : 18 02               			jr	rdy2
(2)  262/    E2C8 : 3E 00               rdy1:		ld	a, 0
(2)  263/    E2CA : D1                  rdy2:		pop	de
(2)  264/    E2CB : B7                  			or	a
(2)  265/    E2CC : C9                  			ret
(2)  266/    E2CD :                     
(2)  267/    E2CD :                     ; Kommando in FDC schreiben
(2)  268/    E2CD : 21 DA E3            wcom:		ld	hl, CTAB
(2)  269/    E2D0 : CD E3 E2            wcom1:		call	delay	; Verzögerung f. Statusflag 8272
(2)  270/    E2D3 : DB 98               			in	a, (FDCD)
(2)  271/    E2D5 : E6 C0               			and	0C0h
(2)  272/    E2D7 : FE 80               			cp	80h		; RQM, DIO=OUT
(2)  273/    E2D9 : 20 F5               			jr	nz, wcom1
(2)  274/    E2DB : 79                  			ld	a, c
(2)  275/    E2DC : D3 99               			out	(FDCC), a
(2)  276/    E2DE : 23                  			inc	hl
(2)  277/    E2DF : 4E                  			ld	c, (hl)
(2)  278/    E2E0 : 10 EE               			djnz	wcom1
(2)  279/    E2E2 : C9                  			ret
(2)  280/    E2E3 :                     
(2)  281/    E2E3 :                     ;Verzögerung f. Statusflag 8272
(2)  282/    E2E3 : C5                  delay:		push	bc
(2)  283/    E2E4 : 06 01               			ld	b, 1
(2)  284/    E2E6 : 10 FE               			djnz	$
(2)  285/    E2E8 : C1                  			pop	bc
(2)  286/    E2E9 : C9                  			ret
(2)  287/    E2EA :                     
(2)  288/    E2EA :                     ;1 Byte lesen
(2)  289/    E2EA : CD E3 E2            rbyte:		call	delay	; Verzögerung f. Statusflag 8272
(2)  290/    E2ED : CD 09 E3            			call	irdy	; Bereit für Dateneingabe?
(2)  291/    E2F0 : DB 99               			in	a, (FDCC)
(2)  292/    E2F2 : C9                  			ret
(2)  293/    E2F3 :                     
(2)  294/    E2F3 :                     ; Lese 7 Resultbytes
(2)  295/    E2F3 : 06 06               rrslt:		ld	b, 6
(2)  296/    E2F5 : CD EA E2            			call	rbyte		; 1 Byte lesen
(2)  297/    E2F8 : 21 E5 E3            			ld	hl, reslt
(2)  298/    E2FB : 77                  			ld	(hl), a
(2)  299/    E2FC : E6 C0               			and	0C0h		; Fehler?
(2)  300/    E2FE : 4F                  			ld	c, a
(2)  301/    E2FF : CD EA E2            resl1:		call	rbyte	; 1 Byte lesen
(2)  302/    E302 : 23                  			inc	hl
(2)  303/    E303 : 77                  			ld	(hl), a
(2)  304/    E304 : 10 F9               			djnz	resl1
(2)  305/    E306 : 79                  			ld	a, c		; Fehlermelsung Status Reg. 0
(2)  306/    E307 : B7                  			or	a
(2)  307/    E308 : C9                  			ret
(2)  308/    E309 :                     
(2)  309/    E309 :                     ; Bereit für Dateneigabe?
(2)  310/    E309 : DB 98               irdy:		in	a, (FDCD)
(2)  311/    E30B : 07                  			rlca
(2)  312/    E30C : 30 FB               			jr	nc, irdy	; noch nicht bereit
(2)  313/    E30E : C9                  			ret
(2)  314/    E30F :                     
(2)  315/    E30F :                     ; Sektor schreiben
(2)  316/    E30F : 11 ED A3            w8272:		ld	de, 0A3EDh	; Code OUTI
(2)  317/    E312 : 0E 05               			ld	c, 5
(2)  318/    E314 : 18 05               			jr	rwit
(2)  319/    E316 :                     
(2)  320/    E316 :                     ; Sektor lesen
(2)  321/    E316 : 11 ED A2            r8272:		ld	de, 0A2EDh	; Code INI
(2)  322/    E319 : 0E 06               			ld	c, 6
(2)  323/    E31B : ED 53 6D E3         rwit:		ld	(rwmode), de
(2)  324/    E31F : CD C1 E3            			call	set_mfm_bit
(2)  325/    E322 : 32 DA E3            			ld	(CTAB), a	; Befehlstabelle für LEseoperation, MFM lesen
(2)  326/    E325 : CD B0 E2            			call	rdy		; Laufwerk bereit?
(2)  327/    E328 : C0                  			ret	nz
(2)  328/    E329 : 21 80 00            			ld	hl, 128		; Blockgröße
(2)  329/    E32C : 3A D2 E3            			ld	a, (ft.len)	; Sektorlaenge
(2)  330/    E32F : B7                  			or	a
(2)  331/    E330 : 47                  			ld	b, a
(2)  332/    E331 : 28 03               			jr	z, rwit2
(2)  333/    E333 : 29                  rwit1:		add	hl, hl		; max. speicherplatz ermitteln
(2)  334/    E334 : 10 FD               			djnz	rwit1
(2)  335/    E336 :                     ;		
(2)  336/    E336 : 3A D3 E3            rwit2:		ld	a, (ft.anz)
(2)  337/    E339 : 47                  			ld	b, a
(2)  338/    E33A : 11 00 00            			ld	de, 0
(2)  339/    E33D : EB                  			ex	de, hl		; hl=0
(2)  340/    E33E : 19                  rwit3:		add	hl, de
(2)  341/    E33F : 10 FD               			djnz	rwit3
(2)  342/    E341 : 7D                  			ld	a, l
(2)  343/    E342 : B7                  			or	a
(2)  344/    E343 : D9                  			exx
(2)  345/    E344 : 47                  			ld	b, a
(2)  346/    E345 : D9                  			exx
(2)  347/    E346 : 28 01               			jr	z, rwit4
(2)  348/    E348 : 24                  			inc	h
(2)  349/    E349 : 44                  rwit4:		ld	b, h
(2)  350/    E34A : D9                  			exx
(2)  351/    E34B : 0E 99               			ld	c, FDCC
(2)  352/    E34D : 2A CC E3            			ld	hl, (ft.adr)
(2)  353/    E350 : D9                  			exx
(2)  354/    E351 : 16 20               			ld	d, 20h
(2)  355/    E353 : 21 80 E3            			ld	hl, rwret
(2)  356/    E356 : E5                  			push	hl
(2)  357/    E357 : 0E 98               			ld	c, FDCD
(2)  358/    E359 : C5                  			push	bc
(2)  359/    E35A : 06 09               			ld	b, 9		; Anzahl der Bytes
(2)  360/    E35C : 3A DA E3            			ld	a, (CTAB)	; Anfangsadr. der CTAB
(2)  361/    E35F : 4F                  			ld	c, a		; in c kopieren ... für wcom
(2)  362/    E360 : F3                  			di
(2)  363/    E361 : CD CD E2            			call	wcom	; com. in FDC schreiben
(2)  364/    E364 : C1                  			pop	bc
(2)  365/    E365 : ED 78               rwit5:		in	a, (c)
(2)  366/    E367 : F2 65 E3            			jp	p, rwit5
(2)  367/    E36A : A2                  			and	d
(2)  368/    E36B : C8                  			ret	z
(2)  369/    E36C : D9                  			exx
(2)  370/    E36D : ED A2               rwmode:		ini				; oder outi je nach read/write
(2)  371/    E36F : D9                  			exx
(2)  372/    E370 : 20 F3               			jr	nz, rwit5
(2)  373/    E372 : 10 F1               			djnz	rwit5
(2)  374/    E374 :                     ;Motor ausschalten
(2)  375/    E374 : 3A D9 E3            			ld	a, (dFDCZ2)
(2)  376/    E377 : F6 10               			or	10h
(2)  377/    E379 : D3 A0               			out	(FDCZ),	a
(2)  378/    E37B : EE 10               			xor	10h
(2)  379/    E37D : D3 A0               			out	(FDCZ),	a
(2)  380/    E37F : E1                  			pop	hl
(2)  381/    E380 : FB                  rwret:		ei
(2)  382/    E381 :                     
(2)  383/    E381 : CD F3 E2            ErrorEval:	call	rrslt	; Lese 7 Result Bytes
(2)  384/    E384 : C8                  			ret	z
(2)  385/    E385 : FE C0               			cp	0C0h
(2)  386/    E387 : 3E 52               			ld	a, 'R'		; Fehler "Gerät nicht bereit"
(2)  387/    E389 : C8                  			ret	z
(2)  388/    E38A : 79                  			ld	a, c
(2)  389/    E38B : FE 80               			cp	80h
(2)  390/    E38D : 3E 42               			ld	a, 'B'		; Fehler "fehlerhafte Befehlsausgabe (interner Fehler)"
(2)  391/    E38F : C8                  			ret	z
(2)  392/    E390 : 3A E6 E3            			ld	a, (reslt+1)
(2)  393/    E393 : 4F                  			ld	c, a
(2)  394/    E394 : CB 39               			srl	c
(2)  395/    E396 : 3E 55               			ld	a, 'U'		; Fehler "keine Marke gefunden"
(2)  396/    E398 : D8                  			ret	c
(2)  397/    E399 : CB 39               			srl	c
(2)  398/    E39B : 3E 57               			ld	a, 'W'		; Fehler "Diskette schreibgeschützt"
(2)  399/    E39D : D8                  			ret	c
(2)  400/    E39E : CB 39               			srl	c
(2)  401/    E3A0 : 3E 53               			ld	a, 'S'		; Fehler "Sektor nicht gefunden"
(2)  402/    E3A2 : D8                  			ret	c
(2)  403/    E3A3 : CB 39               			srl	c
(2)  404/    E3A5 : CB 39               			srl	c
(2)  405/    E3A7 : 3E 43               			ld	a, 'C'		; Fehler "CRC-Fehler"
(2)  406/    E3A9 : D8                  			ret	c
(2)  407/    E3AA : CB 39               			srl	c
(2)  408/    E3AC : D8                  			ret	c
(2)  409/    E3AD : 3E 53               			ld	a, 'S'		; Fehler "Sektor nicht gefunden"
(2)  410/    E3AF : C9                  			ret
(2)  411/    E3B0 :                     
(2)  412/    E3B0 :                     ; Read Ident.
(2)  413/    E3B0 : CD B0 E2            readID:		call	rdy		; Laufwerk bereit?
(2)  414/    E3B3 : C0                  			ret	nz
(2)  415/    E3B4 : 01 0A 02            			ld	bc, 20Ah	; com Read Ident
(2)  416/    E3B7 : CD C1 E3            			call	set_mfm_bit
(2)  417/    E3BA : 4F                  			ld	c, a
(2)  418/    E3BB : CD CD E2            			call	wcom	; com. in FDC schreiben
(2)  419/    E3BE : C3 81 E3            			jp	ErrorEval
(2)  420/    E3C1 :                     
(2)  421/    E3C1 :                     ;
(2)  422/    E3C1 : 3A CB E3            set_mfm_bit:ld	a, (ft.kom)
(2)  423/    E3C4 : E6 08               			and	8
(2)  424/    E3C6 : 07                  			rlca
(2)  425/    E3C7 : 07                  			rlca
(2)  426/    E3C8 : 07                  			rlca
(2)  427/    E3C9 : B1                  			or	c
(2)  428/    E3CA : C9                  			ret
(2)  429/    E3CB :                     
(2)  430/    E3CB : 00                  ft.kom:		db	0
(2)  431/    E3CC : 00 00               ft.adr:		dw	0
(2)  432/    E3CE : 00                  ft.lwn:		db	0
(2)  433/    E3CF : 00                  ft.trk:		db	0
(2)  434/    E3D0 : 00                  ft.sid:		db	0
(2)  435/    E3D1 : 00                  ft.sec:		db	0
(2)  436/    E3D2 : 00                  ft.len:		db	0
(2)  437/    E3D3 : 00                  ft.anz:		db	0
(2)  438/    E3D4 : 00                  ft.stp:		db	0
(2)  439/    E3D5 : 00                  ft.sti:		db	0
(2)  440/    E3D6 :                     
(2)  441/    E3D6 : 00                  crerc:		db	0
(2)  442/    E3D7 : 00                  sperc:		db	0
(2)  443/    E3D8 :                     
(2)  444/    E3D8 : 00                  dFDCZ1:		db	0			; Merkzelle FDC Zusatzregister
(2)  445/    E3D9 : 00                  dFDCZ2:		db	0			; Merkzelle FDC Zusatzregister
(2)  446/    E3DA : 46                  CTAB:		db	46h			; Befehlscode für MFM lesen
(2)  447/    E3DB : 00                  UNIT:		db	0			; Kopf/Laufwerksbyte
(2)  448/    E3DC : 00                  TRCK:		db	0			; Spurnummer (Zylinder)
(2)  449/    E3DD : 00                  HED:		db	0 			; Kopfnummer (0,1)
(2)  450/    E3DE : 01                  HSTSEC:		db	1 			; Sektornummer
(2)  451/    E3DF : 03                  N:			db	3 			; relative Sektorlänge 2^N; 3 => 1024 Byte
(2)  452/    E3E0 : FF                  EOT:		db	0FFh 		; Nummer des letzten Sektors
(2)  453/    E3E1 : 10                  GPL:		db	10h 		; Anzahl der Lückenbytes in GAP3
(2)  454/    E3E2 : FF                  DTL:		db	0FFh		; Datenlänge (bei N>0 = 0FFh)
(2)  455/    E3E3 :                     
(2)  456/    E3E3 : 88 13               rdwait:		dw	5000		; timeout-wert für rdy
(2)  457/    E3E5 :                     
(2)  458/    E3E5 :                     ; Resulttab. f. FDC
(2)  459/    E3E5 : 00                  reslt:		db	   0 		; ST0
(2)  460/    E3E6 : 00                  			db	   0 		; ST1
(2)  461/    E3E7 : 00                  			db	   0 		; ST2
(2)  462/    E3E8 : 00                  			db	   0 		; Cyl.
(2)  463/    E3E9 : 00                  			db	   0 		; Head	
(2)  464/    E3EA : 00                  			db	   0		; Record
(2)  465/    E3EB : 00                  			db	   0 		; N
(2)  466/    E3EC :                     ;
(2)  467/    E3EC :                     
(1)  932/    E3EC :                     		
     171/    E3EC :                     
     172/    E3EC :                     
     173/    E3EC :                     ;-----------------------------
     174/    E3EC :                     ; Ausgabe Zeichenkette
     175/    E3EC : F3                  biosms:		di
     176/    E3ED : CD F2 E3            		call	prnst
     177/    E3F0 : FB                  		ei
     178/    E3F1 : C9                  		ret
     179/    E3F2 :                     
     180/    E3F2 : EB                  prnst:		ex	de, hl
     181/    E3F3 : 1A                  prnst1:		LD	A,(DE)
     182/    E3F4 : B7                  		OR	A
     183/    E3F5 : C8                  		RET	Z
     184/    E3F6 : 4F                  		LD	C,A
     185/    E3F7 : CD 60 D9            		CALL	COOUT
     186/    E3FA : 13                  		INC	DE
     187/    E3FB : 18 F6               		JR	prnst1	;OUTX
     188/    E3FD :                     
     189/    E3FD :                     ;-----------------------------
     190/    E3FD :                     ; Kurze Warteschleife
     191/    E3FD : C5                  wait:		push	bc
     192/    E3FE : 0E 0A               		ld	c, 0Ah
     193/    E400 : 06 BD               wait1:		ld	b, 0BDh
     194/    E402 : 10 FE               wait2:		djnz	wait2
     195/    E404 : 0D                  		dec	c
     196/    E405 : 20 F9               		jr	nz, wait1
     197/    E407 : C1                  		pop	bc
     198/    E408 : 10 F3               		djnz	wait
     199/    E40A : C9                  		ret
     200/    E40B :                     
     201/    E40B :                     ;-----------------------------
     202/    E40B :                     ; (HL) nach hex	konvertieren, Eintragen	nach (DE), 2x inc DE
     203/    E40B : 7E                  mbreco:		ld	a, (hl)
     204/    E40C : CD 0F E4            hexa:		call	hexa1		; A nach hex konvertieren, Eintragen nach (DE),	2x inc DE
     205/    E40F : 0F                  hexa1:		rrca
     206/    E410 : 0F                  		rrca
     207/    E411 : 0F                  		rrca
     208/    E412 : 0F                  		rrca
     209/    E413 : F5                  		push	af
     210/    E414 : E6 0F               		and	0Fh
     211/    E416 : D6 0A               		sub	0Ah
     212/    E418 : 38 02               		jr	c, hexa2
     213/    E41A : C6 07               		add	a, 7
     214/    E41C : C6 3A               hexa2:		add	a, 3Ah
     215/    E41E : 12                  		ld	(de), a
     216/    E41F : 13                  		inc	de
     217/    E420 : F1                  		pop	af
     218/    E421 : C9                  		ret
     219/    E422 :                     
     220/    E422 :                     
     221/    E422 :                     ;-----------------------------------------------------------------------------
     222/    E422 :                     ; cboot boot
     223/    E422 :                     ;-----------------------------------------------------------------------------
     224/    E422 :                     
     225/    E422 :                     cboot:
     226/    E422 : C3 00 F0            		jp	0F000h		; Sprung in OS (Kaltstart)
     227/    E425 :                     
     228/    E425 :                     ;-----------------------------------------------------------------------------
     229/    E425 :                     ; CCP von @OS.COM wiederhst.
     230/    E425 :                     ;-----------------------------------------------------------------------------
     231/    E425 :                     
     232/    E425 :                     ;;wboot:
     233/    E425 :                     
     234/    E425 :                     
     235/    E425 :                     ccplod:
     236/    E425 : 0E 0D               	ld	c,13		;;Reset Disksystem (LOGIN neu)
     237/    E427 : CD 06 CB            	call	bdos
     238/    E42A : 3E 00               	ld	a,0
     239/    E42C : =E42BH              ccpldv	equ	$-1		;;Kaltstart-Laufwerk (A=1,B=2,..)
     240/    E42C : 32 89 E4            	ld	(fcb_os),a
     241/    E42F : AF                  	xor	a
     242/    E430 : 5F                  	ld	e,a		;;user 0
     243/    E431 : 32 95 E4            	ld	(fcb_os+12),a	;;extent
     244/    E434 : 3C                  	inc	a		;;ab Satz 1 lesen
     245/    E435 : 32 A9 E4            	ld	(fcb_os+32),a
     246/    E438 : 0E 20               	ld	c,32		;;set user 0
     247/    E43A : CD 06 CB            	call	bdos
     248/    E43D : 0E 0F               	ld	c,15		;;open
     249/    E43F : CD AC E4            	call	de_os
     250/    E442 : 3C                  	inc	a		;;Datei da?
     251/    E443 : 28 28               	jr	z,nosys_	;;nein
     252/    E445 : 06 10               	ld	b,(800h+127)/128	;;128er records Länge CCP
     253/    E447 : 21 00 C3            	ld	hl,CCP		;;Zieladresse
     254/    E44A : C5                  ccpldz:	push	bc
     255/    E44B : E5                  	push	hl
     256/    E44C : EB                  	ex	de,hl
     257/    E44D : 0E 1A               	ld	c,26		;;setdma
     258/    E44F : CD 06 CB            	call	bdos
     259/    E452 : CD AA E4            	call	rd_os		;;read
     260/    E455 : B7                  	or	a		;;Fehler?
     261/    E456 : 20 13               	jr	nz,nosyst	;;ja
     262/    E458 : 2A 01 C3            	ld	hl,(CCP+1)	;;Test, ob richtiges @OS.COM
     263/    E45B : 01 00 00            	ld	bc,0		;;bevor BDOS-Anfang ueberladen!
     264/    E45E : =E45CH              ccpjpm	equ	$-2		;;vom Kaltstart hinterlegt
     265/    E45E : ED 42               	sbc	hl,bc		;;stimmt Sprungadresse?
     266/    E460 : 20 09               	jr	nz,nosyst	;;nein, falsches CCP
     267/    E462 : E1                  	pop	hl
     268/    E463 : 01 80 00            	ld	bc,80h
     269/    E466 : 09                  	add	hl,bc
     270/    E467 : C1                  	pop	bc
     271/    E468 : 10 E0               	djnz	ccpldz
     272/    E46A :                     ;	jr	ccplde		;ok
     273/    E46A :                     ccplde:
     274/    E46A :                     ;;	ld	hl, BDOS
     275/    E46A :                     ;;	ld	bc, 5
     276/    E46A :                     ;;	ld	(HL), 0
     277/    E46A :                     ;;	ld	DE, BDOS+1
     278/    E46A :                     ;;	ldir			;BDOS-Kopf wiederherstellen
     279/    E46A : C9                  	ret
     280/    E46B :                     
     281/    E46B : E1                  nosyst:	pop	hl
     282/    E46C : C1                  	pop	bc
     283/    E46D :                     nosys_:
     284/    E46D : 21 7B E4            	ld	hl,nosysd
     285/    E470 : CD EC E3            	call	biosms
     286/    E473 : C9                  	ret		;; test
     287/    E474 :                     ;;	call	headup		;;Verriegelung oeffnen
     288/    E474 : 06 C8               	ld	b,200		;;200* 10ms
     289/    E476 : CD 00 E4            	call	wait1		;;warten
     290/    E479 : 18 AA               	jr	ccplod		;;neuer Versuch
     291/    E47B :                     nosysd:
     292/    E47B : 0D 0A 4E 6F 20 53   	db	0dh,0ah,"No Sysdisk!",0
                    79 73 64 69 73 6B 
                    21 00 
     293/    E489 :                     
     294/    E489 : 01                  fcb_os:	db	01		;;LW
     295/    E48A : 40 5A 31 30 31 33   	db	"@Z1013  COM"
                    20 20 43 4F 4D 
     296/    E495 : 00 00 00 00 00 00   	db	21 dup(0)
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 
     297/    E4AA : 0E 14               rd_os:	ld	c,20
     298/    E4AC : 11 89 E4            de_os:	ld	de,fcb_os
     299/    E4AF : C3 06 CB            	jp	bdos
     300/    E4B2 :                     
     301/    E4B2 :                     
     302/    E4B2 :                     ;-----------------------------------------------------------------------------
     303/    E4B2 :                     ; wboot,
     304/    E4B2 :                     ;-----------------------------------------------------------------------------
     305/    E4B2 :                     
     306/    E4B2 :                     wboot:
     307/    E4B2 :                     
     308/    E4B2 :                     wboot00:
     309/    E4B2 : 21 03 C3            		ld	hl, CCP+0003h
     310/    E4B5 :                     
     311/    E4B5 : 22 08 E5            wboot3:		ld	(wboot3u1+1), hl
     312/    E4B8 :                     
     313/    E4B8 : F3                  		di
     314/    E4B9 : 3E E5               		ld	a, hi(intvectab)	;E7H
     315/    E4BB : ED 47               		ld	i, a
     316/    E4BD : ED 5E               		im	2
     317/    E4BF :                     
     318/    E4BF : 3E C3               		ld	a, 0C3h		; Befehlscode JP
     319/    E4C1 : 32 00 00            		ld	(0), a		; 0000h: jp wboot
     320/    E4C4 : 32 38 00            		ld	(38h), a	; 0038h: RST 38H, jp wboot
     321/    E4C7 : 21 03 D9            		ld	hl, BIOS+3	; wboot	im upper Bios
     322/    E4CA : 22 01 00            		ld	(1), hl
     323/    E4CD : 22 39 00            		ld	(39h), hl
     324/    E4D0 : 32 05 00            		ld	(5), a		; 0005h: jp bdos
     325/    E4D3 : 21 06 CB            wboot0:		ld	hl, BDOS
     326/    E4D6 : 22 06 00            		ld	(6), hl
     327/    E4D9 :                     
     328/    E4D9 :                     		;ld	a, 0C7h
     329/    E4D9 :                     		;out	(CTC3), a
     330/    E4D9 :                     		;ld	a, 40h
     331/    E4D9 :                     		;out	(CTC3), a
     332/    E4D9 :                     
     333/    E4D9 : 3E FF               		ld	a, 0FFh
     334/    E4DB : 32 53 E1            		ld	(dbdev), a
     335/    E4DE :                     
     336/    E4DE : 21 04 00            wboot1:		ld	hl, DISKA
     337/    E4E1 : 4E                  		ld	c, (hl)
     338/    E4E2 : C5                  		push	bc
     339/    E4E3 : 79                  		ld	a, c
     340/    E4E4 : E6 0F               		and	0Fh
     341/    E4E6 : 4F                  		ld	c, a
     342/    E4E7 : AE                  		xor	(hl)
     343/    E4E8 : F6 00               wboot2:		or	0		; Std-Laufwerk, wird gepatcht
     344/    E4EA : 77                  		ld	(hl), a
     345/    E4EB : 1E 01               		ld	e, 1
     346/    E4ED : CD 06 DC            		call	seldsk
     347/    E4F0 : C1                  		pop	bc
     348/    E4F1 : 7C                  		ld	a, h
     349/    E4F2 : B5                  		or	l
     350/    E4F3 : 28 E9               		jr	z, wboot1		; bei SELDSK-Fehler ist HL=0
     351/    E4F5 :                     
     352/    E4F5 :                     		;CCP laden
     353/    E4F5 : 31 80 00            		ld	sp, 80h
     354/    E4F8 : 3A C0 E5            		ld	a,(firstrun)
     355/    E4FB : B7                  		or	a
     356/    E4FC : CC 25 E4            		call	z,ccplod
     357/    E4FF : AF                  		xor	a
     358/    E500 : 32 C0 E5            		ld	(firstrun),a
     359/    E503 : 21 04 00            		ld	hl, DISKA
     360/    E506 : 4E                  		ld	c, (hl)
     361/    E507 : C3 03 C3            wboot3u1:	jp	CCP+0003h	; CLEAR: CCP-Aufruf mit	Löschen	des Befehlsbuffers
     362/    E50A :                     
     363/    E50A :                     ;-----------------------------------------------------------------------------
     364/    E50A :                     ; write disk
     365/    E50A :                     ;-----------------------------------------------------------------------------
     366/    E50A : 2A DE E5            _write1:	ld	hl, (ddma)
     367/    E50D : 11 24 E7            		ld	de, rwbuffer
     368/    E510 : C5                  		push	bc
     369/    E511 : 01 80 00            		ld	bc, 80h
     370/    E514 : ED B0               		ldir
     371/    E516 : C1                  		pop	bc
     372/    E517 : C3 15 DE            		jp	write			; WRITE	im Schattenbios
     373/    E51A :                     
     374/    E51A :                     ;-----------------------------------------------------------------------------
     375/    E51A :                     ; read disk
     376/    E51A :                     ;-----------------------------------------------------------------------------
     377/    E51A :                     _read1:
     378/    E51A : ED 73 DC E5         		ld	(stackp), sp	; Zwischenspeicher Stackpointer
     379/    E51E : 31 FF EB            		ld	sp, biosstack	; Adr. BIOS-Stackbereich
     380/    E521 : CD 79 DE            		call	read		; READ im Schattenbios
     381/    E524 : ED 7B DC E5         		ld	sp, (stackp)	; Zwischenspeicher Stackpointer
     382/    E528 : 21 24 E7            		ld	hl, rwbuffer
     383/    E52B : ED 5B DE E5         		ld	de, (ddma)
     384/    E52F : 01 80 00            		ld	bc, 80h
     385/    E532 : ED B0               		ldir
     386/    E534 : B7                  		or	a
     387/    E535 : C9                  		ret
     388/    E536 :                     ;
     389/    E536 :                     ;-----------------------------------------------------------------------------
     390/    E536 :                     ; CPA-Disk-Parameter
     391/    E536 :                     ;-----------------------------------------------------------------------------
     392/    E536 :                     ;Disk-Parameter-Header
     393/    E536 : 00 00               dph0:	dw	0		; XLT	translation table
     394/    E538 : 00 00               		dw	0
     395/    E53A : 00 00               		dw	0
     396/    E53C : 00 00               		dw	0
     397/    E53E : E0 E5               		dw	dirbuf		; DIRBUF
     398/    E540 : 5A E5               		dw	dpb0		; DPB
     399/    E542 : 92 E6               		dw	CSV0		; CSV
     400/    E544 : 60 E6               		dw	ALV0		; ALV
     401/    E546 :                     
     402/    E546 : 00 00               dph1:	dw	0		; XLT	translation table
     403/    E548 : 00 00               		dw	0
     404/    E54A : 00 00               		dw	0
     405/    E54C : 00 00               		dw	0
     406/    E54E : E0 E5               		dw	dirbuf		; DIRBUF
     407/    E550 : 8D E5               		dw	dpb1  		; DPB
     408/    E552 : F4 E6               		dw	CSV1		; CSV
     409/    E554 : C2 E6               		dw	ALV1		; ALV
     410/    E556 :                     ;
     411/    E556 : =E556H              DPHBER	EQU	$
     412/    E556 :                     
     413/    E556 : 36 E5               dphtab:	dw	dph0
     414/    E558 : 46 E5               		dw	dph1
     415/    E55A :                     
     416/    E55A :                     
     417/    E55A :                     ;Disp-Parameter-Blöcke
     418/    E55A :                     ;800K-Laufwerk 80 Spuren DS, DD
     419/    E55A : 28 00               dpb0:	dw	40		; SPT	40 Sektoren/Spur
     420/    E55C : 04                  		db 	4		; BSH	= log2(blocksize/128)
     421/    E55D :                     					;  => blocksize = (2^4)*128 = 2048
     422/    E55D : 0F                  		db 	00001111b	; BLM	= 2^BSH-1
     423/    E55E : 00                  		db 	0		; EXM
     424/    E55F : 8F 01               		dw	400-1		; DSM	max. 400 Blöcke
     425/    E561 :                     					;  => also 400*2048 = 800K disc
     426/    E561 : BF 00               		dw	192-1		; DRM	max 192 Dir. Einträge
     427/    E563 : E0                  		db 	11100000b	; AL0	also 3 Blöcke (192*32 / 2048)
     428/    E564 : 00                  		db 	0		; AL1	für DIR reservieren
     429/    E565 : 30 00               		dw	48		; CKS	= (DRM+1)/4
     430/    E567 : 00 00               		dw	0		; OFF	0 reservierte Spuren
     431/    E569 :                     ;Erweiternung DBP des Z9001-CBIOS
     432/    E569 : 20                  		db  	00100000b 	; DPB-Steuerinformationen
     433/    E56A :                     					; bit 5=1 Double sided zu betreiben
     434/    E56A : 03                  		db    	3 		; Sektorlaengencode
     435/    E56B : 07                  		db    	7 		; Puffermaske 8*128
     436/    E56C : 01                  		db    	1 		; Zahl der Stepimpulse
     437/    E56D : 00                  		db    	0  		; keine Weiter-Numm. auf Rueckseite
     438/    E56E : 50                  		db  	80		; benutzte Zahl phys. Spuren
     439/    E56F : 00                  		db    	0  		; (dbp+15h) phys. LW-Nr. (0 --> A:)
     440/    E570 : 50                  		db  	80		; Gesamtzahl physische Spuren (wird in FORMATZ abgefragt)
     441/    E571 : 28                  		db	4*10		; Schrittzeit fuer 80 Tr. DS LW
     442/    E572 : 39                  		db	00111001b	; vom Laufwerkstyp abhaengige Flags
     443/    E573 :                     					; bit 0=0 bei SS, =1 bei DS
     444/    E573 :                     					; bit 3=0 bei SD (FM), =1 bei DD (MFM)
     445/    E573 :                     					; bit 4=0 bei 8", =1 bei 5"
     446/    E573 :                     					; bit 5=0 bei nicht 80-Spur, =1 bei 80-Spur
     447/    E573 :                     					; bit 6=0 ohne, =1 mit Verify nach Schreiben
     448/    E573 :                     					; bit 7=0 bei max 26 ,=1 bei max 52 Sekt./Spur (8" MFM)
     449/    E573 :                     ;translation tab dbp0
     450/    E573 : 01 02 03 04 05 06   		db	1,2,3,4,5,6,7,8,9,10,11,12,13,14
                    07 08 09 0A 0B 0C 
                    0D 0E 
     451/    E581 : 0F 10 11 12 13 14   		db	15,16,17,18,19,20,21,22,23,24,25,26
                    15 16 17 18 19 1A 
     452/    E58D :                     
     453/    E58D : 28 00               dpb1:	dw	40		; SPT	40 Sektoren/Spur
     454/    E58F : 04                  		db 	4               ; BSH	= log2(blocksize/128)
     455/    E590 :                                                             ;  => blocksize = (2^4)*128 = 2048
     456/    E590 : 0F                  		db 	00001111b       ; BLM	= 2^BSH-1
     457/    E591 : 00                  		db 	0               ; EXM
     458/    E592 : 8F 01               		dw	400-1           ; DSM	max. 400 Blöcke
     459/    E594 :                                                             ;  => also 400*2048 = 800K disc
     460/    E594 : BF 00               		dw	192-1           ; DRM	max 192 Dir. Einträge
     461/    E596 : E0                  		db 	11100000b       ; AL0	also 3 Blöcke (192*32 / 2048)
     462/    E597 : 00                  		db 	0               ; AL1	für DIR reservieren
     463/    E598 : 30 00               		dw	48              ; CKS	= (DRM+1)/4
     464/    E59A : 00 00               		dw	0               ; OFF	0 reservierte Spuren
     465/    E59C :                     ; CPA-Erweiterung
     466/    E59C : 20                  		db  	00100000b 	; DPB-Steuerinformationen
     467/    E59D :                     					; Bit5=1 Double sided zu betreiben
     468/    E59D : 03                  		db    	3 		; Sektorlaengencode
     469/    E59E : 07                  		db    	7 		; Puffermaske 8*128
     470/    E59F : 01                  		db    	1 		; Zahl der Stepimpulse
     471/    E5A0 : 00                  		db    	0  		; keine Weiter-Numm. auf Rueckseite
     472/    E5A1 : 50                  		db  	80		; benutzte Zahl phys. Spuren
     473/    E5A2 : 01                  		db    	1  		; (dbp+15h) phys. LW-Nr. (1 --> B:)
     474/    E5A3 : 50                  		db  	80		; Gesamtzahl physische Spuren (wird in FORMATZ abgefragt)
     475/    E5A4 : 28                  		db	4*10		; Schrittzeit fuer 80 Tr. DS LW
     476/    E5A5 : 39                  		db	00111001b	; vom Laufwerkstyp abhaengige Flags
     477/    E5A6 :                     					; bit 0=0 bei SS, =1 bei DS
     478/    E5A6 :                     					; bit 3=0 bei SD (FM), =1 bei DD (MFM)
     479/    E5A6 :                     					; bit 4=0 bei 8", =1 bei 5"
     480/    E5A6 :                     					; bit 5=0 bei nicht 80-Spur, =1 bei 80-Spur
     481/    E5A6 :                     					; bit 6=0 ohne, =1 mit Verify nach Schreiben
     482/    E5A6 :                     					; bit 7=0 bei max 26 ,=1 bei max 52 Sekt./Spur (8" MFM)
     483/    E5A6 :                     ; translation tab dbp1
     484/    E5A6 : 01 02 03 04 05 06   		db	1,2,3,4,5,6,7,8,9,10,11,12,13,14
                    07 08 09 0A 0B 0C 
                    0D 0E 
     485/    E5B4 : 0F 10 11 12 13 14   		db	15,16,17,18,19,20,21,22,23,24,25,26
                    15 16 17 18 19 1A 
     486/    E5C0 :                     
     487/    E5C0 : 01                  firstrun	db	1
     488/    E5C1 :                     
     489/    E5C1 : =E5C1H              ubiosend:	equ	$
     490/    E5C1 :                     ;-----------------------------------------------------------------------------
     491/    E5C1 :                     		align	10h
     492/    E5D0 :                     		;align	80h		; align 100h geht irgendwie nicht, nextpage auch nicht wg. phase
     493/    E5D0 :                     					; intvectab muß aber auf ..00-Adresse liegen!
     494/    E5D0 :                     		;align 100H
     495/    E5D0 :                     
     496/    E5D0 : =E5D0H              intvectab	equ	$		; Interruptvektortabelle, 12 Byte
     497/    E5D0 :                     
     498/    E5D0 :                     		;if	intvectab # 100h <> 0
     499/    E5D0 :                     		;ERROR  "intvectab % 100h"
     500/    E5D0 :                     		;endif
     501/    E5D0 :                     
     502/    E5D0 :                     
     503/    E5D0 : =E5DCH              stackp:		equ	intvectab+12	; Zwischenspeicher Stackpointer
     504/    E5D0 : =E5DEH              ddma:		equ	stackp+2	; aktuelle DMA-Adresse
     505/    E5D0 : =E5E0H              dirbuf:		equ	ddma+2		; Bereich 128 Byte
     506/    E5D0 :                     
     507/    E5D0 : =E660H              ALV0:		equ	dirbuf+128	; = DSM/8+1 = 399/8+1 = 50
     508/    E5D0 : =E692H              CSV0:		equ	ALV0+50 	; = CKS (also 48)
     509/    E5D0 : =E6C2H              ALV1:		equ	CSV0+48
     510/    E5D0 : =E6F4H              CSV1:		equ	ALV1+50
     511/    E5D0 : =E724H              rwbuffer:	equ	CSV1+48		;128 Byte Buffer für _read/_write
     512/    E5D0 :                     
     513/    E5D0 : =E7A4H              fdcbuffer:	equ	rwbuffer+80h 	; Buffer für FDC-IO-Operation (1K? 2K?)
     514/    E5D0 :                     
     515/    E5D0 : =EBA4H              ubiosend0:	equ	fdcbuffer+400h
     516/    E5D0 :                     
     517/    E5D0 : =>FALSE             		if	ubiosend0 > RAMEND-20
     519/    E5D0 : [517]               		endif
     520/    E5D0 :                     
     521/    E5D0 : =EBFFH              biosstack	equ	RAMEND		; Stackbereich	für BIOS (nur read disk)
     522/    E5D0 :                     
     523/    E5D0 :                     
     524/    E5D0 :                     ; ENDE BIOS
     525/    E5D0 :                     ;-----------------------------------------------------------------------------
     526/    E5D0 :                     
     527/    E5D0 :                     
     528/    6350 :                     		dephase
     529/    6350 :                     
     530/    6350 : =6350H              ccpende		equ	$
     531/    6350 :                     
     532/    62D0 :                     		phase	loadadress+ccpende-ccpstart
     533/    62D0 :                     
     534/    62D0 :                     ;-----------------------------------------------------------------------------
     535/    62D0 :                     ;EINMALIGE AUSFÜHRUNG BEIM INITIALEN LADEN
     536/    62D0 :                     
     537/    62D0 :                     
     538/    62D0 :                     ;>>>>>>>>>>>>>>>>>>
     539/    62D0 :                     ;-----------------------------------------------------------------------------
     540/    62D0 :                     ; cold boot
     541/    62D0 :                     ; Einsprung durch Init nach Bootloader, Initialisierung von cold und BIOS
     542/    62D0 :                     ; IN A: Boot-Laufwerk (A=0, B=1, ..)
     543/    62D0 :                     ;-----------------------------------------------------------------------------
     544/    62D0 :                     
     545/    62D0 : F3                  cold:	di
     546/    62D1 : 31 80 00            		ld	sp, 80h
     547/    62D4 :                     
     548/    62D4 : F5                  		push	af		; boot-Laufwerk merken
     549/    62D5 :                     
     550/    62D5 :                     		; CCP und BDOS und BIOS kopieren
     551/    62D5 : 11 00 C3            		ld	de, CCP
     552/    62D8 : 21 00 40            		ld	hl, LOADADRESS	;ccpstart
     553/    62DB : 01 BC 23            		ld	bc, biosend-ccpstart	;Länge CCP+BDOS
     554/    62DE : ED B0               		ldir
     555/    62E0 :                     ;		call BCLS	;Init Statuszeile
     556/    62E0 :                     ;		call UHRINI
     557/    62E0 :                     ;		call Zeit1
     558/    62E0 :                     		;call RPinit
     559/    62E0 : 3E 00               		ld	a,0H	;00000010b
     560/    62E2 : 32 03 00            		ld	(IOLOC),a
     561/    62E5 :                     
     562/    62E5 :                     ;-----------------------------------------------------------------------------
     563/    62E5 :                     ;
     564/    62E5 :                     ; Startmeldung,
     565/    62E5 :                     ; Initialisieren Geräte,
     566/    62E5 :                     ; starten des CCP-Systems
     567/    62E5 :                     ; Register A: untere 2 Bit Laufwerk; Bit 7 = 1 Warmstart
     568/    62E5 :                     ; Bei Bit7=0 Kaltstart mit kompletter Initialisierung, es
     569/    62E5 :                     ; kann ein Kommando beim start des CCP ausgeführt werden
     570/    62E5 :                     ;
     571/    62E5 :                     ;-----------------------------------------------------------------------------
     572/    62E5 :                     
     573/    62E5 :                     		; CRT-Gerätetreiber init
     574/    62E5 : CD 87 DB            		call	INIT_CRT
     575/    62E8 : CD F9 DB            		call	INIT_PRN
     576/    62EB :                     
     577/    62EB : F1                  		pop	af		; boot-Laufwerk
     578/    62EC :                     
     579/    62EC : E6 03               		and	3
     580/    62EE : 32 04 00            		ld	(DISKA), a		; Standard-Laufwerk
     581/    62F1 : 32 E9 E4            		ld	(wboot2+1), a
     582/    62F4 :                     
     583/    62F4 :                     	; f. @OS-Load
     584/    62F4 : 3C                  		inc	a		;von Kaltstart-Laufwerk
     585/    62F5 : 32 2B E4            		ld	(ccpldv),a
     586/    62F8 : 2A 01 C3              		ld	hl,(CCP+1)	;fuer Warmstart-Kontrolle
     587/    62FB : 22 5C E4            		ld	(ccpjpm),hl	;Sprungadresse aus CCP hinterlegen
     588/    62FE :                     
     589/    62FE : 3E E5               		ld	a, hi(intvectab); Interrupttabelle
     590/    6300 : ED 47               		ld	i, a		; Interruptregister setzen
     591/    6302 : ED 5E               		im	2
     592/    6304 :                     
     593/    6304 :                     ; 4 MHz
     594/    6304 : DB 04               		IN	A,(4)	
     595/    6306 : CB F7               		SET	6,A	
     596/    6308 : D3 04               		OUT	(4),A		;4 MHz - Peters Platine
     597/    630A :                     ;
     598/    630A :                     
     599/    630A :                     ; Initialisierung FDC
     600/    630A : 3E 20               		ld	a, 20h		; 0010 0000 FDC	Reset
     601/    630C : D3 A0               		out	(FDCZ),	a
     602/    630E : 3E 13               		ld	a, 13h		; 0001 0011 Terminal Count aktivieren, Motor LW	1+2 an
     603/    6310 : D3 A0               		out	(FDCZ),	a
     604/    6312 :                     ;
     605/    6312 :                     
     606/    6312 : 06 00               binit1:		ld	b, 0		;INITIALISIERUNG P8272
     607/    6314 : 10 FE               binit2:		djnz	binit2
     608/    6316 : DB 98               		in	a, (FDCD)
     609/    6318 : FE 80               		cp	80h
     610/    631A : 28 06               		jr	z, binit4
     611/    631C : DB 99               		in	a, (FDCC)
     612/    631E : 18 F2               		jr	binit1
     613/    6320 :                     ;
     614/    6320 :                     
     615/    6320 :                     stab:
     616/    6320 : 9F                  		db  	10011111b	;XXXX=Schrittratenzeit SRT,XXXX= Kopfladezeit HUT
     617/    6321 : 3F                  		db  	00111111b	;XXXXXXX=Kopfladezeit HLT,X=no dma ND
     618/    6322 :                     
     619/    6322 : 21 1F 63            binit4:		ld	hl, stab-1	;PARAMETER LADEN
     620/    6325 : 01 03 03            		ld	bc, 303h	;SPECIFY-COMM 3BYTES
     621/    6328 : CD D0 E2            		call	wcom1		;SCHREIBEN COMM
     622/    632B : AF                  		xor	a
     623/    632C : 32 DB E3            		ld	(UNIT), a
     624/    632F : 32 D8 E3            		ld	(dFDCZ1), a
     625/    6332 : CD 61 E2            		call	recal2
     626/    6335 : CD 8C E2            		call	sds
     627/    6338 : CB 67               		bit	4, a
     628/    633A : 3E 01               		ld	a, 1
     629/    633C : 28 03               		jr	z, binit5
     630/    633E : 32 D8 E3            		ld	(dFDCZ1), a
     631/    6341 : 32 DB E3            binit5:		ld	(UNIT), a
     632/    6344 : CD 61 E2            		call	recal2
     633/    6347 : CD 8C E2            		call	sds
     634/    634A : CB 67               		bit	4, a
     635/    634C : 3A D8 E3            		ld	a, (dFDCZ1)
     636/    634F : 28 05               		jr	z, binit6
     637/    6351 : F6 02               		or	2
     638/    6353 : 32 D8 E3            		ld	(dFDCZ1), a
     639/    6356 :                     binit6:
     640/    6356 : D3 A0               		out	(FDCZ), a	; ZusatzRegister FDC schreiben
     641/    6358 :                     
     642/    6358 : FB                  		ei
     643/    6359 :                     binit7:
     644/    6359 : 21 22 E4            		ld	hl, cboot	; Patchen BIOS-Verteiler (JP cboot)
     645/    635C : 22 01 D9            		ld	(BIOS+1), hl
     646/    635F :                     
     647/    635F : 21 76 63            		ld	hl, bootmsg	; Anzeige Boot-Meldung
     648/    6362 :                     
     649/    6362 : CD F2 E3            		call	prnst		; Stringausgabe
     650/    6365 :                     
     651/    6365 : 21 BB 63            binit12:	ld	hl, startkdo	; start-Kommando
     652/    6368 : 11 07 C3            		ld	de, CCP+0007h	; CCP-Befehlsbuffer
     653/    636B : 01 81 00            		ld	bc, 81h		; 80 Byte + 1 Längenbyte
     654/    636E : ED B0               		ldir
     655/    6370 :                     
     656/    6370 : 21 00 C3            		ld	hl, CCP		; cboot:	CCP-start mit Ausführung des startkdo :-))
     657/    6373 :                     		;ld	hl, CCP+0003	; cboot:	CCP-Aufruf mit Löschen des Befehlsbuffers
     658/    6373 :                     
     659/    6373 : C3 B5 E4            		jp	wboot3		; WBOOT	im Bios
     660/    6376 :                     
     661/    6376 :                     
     662/    6376 :                     ;-----------------------------------------------------------------------------
     663/    6376 :                     ;
     664/    6376 :                     ;-----------------------------------------------------------------------------
     665/    6376 :                     
     666/    6376 :                     bootmsg:	;db  	0Ch
     667/    6376 : 43 50 2F 41 20 5A   		db	"CP/A Z1013   ", DATE,0Dh, 0Ah
                    31 30 31 33 20 20 
                    20 33 2F 31 32 2F 
                    32 30 31 37 0D 0A 
     668/    638E : 46 2E 53 2E 2C 20   		db  	"F.S., V.P., H.P, T.Z.",0Dh, 0Ah
                    56 2E 50 2E 2C 20 
                    48 2E 50 2C 20 54 
                    2E 5A 2E 0D 0A 
     669/    63A5 : 0D 0A               		db	0Dh, 0Ah
     670/    63A7 : 54 50 41 3A 20 31   		db	"TPA:"," 100H - \{BDOS-1}H",0Dh, 0Ah
                    30 30 48 20 2D 20 
                    43 42 30 35 48 0D 
                    0A 
     671/    63BA :                     ;		db	0Dh, 0Ah
     672/    63BA :                     ;		db	"Laufwerke:",0Dh, 0Ah
     673/    63BA :                     ;		db	0Dh, 0Ah
     674/    63BA :                     ;		db	"A: Floppy-Disk 3,5/5", '"', "(80,DS)",0Dh, 0Ah
     675/    63BA :                     ;		db	"B: Floppy-Disk 3,5/5", '"', "(80,DS)",0Dh, 0Ah
     676/    63BA :                     ;		db	0Dh, 0Ah
     677/    63BA :                     ;
     678/    63BA :                     ;	if condev = 1
     679/    63BA :                     ;		db	"Peters-Platine 64x16",0Dh, 0Ah
     680/    63BA :                     ;	elseif condev = 2
     681/    63BA :                     ;		db	"K1520-BWS H.P.",0Dh, 0Ah
     682/    63BA :                     ;	endif
     683/    63BA :                     ;	if lstdev = 1
     684/    63BA :                     ;		db	"LPT: V24 9600 Baud",0Dh, 0Ah
     685/    63BA :                     ;	endif
     686/    63BA :                     ;		db	0Dh, 0Ah
     687/    63BA : 00                  		db 	0
     688/    63BB :                     
     689/    63BB :                     ; hier kann ein	Befehl eingetragen werden, der beim Start des CCP ausgeführt werden soll
     690/    63BB : 7F                  startkdo:	db  	7Fh	; Länge	des Befehls(buffers)
     691/    63BC : 53 55 42 4D 49 54   			db	"SUBMIT AUTOEXEC"	;db 	"STAT"
                    20 41 55 54 4F 45 
                    58 45 43 
     692/    63CB : 00 00 00 00 00 00   			db	128-($-startkdo-1) dup (0)	; mit 00 auffüllen
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 00 
                    00 00 00 00 00 
     693/    643C :                     
     694/    643C : =643CH              biosend:	equ	$
     695/    643C :                     
     696/    643C : =643CH              ende:		equ	$
     697/    643C :                     
     698/    643C : =>TRUE              	if MOMPASS > 1
     699/    643C :                     	outradix	16
=====================
     700/    643C :                     	message	       "====================="
cpm:		C300H
     701/    643C :                     	message	       "cpm:		\{ccp}H"
bdos:		CB06H
     702/    643C :                     	message	       "bdos:		\{bdos}H"
bios:		D900H - EBA4H
     703/    643C :                     	message	       "bios:		\{bios}H - \{ubiosend0}H"
RAM end:        EBFFH
     704/    643C :                     	message        "RAM end:        \{RAMEND}H"
=====================
     705/    643C :                     	message	       "====================="
     706/    643C : [698]               	endif
     707/    643C :                     
     708/    643C :                     
     709/    643C :                     ;------------------------------------------------------------------
     710/    643C :                     ; PATCHES
     711/    643C :                     
     712/    643C :                     	; Konsole
     713/    643C : =>FALSE             	if condev = 0
     717/    643C : [713]               	endif
     718/    643C :                     	
     719/    643C :                     		end
 AS V1.42 Beta [Bld 115] - source file cpa_Z1013.asm - page 2 - 3/12/2017 11:04:02
Z1013 BIOS


  symbol table (* = unused):
  ------------------------

*A20_11_88 [BDOS] :            D8F8 C |  ACOM [CCP] :                  CA7F C |
 ADDH [BDOS] :                 D01E C |  ADDLIST [BDOS] :                 8 - |
 ALLMSG [CCP] :                C3DB C |  ALLOC :                       DE91 C |
 ALLOCA [BDOS] :               D8BF C |  ALLOCATED [BDOS] :            CF43 C |
 ALLOCWD [BDOS] :              D531 C |  ALV0 :                        E660 - |
 ALV1 :                        E6C2 - | *ANFANG :                      4000 C |
 ANKXY :                       DAEA C | *ARCHITECTURE :  i386-unknown-win32 - |
 ARECORD [BDOS] :              D8E5 C |  ARECORD1 [BDOS] :             D8E7 C |
 ARET [BDOS] :                 CE10 C |  ATRAN [BDOS] :                CF49 C |
 ATRAN0 [BDOS] :               CF4F C |  BACKSP [BDOS] :               CD5F C |
 BACKUP [BDOS] :               CC91 C |  BACKX [BDOS] :                CD29 C |
 BADSEEK [BDOS] :              D643 C |  BDOS :                        CB06 - |
 BDOS [CCP] :                     5 - | *BDOSA [BDOS] :                   6 - |
 BDOSE [BDOS] :                CB63 C | *BDOSR [CCP] :                 CB06 - |
 BDOS_COND [CCP] :             C471 C |  BDOS_INR [CCP] :              C446 C |
 BDOS_JMP [CCP] :              C462 C |  BEEP :                        FFDC - |
 BEEPA :                       DA4C - | *BIGENDIAN :                      0 - |
 BINIT1 :                      6312 C | *BINIT12 :                     6365 C |
 BINIT2 :                      6314 C |  BINIT4 :                      6322 C |
 BINIT5 :                      6341 C |  BINIT6 :                      6356 C |
*BINIT7 :                      6359 C |  BIOS :                        D900 - |
 BIOS [BDOS] :                 D900 - |  BIOSEND :                     643C - |
 BIOSMS :                      E3EC C |  BIOSR [CCP] :                 D900 - |
 BIOSSTACK :                   EBFF - | *BIOSSTART :                   5680 - |
 BLANK [CCP] :                 C3F2 C |  BLKMSK [BDOS] :               D8C4 C |
 BLKSHF [BDOS] :               D8C3 C |  BLOCKOK [BDOS] :              D517 C |
*BOOTF [BDOS] :                D900 - |  BOOTMSG :                     6376 C |
*BOS :                         D006 - | *BRANCHEXT :                      0 - |
 BREAK [CCP] :                 C3CF C |  BREAKF [CCP] :                   B - |
 BREAK_KEY [CCP] :             C481 C |  BSTP :                        DA13 C |
 BUFF [CCP] :                    80 - |  BUFFA [BDOS] :                D8B9 C |
 BUFFNZERO [BDOS] :            D3C6 C |  BWSA :                        EC00 - |
 BWSE :                        EFFF - |  BYTE [BDOS] :                    1 - |
*CASESENSITIVE :                  0 - |  CBOOT :                       E422 C |
 CCP :                         C300 - |  CCP [CCP] :                   C661 C |
 CCP0 [CCP] :                  C691 C |  CCPCLEAR [CCP] :              C61B C |
 CCPENDE :                     6350 - |  CCPJPM :                      E45C - |
*CCPLDE :                      E46A C |  CCPLDV :                      E42B - |
 CCPLDZ :                      E44A C | *CCPLOC [CCP] :                C300 - |
 CCPLOD :                      E425 C |  CCPSTART :                    4080 - |
 CCPSTART [CCP] :              C61F C |  CDISK [CCP] :                 C5D8 C |
 CDRMAXA [BDOS] :              D8B3 C |  CHECKA [BDOS] :               D8BD C |
 CHECKSUM [BDOS] :             D058 C |  CHECK_RODIR [BDOS] :          CFFE C |
 CHECK_ROFILE [BDOS] :         D001 C |  CHECK_WRITE [BDOS] :          D00E C |
 CHIT :                        DB66 C |  CHKSIZ [BDOS] :               D8CC C |
 CHOME :                       DA68 C |  CHRET :                       DB6F C |
 CHTI :                        DB73 C |  CLCU :                        DA76 C |
 CLK [CCP] :                   C83F C |  CLK1 [CCP] :                  C844 C |
 CLKBCD [CCP] :                  50 - |  CLOSE [CCP] :                 C44E C |
 CLOSE [BDOS] :                D38A C |  CLOSECOM [CCP] :              C44B C |
 CLOSEF [CCP] :                  10 - |  CLRMODNUM [BDOS] :            D02C C |
 CLS :                         DA2C C |  COLD :                        62D0 C |
 COLUMN [BDOS] :               CDC8 C |  COMADDR [CCP] :               C6A0 C |
 COMBUF [CCP] :                C308 C |  COMERR [CCP] :                C9C8 C |
 COMERR0 [CCP] :               C795 C |  COMERRN [CCP] :               C540 C |
 COMERRX [CCP] :               C8D2 C |  COMLEN [CCP] :                C307 C |
 COMPCDR [BDOS] :              D039 C |  COMPCOL [BDOS] :              CDC6 C |
 COMPEXT [BDOS] :              D1B8 C |  COMPOUT [BDOS] :              CC53 C |
 COMPUTECS0 [BDOS] :           CFB9 C |  COMPUTE_CS [BDOS] :           CFB3 C |
 COMPUTE_RR [BDOS] :           D664 C |  COMREC [CCP] :                  7C - |
 CONBRK [BDOS] :               CC34 C |  CONDEV :                         1 - |
 CONECH [BDOS] :               CC17 C | *CONFIG :                      D938 C |
 CONIN :                       D955 C |  CONINF [BDOS] :               D909 - |
 CONOUT [BDOS] :               CC3A C |  CONOUTF [BDOS] :              D90C - |
 CONS1 :                       DB4E C |  CONST :                       DB46 C |
 CONSTF [BDOS] :               D906 - | *CONSTPI :        3.141592653589793 - |
 CONV0 [CCP] :                 C526 C |  CONV1 [CCP] :                 C543 C |
 COOUT :                       D960 C |  COPY_DIR [BDOS] :             D2A0 C |
 COPY_DIRLOC [BDOS] :          D1B2 C |  COPY_FCB [BDOS] :             D29C C |
 CR :                          DA41 C | *CR [CCP] :                       D - |
 CR [BDOS] :                      D - |  CRERC :                       E3D6 C |
 CRLF [CCP] :                  C388 C |  CRLF [BDOS] :                 CCB5 C |
 CRLFP [BDOS] :                CC9E C |  CRLFP0 [BDOS] :               CCA6 C |
*CSELF [CCP] :                   19 - |  CSV0 :                        E692 - |
 CSV1 :                        E6F4 - |  CTAB :                        E3DA C |
 CTL [BDOS] :                    5E - |  CTLC [BDOS] :                    3 - |
 CTLE [BDOS] :                    5 - |  CTLH [BDOS] :                    8 - |
 CTLOUT [BDOS] :               CC6F C |  CTLP [BDOS] :                   10 - |
*CTLR [BDOS] :                   12 - | *CTLS [BDOS] :                   13 - |
*CTLU [BDOS] :                   15 - |  CTLX [BDOS] :                   18 - |
*CTLZ [BDOS] :                   1A - |  CURDSK [BDOS] :               CE0D C |
 CURR :                        DA19 C |  CURRECA [BDOS] :              D8B7 C |
 CURSELECT [BDOS] :            D706 C |  CURSR :                         2B - |
 CURTRKA [BDOS] :              D8B5 C |  CZS1 :                        DAD2 C |
 CZSET :                       DAD0 C |  CZSP :                          1F - |
 DATE :                   3/12/2017 - |  DBDEV :                       E153 C |
 DBDMA :                       E159 C |  DBERRF :                      E168 C |
 DBFLG :                       E152 C |  DBL1K :                       E113 C |
 DBL2K :                       E116 C |  DBL2K0 :                      E119 C |
 DBMAT :                       DF45 C |  DBN :                         DED9 C |
 DBNB :                        E166 C |  DBPRR :                       DF42 C |
 DBSEC :                       E156 C |  DBSEC0 :                      DF0A C |
 DBSECM :                      DF13 C |  DBSECO :                      DF1C C |
 DBSECZ :                      DF07 C | *DBSID :                       E155 C |
 DBSLC :                       E157 C |  DBSNB :                       E158 C |
 DBSNBZ :                      DEF8 C |  DBTRAN :                      DF83 C |
 DBTRK :                       E154 C |  DBTRW :                       DF7D C |
 DCNT [BDOS] :                 D8EA C |  DDMA :                        E5DE - |
 DDRIVE :                      E15C C |  DEBLANK [CCP] :               C565 C |
 DELAY :                       E2E3 C |  DELETE [CCP] :                C460 C |
 DELETE [BDOS] :               D242 C |  DELETE0 [BDOS] :              D24A C |
 DELETECOM [CCP] :             C45D C |  DELF [CCP] :                    13 - |
 DELIM [CCP] :                 C549 C |  DELIMTAB [CCP] :              C55C C |
 DELL1 :                       DAA6 C |  DELLN :                       DA95 C |
 DEL_SUB [CCP] :               C3F6 C |  DERRCD :                      E139 C |
 DERRMS :                      E136 C |  DERRR :                       E083 C |
 DERRRW :                      E138 C | *DERRSC :                      E147 C |
 DERRTR :                      E143 C | *DERRTS :                      E145 C |
 DE_OS :                       E4AC C |  DFDCZ1 :                      E3D8 C |
 DFDCZ2 :                      E3D9 C |  DFLG :                        E15B C |
 DFRCDB :                      E14B C |  DFRMDV :                      E14C C |
 DFRMTR :                      E14D C |  DGETPB :                      DDF2 C |
 DGETPB1 :                     DE11 C |  DIOCAD :                      E173 C |
 DIOCDB :                      E16C C | *DIOCDE :                      E16D C |
 DIOCOMP [BDOS] :              CE83 C |  DIOCSE :                      E170 C |
 DIOCSI :                      E16F C | *DIOCSL :                      E171 C |
*DIOCSN :                      E172 C |  DIOCTR :                      E16E C |
 DIOERT :                      E06C C | *DIOF00 :                         0 - |
*DIOFFM :                         3 - | *DIOFHD :                         5 - |
*DIOFID :                         1 - | *DIOFPS :                         6 - |
*DIOFS1 :                         7 - | *DIOFTR :                         4 - |
*DIOFWR :                         2 - |  DIONFT :                      E031 C |
 DIOPHY :                      E01C C |  DIOSSP :                      E017 C |
 DIOTRS :                      DFFF C |  DIOTS1 :                      DFEE C |
 DIOTS2 :                      DFDC C |  DIOTS4 :                      DFED C |
 DIOTSS :                      E000 C |  DIR0 [CCP] :                  C6CC C |
 DIR1 [CCP] :                  C6D1 C |  DIR2 [CCP] :                  C6DA C |
 DIR6 [CCP] :                  C723 C |  DIRBLK [BDOS] :               D8CA C |
 DIRBUF :                      E5E0 - | *DIRCOL :                      C6F1 - |
 DIRECT [CCP] :                C6BC C |  DIRINP [BDOS] :               CDA1 C |
 DIRLOC [BDOS] :               D8D4 C |  DIRMAX [BDOS] :               D8C8 C |
 DIRREC [BDOS] :                  4 - |  DIR_TO_USER [BDOS] :          D09F C |
 DISKA :                          4 - |  DISKEOF [BDOS] :              D4CD C |
*DISKF [BDOS] :                   C - |  DISKO [BDOS] :                D8EE C |
 DISKREAD [CCP] :              C46F C |  DISKREAD [BDOS] :             D497 C |
 DISKREADC [CCP] :             C46C C | *DISKWR0 [BDOS] :              D4EE C |
 DISKWR1 [BDOS] :              D53B C |  DISKWR11 [BDOS] :             D585 C |
 DISKWR2 [BDOS] :              D59B C |  DISKWR3 [BDOS] :              D5C6 C |
 DISKWRITE [CCP] :             C476 C |  DISKWRITE [BDOS] :            D4D5 C |
 DISKWRU [BDOS] :              D539 C |  DLOG [BDOS] :                 D8AF C |
 DMAAD [BDOS] :                D8B1 C |  DMAF [CCP] :                    1A - |
 DMINX [BDOS] :                D8D7 C |  DMOVEW :                      DF76 C |
 DMPOS0 [BDOS] :               CF08 C |  DMPOS1 [BDOS] :               CF15 C |
 DMPOS2 [BDOS] :               CF1C C |  DMSET [BDOS] :                D3DE C |
 DM_POSITION [BDOS] :          CF01 C |  DPB0 :                        E55A C |
 DPB1 :                        E58D C |  DPBADDR [BDOS] :              D8BB C |
 DPBLIST [BDOS] :                 F - |  DPH0 :                        E536 C |
 DPH1 :                        E546 C | *DPHBER :                      E556 - |
 DPHTAB :                      E556 C |  DPTR [BDOS] :                 D8E9 C |
 DREADF [CCP] :                  14 - |  DREC [BDOS] :                 D8EC C |
 DRV0 :                        E189 C |  DRV0A :                       E194 C |
 DRW :                         DE95 C |  DRWBNR :                      DEBD C |
 DRWERR :                      DE76 C |  DRWSEC :                      DF9A C |
 DSECTR :                      E15F C |  DSIDTR :                      DF95 C |
 DSIDTT :                      DF92 C |  DSKERR [BDOS] :               CBC6 C |
 DSKMAP [BDOS] :                 10 - |  DSKMSG [BDOS] :               CBBA C |
 DSKMSK [BDOS] :                  3 - |  DSKSHF [BDOS] :                  2 - |
 DSKTRA :                      DF9D C | *DSLBLK :                         4 - |
 DSLDIR :                         2 - |  DSLFO :                          1 - |
*DSLL :                           5 - |  DSLOFF :                         3 - |
 DSLSPT :                         1 - |  DSLTRK :                         0 - |
 DSLVO :                          0 - |  DSMOVE :                      DF65 C |
 DTL :                         E3E2 C |  DTRACK :                      E15D C |
 DTROK :                       E0A3 C |  DTRSL0 :                      E0C3 C |
 DTRSL1 :                      E0D7 C |  DTRSL2 :                      E0EB C |
 DTRSL3 :                      E0FF C |  DTRSLA :                      E0AF C |
 DVERS [BDOS] :                  22 - |  DWRITF [CCP] :                  15 - |
 DWRTYP :                      E167 C |  ECHOC [BDOS] :                CC25 C |
 EFCB [BDOS] :                 D8AC C |  EFILL [CCP] :                 C51C C |
 EMPTY [BDOS] :                  E5 - |  ENDDIR [CCP] :                C72D C |
 ENDDIR [BDOS] :               FFFF - | *ENDE :                        643C - |
 ENDMERGE [BDOS] :             D3F6 C |  ENDSEARCH [BDOS] :            D229 C |
 END_OF_DIR [BDOS] :           D0AB C |  ENTSP [BDOS] :                CDCA C |
 EOFILE [CCP] :                  1A - | *EOT :                         E3E0 C |
 ERASE [CCP] :                 C730 C |  ERASEFILE [CCP] :             C74B C |
 ERRFLG [BDOS] :               CBFE C |  ERROREVAL :                   E381 C |
 EXT [CCP] :                   C865 C |  EXT1 [CCP] :                  C88E C |
 EXT2 [CCP] :                  C89D C |  EXT3 [CCP] :                  C8A2 C |
 EXTMSK [BDOS] :               D8C5 C |  EXTNUM [BDOS] :                  C - |
 EXTVAL [BDOS] :               D8E2 C |  EXTVEC [CCP] :                CACA C |
 EXTVECE [CCP] :               CAE1 - |  F2 :                          DBD5 C |
 F2_4 :                        DB9B C |  F4 :                          DBD9 C |
*FALSE :                          0 - |  FALSE_ [BDOS] :                  0 - |
 FCB [CCP] :                     5C - |  FCBDSK [BDOS] :               D8E0 C |
 FCBLEN [BDOS] :                 20 - |  FCBNZERO [BDOS] :             D3C1 C |
 FCBSHF [BDOS] :                  5 - |  FCB_COPIED [BDOS] :           D8D2 C |
 FCB_OS :                      E489 C |  FDCBUFFER :                   E7A4 - |
 FDCC :                          99 - |  FDCD :                          98 - |
 FDCZ :                          A0 - |  FEHRET :                      E25B C |
 FILL0 [BDOS] :                D557 C |  FILL1 [BDOS] :                D565 C |
 FILLFCB [CCP] :               C4AC C |  FILLFCB1 [CCP] :              C4AF C |
 FIRSTRUN :                    E5C0 C |  FLLDIR :                      E169 C |
 FLOPPY :                      E175 C |  FLOPPY10 :                    E23A C |
 FLOPPY11 :                    E259 C |  FLOPPY3 :                     E1B4 C |
 FLOPPY4 :                     E1BD C |  FLOPPY5 :                     E1CF C |
 FLOPPY6 :                     E1F1 C |  FLOPPY7 :                     E204 C |
 FLOPPY8 :                     E211 C |  FLOPPY9 :                     E22B C |
 FT.ADR :                      E3CC C |  FT.ANZ :                      E3D3 C |
 FT.KOM :                      E3CB C |  FT.LEN :                      E3D2 C |
 FT.LWN :                      E3CE C |  FT.SEC :                      E3D1 C |
 FT.SID :                      E3D0 C |  FT.STI :                      E3D5 C |
 FT.STP :                      E3D4 C |  FT.TRK :                      E3CF C |
 FTAB :                        D9AA C | *FULLPMMU :                       1 - |
 FUNC1 [BDOS] :                CD8C C |  FUNC10 [BDOS] :               CCCC - |
 FUNC11 [BDOS] :               CDBB C |  FUNC12 [BDOS] :               D756 C |
 FUNC13 [BDOS] :               D75B C |  FUNC13A [BDOS] :              D777 C |
 FUNC14 [BDOS] :               D701 - |  FUNC14X [BDOS] :              D701 C |
 FUNC15 [BDOS] :               D789 C |  FUNC16 [BDOS] :               D792 C |
 FUNC17 [BDOS] :               D798 C |  FUNC18 [BDOS] :               D7B4 C |
 FUNC19 [BDOS] :               D7C3 C |  FUNC2 [BDOS] :                CC7F - |
 FUNC20 [BDOS] :               D7CC C |  FUNC21 [BDOS] :               D7D2 C |
 FUNC22 [BDOS] :               D7D8 C |  FUNC23 [BDOS] :               D7E1 C |
 FUNC24 [BDOS] :               D7EA C |  FUNC25 [BDOS] :               D7F0 C |
 FUNC26 [BDOS] :               D800 C |  FUNC27 [BDOS] :               D807 C |
 FUNC28 [BDOS] :               CFE6 - |  FUNC29 [BDOS] :               D80D C |
 FUNC3 [BDOS] :                CD91 C |  FUNC30 [BDOS] :               D813 C |
 FUNC31 [BDOS] :               D81C C |  FUNC32 [BDOS] :               D823 C |
 FUNC33 [BDOS] :               D836 C |  FUNC34 [BDOS] :               D83C C |
 FUNC35 [BDOS] :               D842 C |  FUNC36 [BDOS] :               D6CA - |
 FUNC37 [BDOS] :               D848 C |  FUNC38 [BDOS] :               CDC1 - |
 FUNC39 [BDOS] :               CDC1 - |  FUNC40 [BDOS] :               D88F C |
 FUNC6 [BDOS] :                CD96 C |  FUNC7 [BDOS] :                CDAB C |
 FUNC8 [BDOS] :                CDB0 C |  FUNC9 [BDOS] :                CDB5 C |
 FUNCTAB [BDOS] :              CB11 C |  FUNC_RET [BDOS] :             CDC1 C |
 FWFMSK [BDOS] :                 80 - |  GETALLOCBIT [BDOS] :          D0E8 C |
 GETDM [BDOS] :                CF1E C |  GETDMD [BDOS] :               CF30 C |
 GETDPTRA [BDOS] :             D018 C |  GETEXTA [BDOS] :              CF64 C |
 GETFCB [BDOS] :               CF79 C |  GETFCBA [BDOS] :              CF6C C |
 GETFILESIZE [BDOS] :          D691 C |  GETMODNUM [BDOS] :            D023 C |
 GETNEXTSIZE [BDOS] :          D6C3 C |  GETNUMBER [CCP] :             C51F C |
 GETSIZE [BDOS] :              D6A3 C |  GET_BLOCK [BDOS] :            D263 C |
 GOBACK [BDOS] :               D874 C |  GOERR [BDOS] :                CE15 C |
*GPL :                         E3E1 C | *HAS64 :                          1 - |
*HASDSP :                         0 - | *HASFPU :                         0 - |
*HASPMMU :                        0 - | *HED :                         E3DD C |
*HEXA :                        E40C C |  HEXA1 :                       E40F C |
 HEXA2 :                       E41C C |  HLROTL [BDOS] :               CFBF C |
 HLROTL0 [BDOS] :              CFC0 C |  HLROTR [BDOS] :               CFA7 C |
 HLROTR0 [BDOS] :              CFA8 C |  HOME :                        DDD0 C |
 HOME [BDOS] :                 CE6A C |  HOME1 :                       DDDC C |
 HOMEF [BDOS] :                D918 - | *HSTSEC :                      E3DE C |
 INDEX [BDOS] :                CF36 C |  INDIC0 [BDOS] :               D32B C |
 INDICATORS [BDOS] :           D326 C | *INEXTMODE :                      0 - |
*INEXTMODE [CCP] :                0 - | *INEXTMODE [BDOS] :               0 - |
 INFO [BDOS] :                 CE0E C |  INITF [CCP] :                    D - |
 INITIAL0 [BDOS] :             D15E C |  INITIAL2 [BDOS] :             D17E C |
 INITIALIZE [BDOS] :           D150 C |  INITIAL_CS [BDOS] :           D07C C |
 INIT_CRT :                    DB87 C |  INIT_PRN :                    DBF9 C |
*INLWORDMODE :                    0 - | *INLWORDMODE [CCP] :              0 - |
*INLWORDMODE [BDOS] :             0 - | *INMAXMODE :                      0 - |
 INSLN :                       DAAC C | *INSRCMODE :                      0 - |
*INSUPMODE :                      0 - |  INTRIN0 [CCP] :               C57E C |
 INTRIN1 [CCP] :               C583 C |  INTRIN2 [CCP] :               C5A0 C |
 INTRINSIC [CCP] :             C57B C |  INTVEC [CCP] :                CA82 C |
 INTVECTAB :                   E5D0 - |  INV :                         DADC C |
 INV1 :                        DADE C | *INVIS [BDOS] :                   A - |
 IOBPF :                       DB82 C |  IOLOC :                          3 - |
 IRDY :                        E309 C |  KTAB :                        D998 C |
 LA [CCP] :                      5F - |  LEFTTST [BDOS] :              D265 C |
*LF [CCP] :                       A - |  LF [BDOS] :                      A - |
*LIFTF [CCP] :                    C - |  LINELEN [BDOS] :              CD38 C |
 LINFO [BDOS] :                D8D6 C |  LIST :                        DB9C C |
 LISTCP [BDOS] :               CDC9 C |  LISTF [BDOS] :                D90F - |
*LISTON :                         2 - | *LISTSTF [BDOS] :              D92D - |
 LKTAB :                         12 - |  LOAD0 [CCP] :                 C5E4 C |
 LOAD1 [CCP] :                 C616 C |  LOADADRESS :                  4000 - |
 LOC_0 [BDOS] :                CB00 C |  LOC_CC00 [CCP] :              C300 C |
 LOC_CC03 [CCP] :              C303 C |  LOC_CDAE [CCP] :              C4DE C |
 LOC_CDC7 [CCP] :              C4F7 C |  LOC_CE41 [CCP] :              C571 C |
 LOC_CE93 [CCP] :              C5C3 C |  LOC_CE98 [CCP] :              C5C8 C |
 LOC_CEA3 [CCP] :              C5D3 C |  LOC_CEA6 [CCP] :              C5D6 C |
 LOC_CEB1 [CCP] :              C5E1 C |  LOC_CED7 [CCP] :              C607 C |
 LOC_CEE3 [CCP] :              C613 C |  LOC_CF02 [CCP] :              C631 C |
 LOC_CF23 [CCP] :              C658 C |  LOC_CF37 [CCP] :              C637 C |
 LOC_CF4E [CCP] :              C683 C |  LOC_CF54 [CCP] :              C689 C |
 LOC_CF84 [CCP] :              C6B9 C |  LOC_CFCA [CCP] :              C6FF C |
 LOC_CFD8 [CCP] :              C70D C |  LOC_D1F5 [CCP] :              C92D C |
 LOC_D206 [CCP] :              C93E C |  LOC_D209 [CCP] :              C941 C |
 LOC_D20E [CCP] :              C946 C |  LOC_D20EX [CCP] :             C90E C |
 LOC_D21B [CCP] :              C953 C |  LOC_D23A [CCP] :              C972 C |
 LOC_D23D [CCP] :              C975 C |  LOC_D25C [CCP] :              C994 C |
 LOC_D264 [CCP] :              C99C C |  LOC_D26E [CCP] :              C9A6 C |
 LOC_D278 [CCP] :              C9B0 C |  LOC_D27B [CCP] :              C9B3 C |
 LOC_D27E [CCP] :              C9B6 C |  LOC_D296 [CCP] :              C9CE C |
 LOC_D299 [CCP] :              C9D1 C |  LOC_D2A9 [CCP] :              C9E1 C |
 LOC_D2AE [CCP] :              C9E6 C |  LOC_D2B1 [CCP] :              C9E9 C |
 LOC_D2FC [CCP] :              CA34 C |  LOC_D5F9 [BDOS] :             CCF9 C |
 LOC_D8DB [BDOS] :             CFDB C |  LOC_D908 [BDOS] :             D008 C |
 LOC_DBEA [BDOS] :             D2EA C |  LOC_DC04 [BDOS] :             D304 C |
 LOC_E034 [BDOS] :             D734 C |  LOC_E043 [BDOS] :             D743 C |
 LOC_E0FA [BDOS] :             D7FA C |  LOC_E155 [BDOS] :             D855 C |
*LOGF [CCP] :                    18 - |  LRET [BDOS] :                 CE10 - |
 LSTACK [BDOS] :               CE0C C |  LSTDEV :                         1 - |
*LSTFCB [BDOS] :                 1F - |  LSTREC [BDOS] :                 7F - |
 LSTST :                       DBEE C | *MACEXP :                         1 - |
 MAKE [BDOS] :                 D403 C |  MAKE0 [BDOS] :                D425 C |
*MAKEF [CCP] :                   16 - |  MAXALL [BDOS] :               D8C6 C |
 MAXEXT [BDOS] :                 1F - |  MAXLEN [CCP] :                C306 C |
 MAXMOD [BDOS] :                  F - |  MBRECO :                      E40B C |
*MDFAA :                       DA7F C |  MDFB3 :                       DA88 C |
*MDFBA :                       DA8F C |  MERGE0 [BDOS] :               D3B5 C |
 MERGED [BDOS] :               D3CB C |  MERGERR [BDOS] :              D3FE C |
 MERGEZERO [BDOS] :            D37C C |  MESC :                        DAE5 C |
 MINV :                        DB86 C |  MLZBS :                       DB7E C |
 MODNUM [BDOS] :                  E - | *MOMCPU :                        80 - |
*MOMCPU [CCP] :                  80 - | *MOMCPU [BDOS] :                 80 - |
*MOMCPUNAME :                   Z80 - | *MOMCPUNAME [CCP] :             Z80 - |
*MOMCPUNAME [BDOS] :            Z80 - | *MON :                         F000 - |
 MOVE [BDOS] :                 CE1A C |  MOVE0 [BDOS] :                CE1B C |
 MSEQU :                       DB7F C |  MSPAP :                       DB81 C |
 MZEIP :                       DB80 C | *N :                           E3DF C |
 NAMLEN [BDOS] :                  F - |  ND :                          DA12 C |
*NESTMAX :                      100 - |  NEWCHECKSUM [BDOS] :          D056 C |
 NFUNCS [BDOS] :                 29 - |  NOERR :                       E25A C |
 NOFILE [CCP] :                C3C4 C |  NOPBLOCK [BDOS] :             D50B C |
 NOREAD [CCP] :                CA41 C |  NORM :                        DAE2 C |
 NOSELECT [BDOS] :             D74D C |  NOSPACE [BDOS] :              D5C4 C |
 NOSUB [CCP] :                 CA2E C |  NOSYSD :                      E47B C |
 NOSYST :                      E46B C |  NOSYS_ :                      E46D C |
 NOTBACKSP [BDOS] :            CC69 C |  NOTC [BDOS] :                 CD81 C |
 NOTE [BDOS] :                 CD15 C |  NOTP [BDOS] :                 CD24 C |
 NOTRUB [BDOS] :               CD06 C | *NOUPDATE [BDOS] :             D5A8 C |
 NOWRITE [BDOS] :              CFD8 C |  NXTREC [BDOS] :                 20 - |
*OFF [BDOS] :                     0 - |  OFFSET [BDOS] :               D8CE C |
 OLDDSK [BDOS] :               D8DF C |  ON [BDOS] :                   FFFF - |
 OPEN [CCP] :                  C444 C |  OPEN [BDOS] :                 D33B C |
 OPENC [CCP] :                 C43D C |  OPENF [CCP] :                    F - |
 OPEN_COPY [BDOS] :            D344 C |  OPEN_MOD [BDOS] :             D45E C |
 OPEN_RCNT [BDOS] :            D373 C |  OPEN_REEL [BDOS] :            D438 C |
 OPEN_REEL0 [BDOS] :           D468 C |  OPEN_REEL1 [BDOS] :           D482 C |
 OPEN_REEL2 [BDOS] :           D485 C |  OPEN_R_ERR [BDOS] :           D48C C |
 OUTLF :                       DA50 C |  OUTS :                        D94B C |
*PACKING :                        0 - | *PADDING :                        1 - |
 PADTY [CCP] :                 C516 C |  PADTY1 [CCP] :                C518 C |
*PBUFF [CCP] :                    9 - |  PCHARF [CCP] :                   2 - |
 PCTLH [BDOS] :                CC99 C |  PDOLLAR [BDOS] :              D1A8 C |
 PERERR [BDOS] :               CB09 C |  PERMSG [BDOS] :               CBCA C |
 PERSUB [BDOS] :               CB9B C |  PIOC :                          35 - |
 PIOD :                          34 - |  PRE :                         DBEB C |
 PRINT [CCP] :                 C3E9 C |  PRINT [BDOS] :                CCBF C |
 PRINTBC [CCP] :               C38F C |  PRNST :                       E3F2 C |
 PRNST1 :                      E3F3 C |  PRNT1 :                       DBA8 C |
 PUABL :                       DAD7 C |  PUNCH :                       DBF7 C |
 PUNCHF [BDOS] :               D912 - |  QSELECT [BDOS] :              D7AE C |
 R8272 :                       E316 C |  RAMEND :                      EBFF - |
 RANCLOSE [BDOS] :             D60A C |  RANDISKREAD [BDOS] :          D652 C |
 RANDISKWRITE [BDOS] :         D65B C |  RANREC [BDOS] :                 21 - |
 RBUFF [CCP] :                    A - |  RBYTE :                       E2EA C |
*RCHARF [CCP] :                   1 - |  RCOUNT [BDOS] :               D8E1 C |
 RDBUFF [BDOS] :               CE7B C | *RDECH1 [BDOS] :               CD6E C |
 RDECHO [BDOS] :               CD6B C |  RDWAIT :                      E3E3 C |
 RDY :                         E2B0 C |  RDY0 :                        E2B5 C |
 RDY1 :                        E2C8 C |  RDY2 :                        E2CA C |
 RD_DIR [BDOS] :               D08B C |  RD_OS :                       E4AA C |
 READ :                        DE79 C |  READ [BDOS] :                 CCCC C |
 READCOM [CCP] :               C9EC C |  READCOM0 [CCP] :              CA46 C |
 READCOM2 [CCP] :              CA4B C |  READCOM3 [CCP] :              CA57 C |
 READEN [BDOS] :               CD85 C |  READERF [BDOS] :              D915 - |
 READERR [CCP] :               C398 C |  READF [BDOS] :                D927 - |
 READID :                      E3B0 C |  READN0 [BDOS] :               CCDC C |
 READNX [BDOS] :               CCDA C |  READR :                       DBF8 C |
 READ_DIR [BDOS] :             D0BB C |  READ_DIR0 [BDOS] :            D0CD C |
 READ_DIR1 [BDOS] :            D0D4 C |  REBOOT [BDOS] :                  0 - |
 RECAL :                       E265 C |  RECAL2 :                      E261 C |
 RECCNT [BDOS] :                  F - |  RECORDOK [BDOS] :             D4B9 C |
 RECSIZ [BDOS] :                 80 - | *RELAXED :                        0 - |
 REN1 [CCP] :                  C802 C |  REN2 [CCP] :                  C818 C |
 RENAME [CCP] :                C7D7 C |  RENAME [BDOS] :               D2B5 C |
 RENAME0 [BDOS] :              D2F1 C |  RENAMECOM [CCP] :             C465 C |
 RENERR1 [CCP] :               C827 C |  RENERR2 [CCP] :               C82C C |
 RENERR3 [CCP] :               C82F C |  RENERRX [CCP] :               C8CA C |
 RENF [CCP] :                    17 - |  RENMSG [CCP] :                C3B4 C |
 REP0 [BDOS] :                 CD40 C |  REP1 [BDOS] :                 CD50 C |
 RES [CCP] :                   C8D5 C |  RES1 [CCP] :                  C8DF C |
 RES2 [CCP] :                  C8EE C |  RESEL [BDOS] :                D8DE C |
 RESELECT [BDOS] :             D711 C |  RESL1 :                       E2FF C |
 RESLT :                       E3E5 C |  RETBLOCK [BDOS] :             D28C C |
 RETBLOCK0 [BDOS] :            D294 C |  RETCOM [CCP] :                C610 C |
 RETCOM0 [CCP] :               C78F C |  RETMON [BDOS] :               D881 C |
 RETSAVE [CCP] :               C7D4 C |  RETSAVE0 [CCP] :              C825 C |
 RETSELECT [BDOS] :            CE66 C |  RIGHTTST [BDOS] :             D274 C |
 RMF [BDOS] :                  D8D3 C |  RODERR [BDOS] :               CB0D C |
 RODMSG [BDOS] :               CBFA C |  RODSK [BDOS] :                D8AD C |
 RODSUB [BDOS] :               CBAC C |  ROFERR [BDOS] :               CB0F C |
*ROFILE [CCP] :                   9 - |  ROFILE [BDOS] :                  9 - |
 ROFMSG [BDOS] :               CBF5 C |  ROFSUB [BDOS] :               CBB1 C |
 ROTL [BDOS] :                 D109 C |  ROTR [BDOS] :                 D116 C |
 RRSLT :                       E2F3 C |  RSEEK [BDOS] :                D5C9 C |
 RSEEK1 [BDOS] :               D5CD C |  RUBOUT [BDOS] :                 7F - |
 RWBUFFER :                    E724 - |  RWIT :                        E31B C |
 RWIT1 :                       E333 C |  RWIT2 :                       E336 C |
 RWIT3 :                       E33E C |  RWIT4 :                       E349 C |
 RWIT5 :                       E365 C |  RWMODE :                      E36D C |
 RWRET :                       E380 C |  SAVE [CCP] :                  C798 C |
 SAVE0 [CCP] :                 C7B4 C |  SAVE1 [CCP] :                 C7CB C |
 SAVERR [CCP] :                C3A7 C |  SAVERR0 [CCP] :               C7D1 C |
 SAVERRX [CCP] :               C8CF C |  SAVEUSER [CCP] :              C407 C |
 SCANDM [BDOS] :               D11C C |  SCANDM0 [BDOS] :              D126 C |
 SCANDM1 [BDOS] :              D137 C |  SCANDM2 [BDOS] :              D13D C |
 SCANM3 [BDOS] :               D14B C |  SCNQ [CCP] :                  C4EA C |
 SCNQ0 [CCP] :                 C4F1 C |  SDISK [CCP] :                 C9C4 C |
 SDS :                         E28C C |  SEARCH [BDOS] :               D1C9 C |
 SEARCHA [BDOS] :              D8D9 C |  SEARCHCOM [CCP] :             C452 C |
 SEARCHEXT [BDOS] :            D21B C |  SEARCHL [BDOS] :              D8D8 C |
 SEARCHLOOP [BDOS] :           D201 C |  SEARCHN [CCP] :               C459 C |
 SEARCHN [BDOS] :              D1DE C |  SEARCHNEXT [BDOS] :           D1F8 C |
 SEARCHOK [BDOS] :             D223 C |  SEARCH_FIN [BDOS] :           D23A C |
 SEARF [CCP] :                   11 - |  SEARNF [CCP] :                  12 - |
 SECTPT [BDOS] :               D8C1 C |  SECTRAN :                     DDEE C |
 SECTRAN [BDOS] :              D930 - |  SEEK :                        E295 C |
 SEEK [BDOS] :                 CE99 C |  SEEK0 [BDOS] :                CEAC C |
 SEEK1 :                       E2A4 C |  SEEK1 [BDOS] :                CEC0 C |
*SEEK2 :                       E2A7 C |  SEEK2 [BDOS] :                CED2 C |
 SEEKERR [BDOS] :              D64A C |  SEEKOK [BDOS] :               D63E C |
 SEEK_COPY [BDOS] :            D2AF C |  SEEK_DIR [BDOS] :             CE8B C |
 SELDSK :                      DC06 C |  SELDSK1 :                     DC1F C |
 SELDSK10 :                    DCDE C |  SELDSK11 :                    DCF4 C |
 SELDSK12 :                    DD0A C |  SELDSK13 :                    DD12 C |
 SELDSK14 :                    DD4A C |  SELDSK15 :                    DD4B C |
 SELDSK16 :                    DD58 C |  SELDSK17 :                    DD72 C |
 SELDSK18 :                    DD8F C |  SELDSK19 :                    DDA3 C |
 SELDSK2 :                     DC50 C |  SELDSK20 :                    DDA9 C |
 SELDSK21 :                    DDC2 C |  SELDSK22 :                    DDC7 C |
 SELDSK23 :                    DDCE C |  SELDSK3 :                     DC88 C |
 SELDSK4 :                     DC98 C |  SELDSK5 :                     DC9B C |
 SELDSK6 :                     DC9D C |  SELDSK7 :                     DCC3 C |
 SELDSK8 :                     DCC7 C |  SELDSK9 :                     DCD3 C |
 SELDSKF [BDOS] :              D91B - | *SELDSV :                      DCE5 C |
 SELECT [CCP] :                C435 C |  SELECT [BDOS] :               D6DD C |
 SELECTDISK [BDOS] :           CE23 C |  SELERR [BDOS] :               CB0B C |
 SELF [CCP] :                     E - |  SELMSG [BDOS] :               CBEE C |
 SELSUB [BDOS] :               CBA7 C |  SEL_ERROR [BDOS] :            CE12 C |
 SEND :                        DBDB C |  SENSE :                       E26B C |
 SEQDISKREAD [BDOS] :          D492 C |  SEQDISKWRITE [BDOS] :         D4D0 C |
 SEQIO [BDOS] :                D8D5 C |  SETALLOCBIT [BDOS] :          D10E C |
 SETC1 :                       DB34 C |  SETCDR [BDOS] :               D046 C |
 SETCU :                       DB29 C |  SETCUR0 [CCP] :               C4C1 C |
 SETDATA [BDOS] :              D091 C |  SETDIR [BDOS] :               D096 C |
 SETDISK [CCP] :               C42B C |  SETDISKA [CCP] :              C40E C |
 SETDMA :                      DDE9 C |  SETDMA [CCP] :                C41F C |
 SETDMA [BDOS] :               D099 C |  SETDMAF [BDOS] :              D924 - |
 SETDSK [CCP] :                C4CA C |  SETFCB [BDOS] :               CF90 C |
 SETFCB1 [BDOS] :              CF9B C |  SETFWF [BDOS] :               D032 C |
 SETLRET1 [BDOS] :             CDC2 C |  SETNAME [CCP] :               C4CF C |
 SETRANDOM [BDOS] :            D6CA C |  SETSEC :                      DDE4 C |
 SETSECF [BDOS] :              D921 - |  SETSIZE [BDOS] :              D6C8 C |
 SETTRK :                      DDDF C |  SETTRKF [BDOS] :              D91E - |
 SETTY0 [CCP] :                C4FC C |  SETTY1 [CCP] :                C50A C |
 SETTY2 [CCP] :                C50C C |  SETUSER [CCP] :               C423 C |
 SETUSRCODE [BDOS] :           D830 C |  SETXY :                       DAFE C |
 SET_CDISK [BDOS] :            CFC5 C |  SET_END_DIR [BDOS] :          D0B4 C |
 SET_MFM_BIT :                 E3C1 C |  SET_RO [BDOS] :               CFE6 C |
 SINGLE [BDOS] :               D8DD C |  SOIL :                          16 - |
 SPALT :                         40 - |  SPERC :                       E3D7 C |
 SSIZE [BDOS] :                  20 - |  STAB :                        6320 C |
 STACK [CCP] :                 CB00 C |  STACKP :                      E5DC - |
 STARTKDO :                    63BB C |  STA_RET [BDOS] :              CDBE C |
 STHL_RET [BDOS] :             D81F C |  STRTCOL [BDOS] :              CDC7 C |
 SUBCR [CCP] :                 CA7E C |  SUBDH [BDOS] :                D04F C |
 SUBFCB [CCP] :                CA5E C |  SUBMOD [CCP] :                CA6C C |
 SUBRC [CCP] :                 CA6D C |  SUB_CD3F [CCP] :              C47D C |
 SUB_CD5B [CCP] :              C48B C |  SUB_CD6E [CCP] :              C49E C |
 SUB_CE3E [CCP] :              C56E C |  SWAP [CCP] :                  C8F5 C |
 SWAP1 [CCP] :                 C905 C |  SWAP_LW [CCP] :               C91D C |
*SYSFILE [CCP] :                  A - |  TAB [BDOS] :                     9 - |
 TAB0 [BDOS] :                 CC84 C |  TABOUT [BDOS] :               CC7F C |
 TAPUF :                       DB84 C |  TBUFF [BDOS] :                  80 - |
*TEST [BDOS] :                 FFFF - | *TFCB [BDOS] :                   5C - |
*TIME :                    11:04:02 - |  TIME0 :                       DBE3 C |
*TINFO [BDOS] :                D8DB C |  TRAN [CCP] :                   100 - |
 TRANM [CCP] :                 C300 - |  TRANSLATE [CCP] :             C495 C |
 TRANV [BDOS] :                D8D0 C |  TRCK :                        E3DC C |
 TRTYP [CCP] :                 C50E C | *TRUE :                           1 - |
 TRUE_ [BDOS] :                  FF - |  TYPE [CCP] :                  C757 C |
 TYPE0 [CCP] :                 C76A C |  TYPE1 [CCP] :                 C777 C |
 TYPEEOF [CCP] :               C78E C | *UBIOSEND :                    E5C1 - |
 UBIOSEND0 :                   EBA4 - |  UBYTES [BDOS] :                  D - |
 UNACNT :                      E162 C |  UNADEV :                      E163 C |
 UNASEC :                      E165 C |  UNATRK :                      E164 C |
 UNIT :                        E3DB C |  UNK_DC06 [BDOS] :             D306 C |
 USER [CCP] :                  C834 C |  USER0 [CCP] :                 C5BA C |
 USERF [CCP] :                   20 - |  USERFUNC [CCP] :              C5A7 C |
 USRCODE [BDOS] :              CE0C C | *VERSION :                     142F - |
 VRECORD [BDOS] :              D8E3 C |  W8272 :                       E30F C |
 WAIT :                        E3FD C |  WAIT1 :                       E400 C |
 WAIT2 :                       E402 C |  WAIT_ERR [BDOS] :             CBB4 C |
 WBOOT :                       E4B2 C | *WBOOT0 :                      E4D3 C |
*WBOOT00 :                     E4B2 C |  WBOOT1 :                      E4DE C |
 WBOOT2 :                      E4E8 C |  WBOOT3 :                      E4B5 C |
 WBOOT3U1 :                    E507 C |  WBOOTF [BDOS] :               D903 - |
 WCOM :                        E2CD C |  WCOM1 :                       E2D0 C |
 WORD [BDOS] :                    2 - |  WRBUFF [BDOS] :               CE80 C |
 WRDIR [BDOS] :                D07E C |  WRITE :                       DE15 C |
 WRITE1 :                      DE48 C |  WRITE2 :                      DE6D C |
 WRITEF [BDOS] :               D92A - |  XLT :                         E11C C |
 ZAG :                         D96C C |  ZAG1 :                        D9CE C |
 ZAG2 :                        DA09 C |  ZAG3 :                        D9E6 C |
*ZDR1 :                        DB9D C |  ZINC :                        DB26 C |
*ZL :                            40 - |  ZR1 :                         DAC8 C |
 ZRET :                        DAC6 C |  _READ1 :                      E51A C |
 _WRITE1 :                     E50A C |

   1001 symbols
    107 unused symbols

 AS V1.42 Beta [Bld 115] - source file cpa_Z1013.asm - page 3 - 3/12/2017 11:04:02
Z1013 BIOS


  defined functions:
  ------------------

LO                                    | HI                                   

 AS V1.42 Beta [Bld 115] - source file cpa_Z1013.asm - page 4 - 3/12/2017 11:04:02
Z1013 BIOS


  codepages:
  ----------

STANDARD (0 changed characters)


0.06 seconds assembly time

   6851 lines source file
      2 passes
      0 errors
      0 warnings
