 AC1 U880 Assembler - Source Listing               0010 ; *****************************************              0020 ; *                                       *              0030 ; * Testroutinen fuer die AC1-Monitorerw. *              0040 ; *                                       *              0050 ; *****************************************              0060 ;              0070 ;6E36 07F1     0080 OUTHL  EQU  07F1H6E36 07FD     0090 GETCO1 EQU  07FDH6E36 185B     0100 ARG1   EQU  185BH6E36 185D     0110 ARG2   EQU  185DH6E36 185F     0120 ARG3   EQU  185FH              0130 ;              0140 ; Offset, wenn Monitor im RAM getestet wird6E36 0000     0150 OFFS   EQU  0              0160 ; Sprungverteiler V1.0.26E36 0810     0170 CLRBUF EQU  0810H+OFFS6E36 0813     0180 FGETSY EQU  0813H+OFFS6E36 0816     0190 GETTXT EQU  0816H+OFFS6E36 0819     0200 GETTX0 EQU  0819H+OFFS6E36 081C     0210 PRNTXA EQU  081CH+OFFS6E36 081F     0220 CRC16  EQU  081FH+OFFS6E36 0822     0230 FOPENW EQU  0822H+OFFS6E36 0825     0240 FCHRW  EQU  0825H+OFFS6E36 0828     0250 FBLKW  EQU  0828H+OFFS6E36 082B     0260 FOPENR EQU  082BH+OFFS6E36 082E     0270 FCHRR  EQU  082EH+OFFS6E36 0831     0280 FBLKR  EQU  0831H+OFFS6E36 0834     0290 FGETRE EQU  0834H+OFFS6E36 0837     0300 VERSTR EQU  0837H+OFFS              0310 ;              0320 ;2000          0330        ORG  2000H              0340 ;              0350 ; ** Testprogramm - Datei schreiben **              0360 ;    Einzelzeichenausgabe "FCHRW"              0370 ;2000 0009780D 0380        DEFB 0,9,"x,0DH              0390 ; x ANF ENDE START Dateiname              0400 ; ARG1-3 durch Monitorkommando gesetzt              0410 ;              0420 ;Textpuffer loeschen und Namen v. BWS kopier2004 EB       0430        EX   DE,HL       ;Pos nach Arg3 in DE2005 CD1908   0440        CALL GETTX0      ;Name ab HL in BWS              0450 ;              0460 ; Dateityp2008 210800   0470        LD   HL,8200B CD1308   0480        CALL FGETSY      ;Adresse FTYP -> HL              0490 ;      LD   A,0         ;ohne Header200E 3E58     0500        LD   A,"X        ;mit Header speicher2010 77       0510        LD   (HL),A              0520 ;2011 CD2208   0530        CALL FOPENW      ;Schreiben init              0540 ;              0550 ; zeichenweise schreiben2014 2A5B18   0560        LD   HL,(ARG1)2017 7E       0570 LOOP   LD   A,(HL)2018 23       0580        INC  HL2019 CD2508   0590        CALL FCHRW201C 20F9     0600        JR   NZ,LOOP     ;bis z.letzten Zeich201E CD3408   0610        CALL FGETRE      ;Zy=1 wenn ok              0620 ;                        Resultcode in HL2021 C37C20   0630        JP   DISPRC      ;Ergebniscode und CR              0640 ;              0650 ;              0660 ; *******************************              0670 ;              0680 ; Datei zeichenweise laden              0690 ;              0700 ; y AADR Dateiname              0710 ; AADR durch Argument gesetzt              0720 ;2024 0009790D 0730        DEFB 0,9,"y,0DH2028 2A5B18   0740        LD   HL,(ARG1)   ;AADR sichen202B EB       0750        EX   DE,HL       ;DE zeigt auf BWS202C CD1908   0760        CALL GETTX0      ;Dateiname aus BWS              0770 ;202F CD2B08   0780        CALL FOPENR      ;zum Lesen init2032 CD3408   0790        CALL FGETRE      ;ResultCode --> HL2035 C27C20   0800        JP   NZ,DISPRC    ;Zy=1 wenn Ok              0810 ;              0820 ;Daten bis zum Ende (Z-Flag) lesen !2038 EB       0830        EX   DE,HL       ;AADR -> HL2039 CD2E08   0840 MR2    CALL FCHRR       ;Byte lesen203C 77       0850        LD   (HL),A203D 23       0860        INC  HL203E 20F9     0870        JR   NZ,MR2              0880 ;2040 CD3408   0890        CALL FGETRE      ;Ergebnis HL/Zy              0900 ;2043 C37C20   0910        JP   DISPRC      ;Ergenisanz. /Ende              0920 ;              0930 ; ************************************              0940 ;              0950 ; Speicherblock in Datei schreiben              0960 ; a AADR EADR SADR Dateiname              0970 ;2046 0009610D 0975        DEFB 0,9,"a,0DH              0976 ;              0980 ; ARG1-ARG3 bereits durch MonitorKdo gesetzt              0990 ;              1000 ; Dateinamen aus BWS uebertragen204A EB       1010        EX   DE,HL204B CD1908   1020        CALL GETTX0              1030 ;              1040 ;alternativ Namen aus RAM kopieren              1050 ;      LD   HL,9        ;Offset TXTBUF              1060 ;      CALL FGETSY      ;Pointer -> HL              1070 ;      LD   DE,SOURCE   ;Name im RAM              1080 ;      EX   DE,HL              1090 ;      LD   BC,LAENGE              1100 ;      LDIR              1110 ;              1120 ; Dateityp eintragen, bspw "X"204E 210800   1130        LD   HL,8        ;Offset FTYP2051 CD1308   1140        CALL FGETSY2054 3658     1150        LD   (HL),"X              1160 ;              1170 ; Operation zum Schreiben initialisieren2056 CD2208   1180        CALL FOPENW              1190 ;              1200 ; Bereich speichern2059 CD2808   1210        CALL FBLKW              1220 ; Fehlerpruefung205C CD3408   1230        CALL FGETRE205F C37C20   1240        JP   DISPRC              1250 ;              1260 ; ***********************************              1270 ;              1280 ; Datei komplett lesen              1290 ;              1300 ; b Dateiname              1310 ;2062 0009620D 1320        DEFB 0,9,"b,0DH              1330 ;              1340 ; Dateinamen vom BWS kopieren              1350 ; alternativ s.o2066 EB       1360        EX   DE,HL2067 CD1908   1370        CALL GETTX0              1380 ;              1390 ; Datei lesen initialisieren206A CD2B08   1400        CALL FOPENR              1410 ; Fehlerpruefung206D CD3408   1420        CALL FGETRE2070 C27C20   1430        JP   NZ,DISPRC   ;bei Fehler hier end              1440 ;              1450 ; Datei in RAM lesen, ab ARG1 aus Header              1460 ; bei Bedarf kann ARG1 hier geaendert werden2073 CD3108   1470        CALL FBLKR2076 CD3408   1480        CALL FGETRE              1490 ;2079 C37C20   1500        JP   DISPRC              1510 ;              1520 ; **********************************              1530 ; Ergebnisanzeige Datei OP              1540 ; HL   - Ergebniscode              1550 ; ARG1 - AADR              1560 ; FLEN - Datenlaenge              1570 ;207C DF       1580 DISPRC RST  18H207D 0D       1590        DEFB 0DH207E 52657375 1600        DEFM "Result"     6C742084 BA       1610        DEFB ":+80H2085 CDF107   1620        CALL OUTHL       ;Fehlercode der OP2088 7D       1622        LD   A,L2089 B4       1623        OR   H208A C2FD07   1624        JP   NZ,GETCO1              1630 ;208D DF       1640        RST  18H208E 0D       1650        DEFB 0DH208F 43524331 1660        DEFM "CRC16"     362094 BA       1670        DEFB ":+80H2095 DD2A5B18 1680        LD   IX,(ARG1)   ;AAdr2099 210200   1690        LD   HL,2        ;Offs f. FLEN209C CD1308   1700        CALL FGETSY209F 5E       1710        LD   E,(HL)      ;Laenge Speicherber.20A0 23       1720        INC  HL20A1 56       1730        LD   D,(HL)20A2 CD1F08   1740        CALL CRC1620A5 CDF107   1750        CALL OUTHL20A8 C3FD07   1760        JP   GETCO1          ***** 0000 Errors *****